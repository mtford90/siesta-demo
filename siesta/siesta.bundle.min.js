!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("./src/collection"),e=a("./src/util"),f=a("./src/collectionRegistry").CollectionRegistry,g=d.Collection,h=a("./src/cache"),i=a("./src/mapping").Mapping,j=a("./src/notificationCentre").notificationCentre,k=a("./vendor/operations.js/src/operation").Operation,l=a("./vendor/operations.js/src/queue").OperationQueue,m=a("./src/relationship").RelationshipType,n=a("./vendor/operations.js/src/log"),o=a("q"),p=e._;k.logLevel=n.Level.warn,l.logLevel=n.Level.warn;var q;q="undefined"!=typeof b?b.exports:{},q.save=function(a){var b=o.defer();return a=e.constructCallbackAndPromiseHandler(a,b),q.ext.storageEnabled?e.next(function(){var b=q.ext.storage.changes.mergeChanges;b(a)}):a("Storage module not installed"),b.promise},q.reset=function(){h.reset(),f.reset(),q.ext.http.DescriptorRegistry.reset()},q.on=p.bind(j.on,j),q.addListener=p.bind(j.addListener,j),q.removeListener=p.bind(j.removeListener,j),q.once=p.bind(j.once,j),q.Collection=g,q.RelationshipType=m;var r=a("./src/changes");q._internal={log:n,Mapping:i,mapping:a("./src/mapping"),error:a("./src/error"),ChangeType:r.ChangeType,object:a("./src/object"),extend:a("extend"),notificationCentre:a("./src/notificationCentre"),cache:a("./src/cache"),misc:a("./src/misc"),Operation:k,OperationQueue:l,coreChanges:r,CollectionRegistry:a("./src/collectionRegistry").CollectionRegistry,Collection:d.Collection,collection:d,utils:e,util:e,_:e._,query:a("./src/query"),store:a("./src/store"),q:a("q")},q.performanceMonitoringEnabled=!1,q.httpEnabled=!1,q.storageEnabled=!1,q.ext={},Object.defineProperty(q,"setPouch",{get:function(){return q.ext.storageEnabled?q.ext.storage.pouch.setPouch:null}}),Object.defineProperty(q.ext,"storageEnabled",{get:function(){return void 0!==q.ext._storageEnabled?q.ext._storageEnabled:!!q.ext.storage},set:function(a){q.ext._storageEnabled=a}}),Object.defineProperty(q.ext,"httpEnabled",{get:function(){return void 0!==q.ext._httpEnabled?q.ext._httpEnabled:!!q.ext.http},set:function(a){q.ext._httpEnabled=a}}),q.collection=function(a,b){return new g(a,b)},Object.defineProperty(q,"isDirty",{get:function(){return g.isDirty},configurable:!0,enumerable:!0}),"undefined"!=typeof window&&(window.siesta=q),c.siesta=q},{"./src/cache":6,"./src/changes":7,"./src/collection":8,"./src/collectionRegistry":9,"./src/error":10,"./src/mapping":12,"./src/misc":14,"./src/notificationCentre":15,"./src/object":16,"./src/query":20,"./src/relationship":21,"./src/store":22,"./src/util":23,"./vendor/operations.js/src/log":25,"./vendor/operations.js/src/operation":26,"./vendor/operations.js/src/queue":27,extend:4,q:5}],2:[function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];c.apply(this,h)}else if(f(c)){for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];for(j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h)}return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned){var e;e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d(a._events[b])?1:a._events[b].length:0}},{}],3:[function(a,b){function c(){}var d=b.exports={};d.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.binding=function(){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(){throw new Error("process.chdir is not supported")}},{}],4:[function(a,b){var c,d=Object.prototype.hasOwnProperty,e=Object.prototype.toString,f=function(a){"use strict";if(!a||"[object Object]"!==e.call(a)||a.nodeType||a.setInterval)return!1;var b=d.call(a,"constructor"),f=a.constructor&&a.constructor.prototype&&d.call(a.constructor.prototype,"isPrototypeOf");if(a.constructor&&!b&&!f)return!1;var g;for(g in a);return g===c||d.call(a,g)};b.exports=function g(){"use strict";var a,b,d,e,h,i,j=arguments[0],k=1,l=arguments.length,m=!1;for("boolean"==typeof j?(m=j,j=arguments[1]||{},k=2):("object"!=typeof j&&"function"!=typeof j||j==c)&&(j={});l>k;++k)if(null!=(a=arguments[k]))for(b in a)d=j[b],e=a[b],j!==e&&(m&&e&&(f(e)||(h=Array.isArray(e)))?(h?(h=!1,i=d&&Array.isArray(d)?d:[]):i=d&&f(d)?d:{},j[b]=g(m,i,e)):e!==c&&(j[b]=e));return j}},{}],5:[function(a,b,c){(function(a){!function(a){if("function"==typeof bootstrap)bootstrap("promise",a);else if("object"==typeof c)b.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=a}else Q=a()}(function(){"use strict";function b(a){return function(){return W.apply(a,arguments)}}function c(a){return a===Object(a)}function d(a){return"[object StopIteration]"===cb(a)||a instanceof S}function e(a,b){if(P&&b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(db)){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);var e=c.join("\n"+db+"\n");a.stack=f(e)}}function f(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var e=b[d];i(e)||g(e)||!e||c.push(e)}return c.join("\n")}function g(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function h(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function i(a){var b=h(a);if(!b)return!1;var c=b[0],d=b[1];return c===R&&d>=T&&hb>=d}function j(){if(P)try{throw new Error}catch(a){var b=a.stack.split("\n"),c=b[0].indexOf("@")>0?b[1]:b[2],d=h(c);if(!d)return;return R=d[0],d[1]}}function k(a,b,c){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",new Error("").stack),a.apply(a,arguments)}}function l(a){return s(a)?a:t(a)?C(a):B(a)}function m(){function a(a){b=a,f.source=a,Y(c,function(b,c){V(function(){a.promiseDispatch.apply(a,c)})},void 0),c=void 0,d=void 0}var b,c=[],d=[],e=_(m.prototype),f=_(p.prototype);if(f.promiseDispatch=function(a,e,f){var g=X(arguments);c?(c.push(g),"when"===e&&f[1]&&d.push(f[1])):V(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=function(){if(c)return f;var a=r(b);return s(a)&&(b=a),a},f.inspect=function(){return b?b.inspect():{state:"pending"}},l.longStackSupport&&P)try{throw new Error}catch(g){f.stack=g.stack.substring(g.stack.indexOf("\n")+1)}return e.promise=f,e.resolve=function(c){b||a(l(c))},e.fulfill=function(c){b||a(B(c))},e.reject=function(c){b||a(A(c))},e.notify=function(a){b||Y(d,function(b,c){V(function(){c(a)})},void 0)},e}function n(a){if("function"!=typeof a)throw new TypeError("resolver must be a function.");var b=m();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function o(a){return n(function(b,c){for(var d=0,e=a.length;e>d;d++)l(a[d]).then(b,c)})}function p(a,b,c){void 0===b&&(b=function(a){return A(new Error("Promise does not support operation: "+a))}),void 0===c&&(c=function(){return{state:"unknown"}});var d=_(p.prototype);if(d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(h){g=A(h)}c&&c(g)},d.inspect=c,c){var e=c();"rejected"===e.state&&(d.exception=e.reason),d.valueOf=function(){var a=c();return"pending"===a.state||"rejected"===a.state?d:a.value}}return d}function q(a,b,c,d){return l(a).then(b,c,d)}function r(a){if(s(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function s(a){return c(a)&&"function"==typeof a.promiseDispatch&&"function"==typeof a.inspect}function t(a){return c(a)&&"function"==typeof a.then}function u(a){return s(a)&&"pending"===a.inspect().state}function v(a){return!s(a)||"fulfilled"===a.inspect().state}function w(a){return s(a)&&"rejected"===a.inspect().state}function x(){eb.length=0,fb.length=0,gb||(gb=!0)}function y(a,b){gb&&(fb.push(a),eb.push(b&&"undefined"!=typeof b.stack?b.stack:"(no stack) "+b))}function z(a){if(gb){var b=Z(fb,a);-1!==b&&(fb.splice(b,1),eb.splice(b,1))}}function A(a){var b=p({when:function(b){return b&&z(this),b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});return y(b,a),b}function B(a){return p({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return bb(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function C(a){var b=m();return V(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function D(a){return p({isDef:function(){}},function(b,c){return J(a,b,c)},function(){return l(a).inspect()})}function E(a,b,c){return l(a).spread(b,c)}function F(a){return function(){function b(a,b){var g;if("undefined"==typeof StopIteration){try{g=c[a](b)}catch(h){return A(h)}return g.done?g.value:q(g.value,e,f)}try{g=c[a](b)}catch(h){return d(h)?h.value:A(h)}return q(g,e,f)}var c=a.apply(this,arguments),e=b.bind(b,"next"),f=b.bind(b,"throw");return e()}}function G(a){l.done(l.async(a)())}function H(a){throw new S(a)}function I(a){return function(){return E([this,K(arguments)],function(b,c){return a.apply(b,c)})}}function J(a,b,c){return l(a).dispatch(b,c)}function K(a){return q(a,function(a){var b=0,c=m();return Y(a,function(d,e,f){var g;s(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,q(e,function(d){a[f]=d,0===--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0),0===b&&c.resolve(a),c.promise})}function L(a){return q(a,function(a){return a=$(a,l),q(K($(a,function(a){return q(a,U,U)})),function(){return a})})}function M(a){return l(a).allSettled()}function N(a,b){return l(a).then(void 0,void 0,b)}function O(a,b){return l(a).nodeify(b)}var P=!1;try{throw new Error}catch(Q){P=!!Q.stack}var R,S,T=j(),U=function(){},V=function(){function b(){for(;c.next;){c=c.next;var a=c.task;c.task=void 0;var d=c.domain;d&&(c.domain=void 0,d.enter());try{a()}catch(f){if(g)throw d&&d.exit(),setTimeout(b,0),d&&d.enter(),f;setTimeout(function(){throw f},0)}d&&d.exit()}e=!1}var c={task:void 0,next:null},d=c,e=!1,f=void 0,g=!1;if(V=function(b){d=d.next={task:b,domain:g&&a.domain,next:null},e||(e=!0,f())},"undefined"!=typeof a&&a.nextTick)g=!0,f=function(){a.nextTick(b)};else if("function"==typeof setImmediate)f="undefined"!=typeof window?setImmediate.bind(window,b):function(){setImmediate(b)};else if("undefined"!=typeof MessageChannel){var h=new MessageChannel;h.port1.onmessage=function(){f=i,h.port1.onmessage=b,b()};var i=function(){h.port2.postMessage(0)};f=function(){setTimeout(b,0),i()}}else f=function(){setTimeout(b,0)};return V}(),W=Function.call,X=b(Array.prototype.slice),Y=b(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),Z=b(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),$=b(Array.prototype.map||function(a,b){var c=this,d=[];return Y(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),_=Object.create||function(a){function b(){}return b.prototype=a,new b},ab=b(Object.prototype.hasOwnProperty),bb=Object.keys||function(a){var b=[];for(var c in a)ab(a,c)&&b.push(c);return b},cb=b(Object.prototype.toString);S="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var db="From previous event:";l.resolve=l,l.nextTick=V,l.longStackSupport=!1,l.defer=m,m.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):a.resolve(arguments.length>2?X(arguments,1):c)}},l.Promise=n,l.promise=n,n.race=o,n.all=K,n.reject=A,n.resolve=l,l.passByCopy=function(a){return a},p.prototype.passByCopy=function(){return this},l.join=function(a,b){return l(a).join(b)},p.prototype.join=function(a){return l([this,a]).spread(function(a,b){if(a===b)return a;throw new Error("Can't join: not the same: "+a+" "+b)})},l.race=o,p.prototype.race=function(){return this.then(l.race)},l.makePromise=p,p.prototype.toString=function(){return"[object Promise]"},p.prototype.then=function(a,b,c){function d(b){try{return"function"==typeof a?a(b):b}catch(c){return A(c)}}function f(a){if("function"==typeof b){e(a,h);try{return b(a)}catch(c){return A(c)}}return A(a)}function g(a){return"function"==typeof c?c(a):a}var h=this,i=m(),j=!1;return V(function(){h.promiseDispatch(function(a){j||(j=!0,i.resolve(d(a)))},"when",[function(a){j||(j=!0,i.resolve(f(a)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=g(a)}catch(d){if(c=!0,!l.onerror)throw d;l.onerror(d)}c||i.notify(b)}]),i.promise},l.when=q,p.prototype.thenResolve=function(a){return this.then(function(){return a})},l.thenResolve=function(a,b){return l(a).thenResolve(b)},p.prototype.thenReject=function(a){return this.then(function(){throw a})},l.thenReject=function(a,b){return l(a).thenReject(b)},l.nearer=r,l.isPromise=s,l.isPromiseAlike=t,l.isPending=u,p.prototype.isPending=function(){return"pending"===this.inspect().state},l.isFulfilled=v,p.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},l.isRejected=w,p.prototype.isRejected=function(){return"rejected"===this.inspect().state};var eb=[],fb=[],gb=!0;l.resetUnhandledRejections=x,l.getUnhandledReasons=function(){return eb.slice()},l.stopUnhandledRejectionTracking=function(){x(),gb=!1},x(),l.reject=A,l.fulfill=B,l.master=D,l.spread=E,p.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)},l.async=F,l.spawn=G,l["return"]=H,l.promised=I,l.dispatch=J,p.prototype.dispatch=function(a,b){var c=this,d=m();return V(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},l.get=function(a,b){return l(a).dispatch("get",[b])},p.prototype.get=function(a){return this.dispatch("get",[a])},l.set=function(a,b,c){return l(a).dispatch("set",[b,c])},p.prototype.set=function(a,b){return this.dispatch("set",[a,b])},l.del=l["delete"]=function(a,b){return l(a).dispatch("delete",[b])},p.prototype.del=p.prototype["delete"]=function(a){return this.dispatch("delete",[a])},l.mapply=l.post=function(a,b,c){return l(a).dispatch("post",[b,c])},p.prototype.mapply=p.prototype.post=function(a,b){return this.dispatch("post",[a,b])},l.send=l.mcall=l.invoke=function(a,b){return l(a).dispatch("post",[b,X(arguments,2)])},p.prototype.send=p.prototype.mcall=p.prototype.invoke=function(a){return this.dispatch("post",[a,X(arguments,1)])},l.fapply=function(a,b){return l(a).dispatch("apply",[void 0,b])},p.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])},l["try"]=l.fcall=function(a){return l(a).dispatch("apply",[void 0,X(arguments,1)])},p.prototype.fcall=function(){return this.dispatch("apply",[void 0,X(arguments)])},l.fbind=function(a){var b=l(a),c=X(arguments,1);return function(){return b.dispatch("apply",[this,c.concat(X(arguments))])}},p.prototype.fbind=function(){var a=this,b=X(arguments);return function(){return a.dispatch("apply",[this,b.concat(X(arguments))])}},l.keys=function(a){return l(a).dispatch("keys",[])},p.prototype.keys=function(){return this.dispatch("keys",[])},l.all=K,p.prototype.all=function(){return K(this)},l.allResolved=k(L,"allResolved","allSettled"),p.prototype.allResolved=function(){return L(this)},l.allSettled=M,p.prototype.allSettled=function(){return this.then(function(a){return K($(a,function(a){function b(){return a.inspect()}return a=l(a),a.then(b,b)}))})},l.fail=l["catch"]=function(a,b){return l(a).then(void 0,b)},p.prototype.fail=p.prototype["catch"]=function(a){return this.then(void 0,a)},l.progress=N,p.prototype.progress=function(a){return this.then(void 0,void 0,a)},l.fin=l["finally"]=function(a,b){return l(a)["finally"](b)},p.prototype.fin=p.prototype["finally"]=function(a){return a=l(a),this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b})})},l.done=function(a,b,c,d){return l(a).done(b,c,d)},p.prototype.done=function(b,c,d){var f=function(a){V(function(){if(e(a,g),!l.onerror)throw a;l.onerror(a)})},g=b||c||d?this.then(b,c,d):this;"object"==typeof a&&a&&a.domain&&(f=a.domain.bind(f)),g.then(void 0,f)},l.timeout=function(a,b,c){return l(a).timeout(b,c)},p.prototype.timeout=function(a,b){var c=m(),d=setTimeout(function(){c.reject(new Error(b||"Timed out after "+a+" ms"))},a);return this.then(function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)},c.notify),c.promise},l.delay=function(a,b){return void 0===b&&(b=a,a=void 0),l(a).delay(b)},p.prototype.delay=function(a){return this.then(function(b){var c=m();return setTimeout(function(){c.resolve(b)},a),c.promise})},l.nfapply=function(a,b){return l(a).nfapply(b)},p.prototype.nfapply=function(a){var b=m(),c=X(a);return c.push(b.makeNodeResolver()),this.fapply(c).fail(b.reject),b.promise},l.nfcall=function(a){var b=X(arguments,1);return l(a).nfapply(b)},p.prototype.nfcall=function(){var a=X(arguments),b=m();return a.push(b.makeNodeResolver()),this.fapply(a).fail(b.reject),b.promise},l.nfbind=l.denodeify=function(a){var b=X(arguments,1);return function(){var c=b.concat(X(arguments)),d=m();return c.push(d.makeNodeResolver()),l(a).fapply(c).fail(d.reject),d.promise}},p.prototype.nfbind=p.prototype.denodeify=function(){var a=X(arguments);return a.unshift(this),l.denodeify.apply(void 0,a)},l.nbind=function(a,b){var c=X(arguments,2);return function(){function d(){return a.apply(b,arguments)}var e=c.concat(X(arguments)),f=m();return e.push(f.makeNodeResolver()),l(d).fapply(e).fail(f.reject),f.promise}},p.prototype.nbind=function(){var a=X(arguments,0);return a.unshift(this),l.nbind.apply(void 0,a)},l.nmapply=l.npost=function(a,b,c){return l(a).npost(b,c)},p.prototype.nmapply=p.prototype.npost=function(a,b){var c=X(b||[]),d=m();return c.push(d.makeNodeResolver()),this.dispatch("post",[a,c]).fail(d.reject),d.promise},l.nsend=l.nmcall=l.ninvoke=function(a,b){var c=X(arguments,2),d=m();return c.push(d.makeNodeResolver()),l(a).dispatch("post",[b,c]).fail(d.reject),d.promise},p.prototype.nsend=p.prototype.nmcall=p.prototype.ninvoke=function(a){var b=X(arguments,1),c=m();return b.push(c.makeNodeResolver()),this.dispatch("post",[a,b]).fail(c.reject),c.promise},l.nodeify=O,p.prototype.nodeify=function(a){return a?void this.then(function(b){V(function(){a(null,b)})},function(b){V(function(){a(b)})}):this};var hb=j();return l})}).call(this,a("_process"))},{_process:3}],6:[function(a,b,c){function d(){x={},v={},w={}}function e(a){var b=v[a];return b?r.debug.isEnabled&&r.debug("Local cache hit: "+b._dump(!0)):r.debug.isEnabled&&r.debug("Local cache miss: "+a),b}function f(a){var b=a.type,c=a.collection;console.error("getSingleton",w);var d=w[c];if(d){var e=d[b];if(e){var f=[];for(var g in e)e.hasOwnProperty(g)&&f.push(e[g]);if(f.length>1)throw t("A singleton mapping has more than 1 object in the cache! This is a serious error. Either a mapping has been modified after objects have already been created, or something has gonevery wrong. Please file a bug report if the latter.");if(f.length)return f[0]}}return null}function g(a,b){var c=b.mapping.type,d=b.mapping.collection,e=x[d];if(e){var f=x[d][c];if(f){var g=f[a];return g?s.debug.isEnabled&&s.debug("Remote cache hit: "+g._dump(!0)):s.debug.isEnabled&&s.debug("Remote cache miss: "+a),g}}return s.debug.isEnabled&&s.debug("Remote cache miss: "+a),null}function h(a,b,c){if(!a){var d="Must pass an object when inserting to cache";throw s.error(d),new t(d)}var e=a.mapping.collection;if(!e)throw new t("Mapping has no collection",{mapping:a.mapping,obj:a});x[e]||(x[e]={});var f=a.mapping.type;if(!f)throw new t("Mapping has no type",{mapping:a.mapping,obj:a});x[e][f]||(x[e][f]={}),c&&(x[e][f][c]=null);var g=x[e][f][b];if(g){if(a!=g){var h="Object "+e.toString()+":"+f.toString()+"["+a.mapping.id+'="'+b+'"] already exists in the cache. This is a serious error, please file a bug report if you are experiencing this out in the wild';throw s.error(h,{obj:a,cachedObject:g}),u.printStackTrace(),new t(h)}s.debug.isEnabled&&s.debug("Object has already been inserted: "+a._dump(!0))}else x[e][f][b]=a,s.debug.isEnabled&&s.debug("Remote cache insert: "+a._dump(!0)),s.trace.isEnabled&&s.trace("Remote cache now looks like: "+i(!0))}function i(a){var b={};for(var c in x)if(x.hasOwnProperty(c)){var d={};b[c]=d;var e=x[c];for(var f in e)if(e.hasOwnProperty(f)){var g={};d[f]=g;var h=e[f];for(var i in h)h.hasOwnProperty(i)&&h[i]&&(g[i]=h[i]._dump())}}return a?JSON.stringify(b,null,4):b}function j(a){var b={};for(var c in v)v.hasOwnProperty(c)&&(b[c]=v[c]._dump());return a?JSON.stringify(b,null,4):b}function k(a){var b={localCache:j(),remoteCache:i()};return a?JSON.stringify(b,null,4):b}function l(){return x}function m(){return v}function n(a){r.debug.isEnabled&&r.debug("get",a);var b,c,d,h=a._id;if(h)return b=e(h),b?b:a.mapping?(c=a.mapping.id,d=a[c],r.debug.isEnabled&&r.debug(c+"="+d),g(d,a)):null;if(a.mapping){if(c=a.mapping.id,d=a[c])return g(d,a);if(a.mapping.singleton)return f(a.mapping)}else r.warn("Invalid opts to cache",{opts:a});return null}function o(){for(var a=Object.keys(v),b=0;b<a.length;b++){var c=a[b],d=v[c];if(c!=d._id)throw u.printStackTrace(),new t("wtf?")}}function p(a){var b=a._id;if(b){var c=a.mapping.collection,d=a.mapping.type;if(v[b]){if(v[b]!=a){var e='Object with _id="'+b.toString()+'" is already in the cache. This is a serious error. Please file a bug report if you are experiencing this out in the wild';throw r.error(e),new t(e)}}else r.debug.isEnabled&&r.debug("Local cache insert: "+a._dump(!0)),v[b]=a,r.trace.isEnabled&&r.trace("Local cache now looks like: "+j(!0)),w[c]||(w[c]={}),w[c][d]||(w[c][d]={}),w[c][a.type][b]=a}var f=a.idField,g=a[f];g?h(a,g):s.debug.isEnabled&&s.debug('No remote id ("'+f+'") so wont be placing in the remote cache',a),o()}function k(a){var b={localCache:j(),remoteCache:i()};return a?JSON.stringify(b,null,4):b}var q=a("../vendor/operations.js/src/log"),r=q.loggerWithName("LocalCache");r.setLevel(q.Level.warn);var s=q.loggerWithName("RemoteCache");s.setLevel(q.Level.warn);var t=a("./error").RestError,u=a("./util"),v={},w={},x={};d(),c._remoteCache=l,c._localCache=m,Object.defineProperty(c,"_localCacheByType",{get:function(){return w}}),c.get=n,c.insert=p,c.remoteInsert=h,c.reset=d,c._dump=k},{"../vendor/operations.js/src/log":25,"./error":10,"./util":23}],7:[function(a,b,c){function d(a){this._opts=a,this._opts||(this._opts={}),h.call(this,"collection",this._opts),h.call(this,"mapping",this._opts),h.call(this,"_id",this._opts),h.call(this,"field",this._opts),h.call(this,"type",this._opts),h.call(this,"index",this._opts),h.call(this,"added",this._opts),h.call(this,"addedId",this._opts),h.call(this,"removed",this._opts),h.call(this,"removedId",this._opts),h.call(this,"new",this._opts),h.call(this,"newId",this._opts),h.call(this,"old",this._opts),h.call(this,"oldId",this._opts)}function e(a,b,c){l.trace.isEnabled&&l.trace('Sending notification "'+a+'"'),i.emit(a,c);var d=a+":"+b;l.trace.isEnabled&&l.trace('Sending notification "'+d+'"'),i.emit(d,c);var e="Siesta";l.trace.isEnabled&&l.trace('Sending notification "'+e+'"'),i.emit(e,c)}function f(a){if(!a.mapping)throw new j("Must pass a mapping");if(!a.collection)throw new j("Must pass a collection");if(!a._id)throw new j("Must pass a local identifier")}function g(a){f(a);var b=a.collection,c=a.mapping,g=new d(a);return e(b,c,g),g}var h=a("./misc").defineSubProperty,i=a("./notificationCentre").notificationCentre,j=a("./error").RestError,k=a("../vendor/operations.js/src/log"),l=k.loggerWithName("changes");l.setLevel(k.Level.warn);var m={Set:"Set",Splice:"Splice",Remove:"Remove"};d.prototype._dump=function(a){var b={};return b.collection="string"==typeof this.collection?this.collection:this.collection._dump(),b.mapping="string"==typeof this.mapping?this.mapping:this.mapping.type,b._id=this._id,b.field=this.field,b.type=this.type,this.index&&(b.index=this.index),this.added&&(b.added=_.map(this.added,function(a){return a._dump()})),this.removed&&(b.removed=_.map(this.removed,function(a){return a._dump()})),this.old&&(b.old=this.old),this.new&&(b.new=this.new),a?JSON.stringify(b,null,4):b},c.Change=d,c.registerChange=g,c.validateChange=f,c.ChangeType=m},{"../vendor/operations.js/src/log":25,"./error":10,"./misc":14,"./notificationCentre":15}],8:[function(a,b,c){function d(a){var b=this;if(!this)return new d(a);if(!a)throw k("Collection must have a name");this._name=a,this._docId="Collection_"+this._name,this._rawMappings={},this._mappings={},this.baseURL="",this.installed=!1,i.register(this),Object.defineProperty(this,"name",{get:function(){return b._name}})}function e(a){var b=new siesta.ext.http.RequestDescriptor(a);return siesta.ext.http.DescriptorRegistry.registerRequestDescriptor(b),b}function f(a){var b=new siesta.ext.http.ResponseDescriptor(a);return siesta.ext.http.DescriptorRegistry.registerResponseDescriptor(b),b}var g=a("../vendor/operations.js/src/log"),h=g.loggerWithName("Collection");h.setLevel(g.Level.warn);{var i=a("./collectionRegistry").CollectionRegistry,j=a("../vendor/operations.js/src/operation").Operation,k=a("./error").RestError,l=a("./mapping").Mapping,m=a("extend"),n=(a("../vendor/observe-js/src/observe").Platform,a("./util")),o=n._,p=a("q");a("./cache")}d.prototype.install=function(a){var b=p.defer(),c=this;if(this.installed){var d=new k('Collection "'+this._name+'" has already been installed');c._finaliseInstallation(d,a)}else{var e=[];for(var f in this._mappings)if(this._mappings.hasOwnProperty(f)){var g=this._mappings[f];e.push(g)}if(h.info.isEnabled&&h.info("There are "+e.length.toString()+" mappings to install"),e.length){var i=o.map(e,function(a){return new j("Install Mapping",o.bind(a.install,a))}),l=new j("Install Mappings",i);l.completion=function(){if(l.failed)h.error("Failed to install collection",l.error),c._finaliseInstallation(l.error,a);else{c.installed=!0;var b=[];o.each(e,function(a){h.info.isEnabled&&h.info('Installing relationships for mapping with name "'+a.type+'"');try{a.installRelationships()}catch(c){if(!(c instanceof k))throw c;b.push(c)}}),b.length||o.each(e,function(a){h.info.isEnabled&&h.info('Installing reverse relationships for mapping with name "'+a.type+'"');try{a.installReverseRelationships()}catch(c){if(!(c instanceof k))throw c;b.push(c)}});var d;1==b.length?d=b[0]:b.length&&(d=b),c._finaliseInstallation(d,a)}},l.start()}else c._finaliseInstallation(null,a)}return b.promise},d.prototype._finaliseInstallation=function(b,c){if(!b){this.installed=!0;var d=a("../index");d[this._name]=this}c&&c(b)},d.prototype._mapping=function(a,b){if(a){this._rawMappings[a]=b;var c=m(!0,{},b);c.type=a,c.collection=this._name;var d=new l(c);return this._mappings[a]=d,this[a]=d,d}throw new k("No name specified when creating mapping")},d.prototype.mapping=function(){var a=this;return arguments.length?1==arguments.length?n.isArray(arguments[0])?o.map(arguments[0],function(b){return a._mapping(b.name,b)}):this._mapping(arguments[0].name,arguments[0]):"string"==typeof arguments[0]?this._mapping(arguments[0],arguments[1]):o.map(arguments,function(b){return a._mapping(b.name,b)}):null},d.prototype._descriptor=function(a){var b=Array.prototype.slice.call(arguments,1);return b.length?1==b.length?n.isArray(b[0])?o.map(b[0],function(b){return a(b)}):a(b[0]):o.map(b,function(b){return a(b)}):null},d.prototype.requestDescriptor=function(){return o.partial(this._descriptor,e).apply(this,arguments)},d.prototype.responseDescriptor=function(){return o.partial(this._descriptor,f).apply(this,arguments)},d.prototype._dump=function(a){var b={};return b.installed=this.installed,b.docId=this._docId,b.name=this._name,b.baseURL=this.baseURL,a?JSON.stringify(b,null,4):b},d.prototype.save=function(a){var b=p.defer();return a=n.constructCallbackAndPromiseHandler(a,b),siesta.ext.storageEnabled?n.next(function(){var b=siesta.ext.storage.changes.mergeChanges;b(a)
}):a("Storage module not installed"),b.promise},d.prototype.HTTP_METHOD=function(a,b){if(siesta.ext.storageEnabled)return o.partial(a?this._httpRequest:this._httpResponse,b).apply(this,Array.prototype.slice.call(arguments,2));throw Error("Storage extension not installed.")},d.prototype.GET=function(){return o.partial(this.HTTP_METHOD,!1,"GET").apply(this,arguments)},d.prototype.OPTIONS=function(){return o.partial(this.HTTP_METHOD,!1,"OPTIONS").apply(this,arguments)},d.prototype.TRACE=function(){return o.partial(this.HTTP_METHOD,!1,"TRACE").apply(this,arguments)},d.prototype.HEAD=function(){return o.partial(this.HTTP_METHOD,!1,"HEAD").apply(this,arguments)},d.prototype.POST=function(){return o.partial(this.HTTP_METHOD,!0,"POST").apply(this,arguments)},d.prototype.PUT=function(){return o.partial(this.HTTP_METHOD,!0,"PUT").apply(this,arguments)},d.prototype.PATCH=function(){return o.partial(this.HTTP_METHOD,!0,"PATCH").apply(this,arguments)},d.prototype.count=function(a){var b=p.defer();a=n.constructCallbackAndPromiseHandler(a,b);var c=o.map(this._mappings,function(a){return o.bind(a.count,a)});return n.parallel(c,function(b,c){var d;b||(d=o.reduce(c,function(a,b){return a+b},0)),a(b,d)}),b.promise},c.Collection=d},{"../index":1,"../vendor/observe-js/src/observe":24,"../vendor/operations.js/src/log":25,"../vendor/operations.js/src/operation":26,"./cache":6,"./collectionRegistry":9,"./error":10,"./mapping":12,"./util":23,extend:4,q:5}],9:[function(a,b,c){function d(){return this?void(this.collectionNames=[]):new d}var e=a("./util")._;d.prototype.register=function(a){var b=a._name;this[b]=a,this.collectionNames.push(b)},d.prototype.reset=function(){var a=this;e.each(this.collectionNames,function(b){delete a[b]}),this.collectionNames=[]},c.CollectionRegistry=new d},{"./util":23}],10:[function(a,b,c){function d(a,b,c){return this?(this.message=a,this.context=b,c=c||arguments.callee,void(c&&Error.captureStackTrace&&Error.captureStackTrace(this,c))):new d(a,b)}d.prototype=Object.create(Error.prototype),d.prototype.name="RestError",d.prototype.constructor=d,c.RestError=d},{}],11:[function(a,b,c){function d(a){j.call(this,a);var b=this;Object.defineProperty(this,"isFault",{get:function(){return b._id?!b.related:!0},set:function(a){a?(b._id=void 0,b.related=null):b._id||(b._id=[],b.related=[],g.call(b,b.related))}}),this._reverseIsArray=!0}function e(a){var b=this;m.each(a,function(a){var c=i.getReverseProxyForObject.call(b,a),d=c._id.indexOf(b.object._id);i.makeChangesToRelatedWithoutObservations.call(c,function(){i.splice.call(c,d,1)})})}function f(a){var b=this;m.each(a,function(a){var c=i.getReverseProxyForObject.call(b,a);i.makeChangesToRelatedWithoutObservations.call(c,function(){i.splice.call(c,0,0,b.object)})})}function g(a){var b=this;if(q(a,this.reverseName,this.object),!a.oneToManyObserver){a.oneToManyObserver=new r(a);var c=function(c){c.forEach(function(c){var d=c.addedCount?a.slice(c.index,c.index+c.addedCount):[],g=c.removed;e.call(b,g),f.call(b,d);var h=i.getForwardMapping.call(b);o.registerChange({collection:h.collection,mapping:h,_id:b.object._id,field:i.getForwardName.call(b),removed:g,added:d,removedId:m.pluck(g,"_id"),addedId:m.pluck(d,"_id"),type:s.Splice,index:c.index})})};a.oneToManyObserver.open(c)}}function h(a){return"[object Array]"!=Object.prototype.toString.call(a)?"Cannot assign scalar to many to many":null}var i=a("./proxy"),j=i.NewObjectProxy,k=a("./store"),l=a("./util"),m=l._,n=a("./error").RestError,o=a("./changes"),p=a("./notificationCentre"),q=p.wrapArray,r=(a("./object").SiestaModel,a("../vendor/observe-js/src/observe").ArrayObserver),s=a("./changes").ChangeType,t=a("q");d.prototype=Object.create(j.prototype),d.prototype.get=function(a){var b=t.defer();a=l.constructCallbackAndPromiseHandler(a,b);var c=this;return this.isFault?k.get({_id:this._id},function(b,d){b?a&&a(b):(c.related=d,a&&a(null,d))}):a&&a(null,this.related),b.promise},d.prototype.set=function(a){i.checkInstalled.call(this);var b=this;if(a){var c;if(c=h.call(this,a))throw new n(c);i.clearReverseRelated.call(this),i.set.call(b,a),g.call(b,a),i.setReverse.call(b,a)}else i.clearReverseRelated.call(this),i.set.call(b,a)},d.prototype.install=function(a){j.prototype.install.call(this,a),a["splice"+l.capitaliseFirstLetter(this.reverseName)]=m.bind(i.splice,this)},c.ManyToManyProxy=d},{"../vendor/observe-js/src/observe":24,"./changes":7,"./error":10,"./notificationCentre":15,"./object":16,"./proxy":19,"./store":22,"./util":23,q:5}],12:[function(a,b,c){function d(a){var b=this;this._opts=a,Object.defineProperty(this,"_fields",{get:function(){var a=[];return b._opts.id&&a.push(b._opts.id),b._opts.attributes&&C.each(b._opts.attributes,function(b){a.push(b)}),a},enumerable:!0,configurable:!0}),l.call(this,"type",b._opts),l.call(this,"id",b._opts),l.call(this,"collection",b._opts),l.call(this,"attributes",b._opts),l.call(this,"relationships",b._opts),l.call(this,"indexes",b._opts),l.call(this,"subclass",b._opts),l.call(this,"singleton",b._opts),this.relationships||(this.relationships=[]),this.indexes||(this.indexes=[]),this._validateSubclass(),this._installed=!1,this._relationshipsInstalled=!1,this._reverseRelationshipsInstalled=!1,Object.defineProperty(this,"installed",{get:function(){return b._installed&&b._relationshipsInstalled&&b._reverseRelationshipsInstalled},enumerable:!0,configurable:!0})}function e(){var a=u._localCacheByType[this.collection]||{},b=a[this.type]||{};return C.reduce(Object.keys(b),function(a,b){return a[b]={},a},{})}function f(a,b,c){return this?(this.message=a,this.context=b,c=c||arguments.callee,void(c&&n.captureStackTrace&&n.captureStackTrace(this,c))):new f(a,b)}function g(a){var b=C.reduce(a,function(a,b){return a+'"'+b+'",'},"");return b=b.substring(0,b.length-1),"["+b+"]"}function h(a,b,c){var d,e=1==c.length&&!c[0].length,f=!c.length||e,h=g(c);return f?d=function(a){var b="$2",c="$3";a.type==b&&a.collection==c&&emit(a.type,a)}.toString():(d=function(a){var b="$2",c="$3";if(a.type==b&&a.collection==c){var d=$1,e="";for(var f in d){var g=d[f],h=a[g];e+=null!==h&&void 0!==h?h.toString()+"_":null===h?"null_":"undefined_"}e=e.substring(0,e.length-1),emit(e,a)}}.toString(),d=d.replace("$1",h)),d=d.replace("$2",b),d=d.replace("$3",a)}function i(a,b,c){var d,e=1==c.length&&!c[0].length,f=!c.length||e;return d=f?function(c){c.type==b&&c.collection==a&&emit(c.type,c)}:function(d){if(d.type==b&&d.collection==a){var e="";for(var f in c){var g=c[f],h=d[g];e+=null!==h&&void 0!==h?h.toString()+"_":null===h?"null_":"undefined_"}e=e.substring(0,e.length-1),emit(e,d)}}}var j=a("../vendor/operations.js/src/log"),k=j.loggerWithName("Mapping");k.setLevel(j.Level.warn);var l=a("./misc").defineSubProperty,m=a("./collectionRegistry").CollectionRegistry,n=a("./error").RestError,o=a("./relationship"),p=o.RelationshipType,q=a("./query").Query,r=(a("../vendor/operations.js/src/operation").Operation,a("./mappingOperation").BulkMappingOperation),s=a("./object").SiestaModel,t=a("./misc").guid,u=a("./cache"),v=(a("./store"),a("extend"),a("./changes")),w=v.ChangeType,x=a("./notificationCentre").wrapArray,y=a("./oneToManyProxy").OneToManyProxy,z=a("./oneToOneProxy").OneToOneProxy,A=a("./manyToManyProxy").ManyToManyProxy,B=a("./util"),C=B._,D=a("q");d.prototype._validateSubclass=function(){if(this.subclass&&this.subclass!==s){var a=new this.subclass(this);if(!a.mapping)throw new n('Subclass for mapping "'+this.type+'" has not been configured correctly. Did you call super?');if(this.subclass.prototype==s.prototype)throw new n('Subclass for mapping "'+this.type+'" has not been configured correctly. You should use Object.create on SiestaModel prototype.')}},d.prototype.installRelationships=function(){if(this._relationshipsInstalled)throw new n('Relationships for "'+this.type+'" have already been installed');var a=this;if(a._relationships=[],a._opts.relationships)for(var b in a._opts.relationships)if(k.debug.isEnabled&&k.debug(a.type+": configuring relationship "+b),a._opts.relationships.hasOwnProperty(b)){var c=a._opts.relationships[b];if(c.type!=p.OneToMany&&c.type!=p.OneToOne&&c.type!=p.ManyToMany)throw new n("Relationship type "+c.type+" does not exist");var d=c.mapping;if(k.debug.isEnabled&&k.debug("reverseMappingName",d),!a.collection)throw new n("Mapping must have collection");var e=m[a.collection];if(!e)throw new n("Collection "+a.collection+" not registered");var f=e[d];if(!f){var g=d.split(".");if(2==g.length){var h=g[0];d=g[1];var i=m[h];if(!i)throw new n('Collection with name "'+h+'" does not exist.');f=i[d]}}if(k.debug.isEnabled&&k.debug("reverseMapping",f),!f)throw new n('Mapping with name "'+d.toString()+'" does not exist');c.reverseMapping=f,c.forwardMapping=this,c.forwardName=b,c.reverseName=c.reverse}this._relationshipsInstalled=!0},d.prototype.installReverseRelationships=function(){if(this._reverseRelationshipsInstalled)throw new n('Reverse relationships for "'+this.type+'" have already been installed.');for(var a in this.relationships)if(this.relationships.hasOwnProperty(a)){var b=this.relationships[a],c=b.reverseMapping;c.relationships[b.reverseName]=b}this._reverseRelationshipsInstalled=!0},d.prototype.query=function(a,b){var c=D.defer();b=B.constructCallbackAndPromiseHandler(b,c);var d=new q(this,a);return d.execute(b),c.promise},d.prototype.get=function(a,b){function c(a,c){b&&b(a,c)}var d=D.defer();if(b=B.constructCallbackAndPromiseHandler(b,d),this.singleton)"function"==typeof a&&(b=a),this.all(function(a,b){if(a&&c(a),b.length>1)throw new n("Somehow more than one object has been created for a singleton mapping! This is a serious error, please file a bug report.");b.length?c(null,b[0]):c(null,b[0])});else{var e={};e[this.id]=a,e.mapping=this;var f=u.get(e);if(f)c(null,f);else{delete e.mapping;var g=new q(this,e);g.execute(function(b,d){var e=null;!b&&d.length&&(d.length>1?b="More than one object with id="+a.toString():e=d[0]),c(b,e)})}}return d.promise},d.prototype.all=function(a){var b=D.defer();a=B.constructCallbackAndPromiseHandler(a,b);var c=new q(this,{});return c.execute(a),b.promise},d.prototype.install=function(a){k.info.isEnabled&&k.info("Installing mapping "+this.type);var b=D.defer();if(a=B.constructCallbackAndPromiseHandler(a,b),this._installed)throw new n('Mapping "'+this.type+'" has already been installed');var c=this._validate();return this._installed=!0,k.info.isEnabled&&(c.length?k.error("Errors installing mapping "+this.type+": "+c):k.info("Installed mapping "+this.type)),a&&a(c.length?c:null),b.promise},d.prototype._validate=function(){var a=[];return this.type||a.push("Must specify a type"),this.collection||a.push("A mapping must belong to an collection"),a},d.prototype.map=function(a,b,c){var d=D.defer();if(b=B.constructCallbackAndPromiseHandler(b,d),!this.installed)throw new n("Mapping must be fully installed before creating any models");return B.isArray(a)?this._mapBulk(a,b,c):this._mapBulk([a],function(a,c){if(b){var d;c&&c.length&&(d=c[0]),b(a?a[0]:null,d)}},c?[c]:void 0),d.promise},d.prototype._mapBulk=function(a,b,c){var d=D.defer();b=B.constructCallbackAndPromiseHandler(b,d);var e={mapping:this,data:a};c&&(e.objects=c);var f=new r(e);return f.onCompletion(function(){var a=f.error;if(a)b&&b(a);else{var c=f.result;b(null,c)}}),f.start(),d.promise},d.prototype.count=function(a){var b=D.defer();a=B.constructCallbackAndPromiseHandler(a,b);var c=e.call(this);if(siesta.ext.storageEnabled){var d=siesta.ext.storage.Pouch.getPouch(),f=new siesta.ext.storage.Index(this.collection,this.type)._getName()+"_";d.query(f,{include_docs:!1},function(b,d){var e;b||(C.each(C.pluck(d.rows,"id"),function(a){c[a]={}}),e=Object.keys(c).length),a(b,e)})}else a(null,Object.keys(c).length);return b.promise},d.prototype._new=function(a){if(this.installed){var b,c=this;b=a&&a._id?a._id:t();var d;d=this.subclass?new this.subclass(this):new s(this),k.info.isEnabled&&k.info('New object created _id="'+b.toString()+'"',a),d._id=b,d.__values=a||{};var e=this._fields,f=e.indexOf(this.id);f>-1&&e.splice(f,1),C.each(e,function(a){Object.defineProperty(d,a,{get:function(){return d.__values[a]||null},set:function(b){var e=d.__values[a];d.__values[a]=b,v.registerChange({collection:c.collection,mapping:c.type,_id:d._id,"new":b,old:e,type:w.Set,field:a}),B.isArray(b)&&x(b,a,d)},enumerable:!0,configurable:!0})}),Object.defineProperty(d,this.id,{get:function(){return d.__values[c.id]||null},set:function(a){var b=d[c.id];d.__values[c.id]=a,v.registerChange({collection:c.collection,mapping:c.type,_id:d._id,"new":a,old:b,type:w.Set,field:c.id}),u.remoteInsert(d,a,b)},enumerable:!0,configurable:!0});for(var g in this.relationships){var h;if(this.relationships.hasOwnProperty(g)){var i=this.relationships[g];if(i.type==p.OneToMany)h=new y(i);else if(i.type==p.OneToOne)h=new z(i);else{if(i.type!=p.ManyToMany)throw new n("No such relationship type: "+i.type);h=new A(i)}}h.install(d),h.isFault=!1}return u.insert(d),d}throw B.printStackTrace(),new n("Mapping must be fully installed before creating any models")},d.prototype._dump=function(a){var b={};return b.name=this.type,b.attributes=this.attributes,b.id=this.id,b.collection=this.collection,b.relationships=C.map(this.relationships,function(a){return a.isForward?a.forwardName:a.reverseName}),a?JSON.stringify(b,null,4):b},d.prototype.toString=function(){return"Mapping["+this.type+"]"},f.prototype=Object.create(n.prototype),f.prototype.name="MappingError",f.prototype.constructor=f,c.Mapping=d,c.MappingError=f,c.constructMapFunction2=i,c.constructMapFunction=h},{"../vendor/operations.js/src/log":25,"../vendor/operations.js/src/operation":26,"./cache":6,"./changes":7,"./collectionRegistry":9,"./error":10,"./manyToManyProxy":11,"./mappingOperation":13,"./misc":14,"./notificationCentre":15,"./object":16,"./oneToManyProxy":17,"./oneToOneProxy":18,"./query":20,"./relationship":21,"./store":22,"./util":23,extend:4,q:5}],13:[function(a,b,c){function d(a){return s.reduce(a,function(a,b){return r.isArray(b)?a=a.concat(b):a.push(b),a},[])}function e(a,b){for(var c=0,d=[],e=0;e<b.length;e++)if(r.isArray(b[e])){var f=[];d[e]=f;for(var g=0;g<b[e].length;g++)f.push(a[c]),c++}else d[e]=a[c],c++;return d}function f(a){m.call(this),this._opts=a,t.call(this,"mapping",this._opts),t.call(this,"data",this._opts),t.call(this,"objects",this._opts),this.objects||(this.objects=[]),this.errors=[],this.name="Mapping Operation",this.work=s.bind(this._start,this),this.subOps={}}function g(){for(var a=0;a<this.data.length;a++){var b=this.data[a],c=this.objects[a];if(b!=c&&c){var d=this.mapping._fields;s.each(d,function(a){void 0!==b[a]&&(c[a]=b[a])})}}}function h(a){for(var b=[],c=[],d=0;d<this.data.length;d++){var e=this.data[d];e[a]&&(b.push(d),c.push(e[a]))}return{indexes:b,relatedData:c}}function i(){var a=this,b=s.keys(this.subOps);s.each(b,function(b){var c=a.subOps[b].op,d=a.subOps[b].indexes,f=c.errors;if(f.length)for(var g=h.call(a,b).relatedData,i=e(f,g),j=0;j<i.length;j++){var k=d[j],l=i[j],m=l;r.isArray(l)&&(m=s.reduce(l,function(a,b){return a||b},!1)),m&&(a.errors[k]||(a.errors[k]={}),a.errors[k][b]=l)}})}var j=a("./store"),k=a("./object").SiestaModel,l=a("../vendor/operations.js/src/log"),m=a("../vendor/operations.js/src/operation").Operation,n=a("../src/error").RestError,o=a("./query").Query,p=l.loggerWithName("MappingOperation");p.setLevel(l.Level.trace);var q=a("./cache"),r=a("./util"),s=r._,t=a("./misc").defineSubProperty,u=(a("./changes").ChangeType,a("q"));f.prototype=Object.create(m.prototype),f.prototype._map=function(){var a=this;g.call(this);var b=s.keys(a.subOps);s.each(b,function(b){for(var c=a.subOps[b].op,d=a.subOps[b].indexes,f=h.call(a,b).relatedData,g=e(c.objects,f),i=0;i<g.length;i++){var j=d[i],k=a.errors[j],l=k?k[b]:null;if(!l){var m=g[i],o=a.objects[j];if(o)try{o[b]=m}catch(l){if(!(l instanceof n))throw l;a.errors[j]||(a.errors[j]={}),a.errors[j][b]=l.message}}}})},f.prototype._lookup=function(a){var b=u.defer();a=r.constructCallbackAndPromiseHandler(a,b);for(var c=this,d=[],e=[],f=0;f<this.data.length;f++)if(!this.objects[f]){var g,h=this.data[f],i="string"==typeof h||"number"==typeof h||h instanceof String;i?(g={index:f,datum:{}},g.datum[c.mapping.id]=h,d.push(g)):h instanceof k?this.objects[f]=h:h._id?e.push({index:f,datum:h}):h[c.mapping.id]?d.push({index:f,datum:h}):this.objects[f]=c.mapping._new()}return r.parallel([function(a){var b=s.pluck(s.pluck(e,"datum"),"_id");j.getMultipleLocal(b,function(d,f){if(!d)for(var g=0;g<b.length;g++){var h=f[g],i=b[g],j=e[g];h?c.objects[j.index]=h:c.errors[j.index]={_id:'No object with _id="'+i.toString()+'"'}}a(d)})},function(a){var b=s.pluck(s.pluck(d,"datum"),c.mapping.id);p.trace.isEnabled&&p.trace("Looking up remoteIdentifiers: "+JSON.stringify(b,null,4)),j.getMultipleRemote(b,c.mapping,function(e,g){if(!e){if(p.trace.isEnabled){var h={};for(f=0;f<g.length;f++)h[b[f]]=g[f]?g[f]._id:null;p.trace("Results for remoteIdentifiers: "+JSON.stringify(h,null,4))}for(f=0;f<g.length;f++){var i=g[f],j=d[f];if(i)c.objects[j.index]=i;else{var k={},l=b[f];k[c.mapping.id]=l;var m={mapping:c.mapping};m[c.mapping.id]=l;var n=q.get(m);n?c.objects[j.index]=n:(c.objects[j.index]=c.mapping._new(),c.objects[j.index][c.mapping.id]=l)}}}a(e)})}],a),b.promise},f.prototype._lookupSingleton=function(a){var b=u.defer();a=r.constructCallbackAndPromiseHandler(a,b);var c=this,d=q.get({mapping:this.mapping});if(d){for(var e=0;e<c.data.length;e++)c.objects[e]=d;a()}else{var f=new o(this.mapping);f.execute(function(b,d){if(!b){var e;if(d.length){if(1!=d.length)throw new n;e=d[0]}else e=c.mapping._new();for(var f=0;f<c.data.length;f++)c.objects[f]=e}a(b)})}return b.promise},f.prototype._start=function(a){if(this.data.length){var b=this,c=[],d=this.mapping.singleton?this._lookupSingleton:this._lookup;c.push(s.bind(d,this)),c.push(s.bind(this._executeSubOperations,this)),r.parallel(c,function(){b._map(),a(b.errors.length?b.errors:null,b.objects)})}else a(null,[])},f.prototype._constructSubOperations=function(){var a=this.subOps,b=this.mapping.relationships;for(var c in b)if(b.hasOwnProperty(c)){var e=b[c],g=e.forwardName==c?e.reverseMapping:e.forwardMapping,i=h.call(this,c),j=i.indexes,k=i.relatedData;if(k.length){var l=d(k),m=new f({mapping:g,data:l});m.__relationshipName=c,a[c]={op:m,indexes:j}}}},f.prototype._executeSubOperations=function(a){var b=this;this._constructSubOperations();var c=s.keys(this.subOps);if(c.length){var d=s.map(c,function(a){return b.subOps[a].op}),e=new m(d);e.onCompletion(function(){i.call(b,c),a()}),e.start()}else a()},c.BulkMappingOperation=f,c.flattenArray=d,c.unflattenArray=e},{"../src/error":10,"../vendor/operations.js/src/log":25,"../vendor/operations.js/src/operation":26,"./cache":6,"./changes":7,"./misc":14,"./object":16,"./query":20,"./store":22,"./util":23,q:5}],14:[function(a,b,c){function d(a,b,c){if(!a)throw b=b||"Assertion failed",c=c||{},new g(b,c)}function e(a,b,c){return Object.defineProperty(this,a,{get:function(){return c?b[c]:b[a]},set:function(d){c?b[c]=d:b[a]=d},enumerable:!0,configurable:!0})}function f(a){return function(b,c){a&&a(b,c)}}var g=a("./error").RestError,h=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}();c.assert=d,c.defineSubProperty=e,c.guid=h,c.wrappedCallback=f},{"./error":10}],15:[function(a,b,c){function d(a,b,c){a.observer||(a.observer=new g(a),a.observer.open(function(d){var e=c._fields.indexOf(b)>-1;e&&d.forEach(function(d){h.registerChange({collection:c.collection,mapping:c.mapping.type,_id:c._id,index:d.index,removed:d.removed,added:d.addedCount?a.slice(d.index,d.index+d.addedCount):[],type:h.ChangeType.Splice,field:b})})}),a.isFault=!1)}var e=a("events").EventEmitter,f=new e;f.setMaxListeners(100);{var g=a("../vendor/observe-js/src/observe").ArrayObserver,h=a("./changes");h.ChangeType,a("../vendor/operations.js/src/log")}c.notificationCentre=f,c.wrapArray=d},{"../vendor/observe-js/src/observe":24,"../vendor/operations.js/src/log":25,"./changes":7,events:2}],16:[function(a,b,c){function d(a){if(!this)return new d(a);var b=this;this.mapping=a,Object.defineProperty(this,"idField",{get:function(){return b.mapping.id?b.mapping.id:"id"},enumerable:!0,configurable:!0}),g.call(this,"type",this.mapping),g.call(this,"collection",this.mapping),g.call(this,"_fields",this.mapping),Object.defineProperty(this,"_relationshipFields",{get:function(){return i.map(b._proxies,function(a){return a.isForward?a.forwardName:a.reverseName})},enumerable:!0,configurable:!0}),this.isFault=!1,Object.defineProperty(this,"isSaved",{get:function(){return!!b._rev},enumerable:!0,configurable:!0}),this._rev=null}var e=a("../vendor/operations.js/src/log"),f=e.loggerWithName("SiestaModel");f.setLevel(e.Level.warn);var g=a("./misc").defineSubProperty,h=a("./util"),i=h._,j=a("./error"),k=(j.RestError,a("q"));d.prototype._dump=function(a){var b=this,c={};return c.mapping=this.mapping.type,c.collection=this.collection,c._id=this._id,c=i.reduce(this._fields,function(a,c){return b[c]&&(a[c]=b[c]),a},c),c=i.reduce(this._relationshipFields,function(a,c){return b[c+"Proxy"]&&(b[c+"Proxy"].hasOwnProperty("_id")?h.isArray(b[c+"Proxy"]._id)?b[c].length&&(a[c]=b[c+"Proxy"]._id):b[c+"Proxy"]._id&&(a[c]=b[c+"Proxy"]._id):a[c]=b[c]),a},c),a?JSON.stringify(c,null,4):c},d.prototype.get=function(a){var b=k.defer();return a=h.constructCallbackAndPromiseHandler(a,b),a&&a(null,this),b.promise},c.SiestaModel=d,c.dumpSaveQueues=function(){var a={};for(var b in queues)if(queues.hasOwnProperty(b)){var c=queues[b];a[b]={numRunning:c.numRunningOperations,queued:c._queuedOperations.length}}return a}},{"../vendor/operations.js/src/log":25,"./error":10,"./misc":14,"./util":23,q:5}],17:[function(a,b,c){function d(a){k.call(this,a);var b=this;Object.defineProperty(this,"isFault",{get:function(){return b.isForward?b._id?!b.related:null===b._id?!1:!0:b._id&&b.related?b._id.length!=b.related.length?(i.call(this),!0):!1:!0},set:function(a){a?(b._id=void 0,b.related=null):b._id||(b.isForward?b._id=null:(b._id=[],b.related=[],g.call(b,b.related)))}}),this._reverseIsArray=!0,this._forwardIsArray=!1}function e(a){var b=this;n.each(a,function(a){var c=j.getReverseProxyForObject.call(b,a);j.set.call(c,null)})}function f(a){var b=this;n.each(a,function(a){var c=j.getReverseProxyForObject.call(b,a);j.set.call(c,b.object)})}function g(a){var b=this;if(r(a,this.reverseName,this.object),!a.oneToManyObserver){a.oneToManyObserver=new s(a);var c=function(c){c.forEach(function(c){var d=c.addedCount?a.slice(c.index,c.index+c.addedCount):[],g=c.removed;e.call(b,g),f.call(b,d);var h=j.getForwardMapping.call(b);p.registerChange({collection:h.collection,mapping:h,_id:b.object._id,field:j.getForwardName.call(b),removed:g,added:d,removedId:n.pluck(g,"_id"),addedId:n.pluck(d,"_id"),type:t.Splice,index:c.index})})};a.oneToManyObserver.open(c)}}function h(a){if(this.isForward){if("[object Array]"==Object.prototype.toString.call(a))return"Cannot assign array forward foreign key"}else if("[object Array]"!=Object.prototype.toString.call(a))return"Cannot scalar to reverse foreign key";return null}function i(){var a=this;if(a._id&&a.related&&a._id.length!=a.related.length&&a.related.length>0)throw new o("_id and related are somehow out of sync")}var j=a("./proxy"),k=j.NewObjectProxy,l=a("./store"),m=a("./util"),n=m._,o=a("./error").RestError,p=a("./changes"),q=(a("./object").SiestaModel,a("./notificationCentre")),r=q.wrapArray,s=a("../vendor/observe-js/src/observe").ArrayObserver,t=a("./changes").ChangeType,u=a("q");d.prototype=Object.create(k.prototype),d.prototype.get=function(a){var b=u.defer();a=m.constructCallbackAndPromiseHandler(a,b);var c=this;if(this.isFault)if(this._id.length){var d={_id:this._id};l.get(d,function(b,d){b?a&&a(b):(c.related=d,a&&a(null,d))})}else a&&a(null,this.related);else a&&a(null,this.related);return b.promise},d.prototype.set=function(a){j.checkInstalled.call(this);var b=this;if(a){var c;if(c=h.call(this,a))throw new o(c);j.clearReverseRelated.call(this),j.set.call(b,a),b.isReverse&&g.call(this,b.related),j.setReverse.call(b,a)}else j.clearReverseRelated.call(this),j.set.call(b,a)},d.prototype.install=function(a){k.prototype.install.call(this,a),this.isReverse&&(a["splice"+m.capitaliseFirstLetter(this.reverseName)]=n.bind(j.splice,this))},c.OneToManyProxy=d},{"../vendor/observe-js/src/observe":24,"./changes":7,"./error":10,"./notificationCentre":15,"./object":16,"./proxy":19,"./store":22,"./util":23,q:5}],18:[function(a,b,c){function d(a){g.call(this,a),this._reverseIsArray=!1,this._forwardIsArray=!1}function e(a){return"[object Array]"==Object.prototype.toString.call(a)?"Cannot assign array to one to one relationship":null}{var f=a("./proxy"),g=f.NewObjectProxy,h=a("./store"),i=a("./util"),j=a("./error").RestError,k=a("q");a("./object").SiestaModel}d.prototype=Object.create(g.prototype),d.prototype.set=function(a){f.checkInstalled.call(this);var b=this;if(a){var c;if(c=e(a))throw new j(c);f.clearReverseRelated.call(this),f.set.call(b,a),f.setReverse.call(b,a)}else f.clearReverseRelated.call(this),f.set.call(b,a)},d.prototype.get=function(a){var b=k.defer();a=i.constructCallbackAndPromiseHandler(a,b);var c=this;return this._id&&h.get({_id:this._id},function(b,d){b?a&&a(b):(c.related=d,a&&a(null,d))}),b.promise},c.OneToOneProxy=d},{"./error":10,"./object":16,"./proxy":19,"./store":22,"./util":23,q:5}],19:[function(a,b,c){function d(a){var b=this;this.proxy=a,Object.defineProperty(this,"isFault",{get:function(){return b.proxy.isFault},enumerable:!0,configurable:!0})}function e(a){if(this._opts=a,!this)return new e(a);var b=this;this.fault=new d(this),this.object=null,this._id=void 0,this.related=null,Object.defineProperty(this,"isFault",{get:function(){return b._id?!b.related:null===b._id?!1:!0},set:function(a){a?(b._id=void 0,b.related=null):b._id||(b._id=null)},enumerable:!0,configurable:!0}),w.call(this,"reverseMapping",this._opts),w.call(this,"forwardMapping",this._opts),w.call(this,"forwardName",this._opts),w.call(this,"reverseName",this._opts),Object.defineProperty(this,"isReverse",{get:function(){if(b.object)return b.object.mapping==b.reverseMapping;throw new v("Cannot use proxy until installed")},enumerable:!0,configurable:!0}),Object.defineProperty(this,"isForward",{get:function(){if(b.object)return b.object.mapping==b.forwardMapping;throw new v("Cannot use proxy until installed")},enumerable:!0,configurable:!0})}function f(a){var b=h.call(this),c=b+"Proxy";return x.isArray(a)?y.pluck(a,c):a[c]}function g(a){var b=i.call(this),c=b+"Proxy";return x.isArray(a)?y.pluck(a,c):a[c]}function h(){return this.isForward?this.reverseName:this.forwardName}function i(){return this.isForward?this.forwardName:this.reverseName}function j(){return this.isForward?this.reverseMapping:this.forwardMapping}function k(){return this.isForward?this.forwardMapping:this.reverseMapping}function l(){if(!this.object)throw new v("Proxy must be installed on an object before can use it.")}function m(a){s.call(this,a),a?x.isArray(a)?(this._id=y.pluck(a,"_id"),this.related=a):(this._id=a._id,this.related=a):(this._id=null,this.related=null)}function n(a,b){t.apply(this,arguments);var c=Array.prototype.slice.call(arguments,2),d=y.partial(this._id.splice,a,b).apply(this._id,y.pluck(c,"_id"));return this.related&&y.partial(this.related.splice,a,b).apply(this.related,c),d}function o(a){function b(a){if(a){var b=a.mapping,c=b.type,d=a._id;return"string"==typeof d&&(d='"'+d+'"'),c+"[_id="+d+"]"}return void 0===a?"undefined":null===a?"null":void 0}return x.isArray(a)?y.map(b,a).join(", "):b(a)}function p(){var a=this;if(a.isFault){if(!a._id)throw new Error(i.call(this)+" has no _id");var b=h.call(this),c=j.call(this),d=x.isArray(a._id)?a._id:[a._id];this._reverseIsArray?y.each(d,function(d){C.registerChange({collection:c.collection,mapping:c.type,_id:d,field:b,removedId:[a.object._id],removed:[a.object],type:D.Remove})}):y.each(d,function(d){C.registerChange({collection:c.collection,mapping:c.type,_id:d,field:b,"new":null,newId:null,oldId:a.object._id,old:a.object,type:D.Set})})}else if(this.related){var e=f.call(this,this.related),g=x.isArray(e)?e:[e];y.each(g,function(b){if(x.isArray(b._id)){var c=b._id.indexOf(a.object._id);q.call(b,function(){n.call(b,c,1)})}else m.call(b,null)})}}function q(a){this.related?(this.related.oneToManyObserver.close(),this.related.oneToManyObserver=null,a(),u.call(this,this.related)):a()}function r(a){var b=this,c=f.call(this,a),d=x.isArray(c)?c:[c];y.each(d,function(a){x.isArray(a._id)?q.call(a,function(){n.call(a,a._id.length,0,b.object)}):(p.call(a),m.call(a,b.object))})}function s(a){var b=this.object;if(!b)throw v("Proxy must have an object associated");var c,d=b.mapping.type,e=b.collection;c=x.isArray(a)?y.pluck(a,"_id"):a?a._id:a;var f=this._id;x.isArray(f)&&!f.length&&(f=null);var g=this.related;x.isArray(g)&&!g.length&&(g=null),C.registerChange({collection:e,mapping:d,_id:b._id,field:i.call(this),newId:c,oldId:f,old:g,"new":a,type:D.Set})}function t(a,b){var c=Array.prototype.slice.call(arguments,2),d=this.object.mapping.type,e=this.object.collection;C.registerChange({collection:e,mapping:d,_id:this.object._id,field:i.call(this),index:a,removedId:this._id.slice(a,a+b),removed:this.related?this.related.slice(a,a+b):null,addedId:c.length?y.pluck(c,"_id"):[],added:c.length?c:[],type:D.Splice})}function u(a){var b=this;if(A(a,this.reverseName,this.object),!a.oneToManyObserver){a.oneToManyObserver=new B(a);var c=function(c){c.forEach(function(c){var d=c.addedCount?a.slice(c.index,c.index+c.addedCount):[],e=k.call(b);C.registerChange({collection:e.collection,mapping:e,_id:b.object._id,field:i.call(b),removed:c.removed,added:d,removedId:y.pluck(c.removed,"_id"),addedId:y.pluck(c.added,"_id"),type:D.Splice})})};a.oneToManyObserver.open(c)}}var v=a("./error").RestError,w=(a("./store"),a("./misc").defineSubProperty),x=(a("../vendor/operations.js/src/operation").Operation,a("./util")),y=x._,z=(a("./query").Query,a("../vendor/operations.js/src/log"),a("./notificationCentre")),A=z.wrapArray,B=a("../vendor/observe-js/src/observe").ArrayObserver,C=a("./changes"),D=C.ChangeType;d.prototype.get=function(){this.proxy.get.apply(this.proxy,arguments)},d.prototype.set=function(){this.proxy.set.apply(this.proxy,arguments)},e.prototype._dump=function(){},e.prototype.install=function(a){if(!a)throw new v("No object passed to relationship install");if(this.object)throw new v("Already installed.");this.object=a;var b=this,c=i.call(this);Object.defineProperty(a,c,{get:function(){return b.isFault?b.fault:b.related},set:function(a){b.set(a)},configurable:!0,enumerable:!0}),a["get"+x.capitaliseFirstLetter(c)]=y.bind(this.get,this),a["set"+x.capitaliseFirstLetter(c)]=y.bind(this.set,this),a[c+"Proxy"]=this,a._proxies||(a._proxies=[]),a._proxies.push(this)},e.prototype.set=function(){throw new v("Must subclass NewObjectProxy")},e.prototype.get=function(){throw new v("Must subclass NewObjectProxy")},c.NewObjectProxy=e,c.Fault=d,c.getReverseProxyForObject=f,c.getForwardProxyForObject=g,c.getReverseName=h,c.getForwardName=i,c.getReverseMapping=j,c.getForwardMapping=k,c.checkInstalled=l,c.set=m,c.registerSetChange=s,c.splice=n,c.clearReverseRelated=p,c.setReverse=r,c.objAsString=o,c.wrapArray=u,c.registerSpliceChange=t,c.makeChangesToRelatedWithoutObservations=q},{"../vendor/observe-js/src/observe":24,"../vendor/operations.js/src/log":25,"../vendor/operations.js/src/operation":26,"./changes":7,"./error":10,"./misc":14,"./notificationCentre":15,"./query":20,"./store":22,"./util":23}],20:[function(a,b,c){function d(a,b){this.mapping=a,this.query=b}function e(a){var b=k.defer();a=l.constructCallbackAndPromiseHandler(a,b);var c=siesta.ext.storage,d=c.RawQuery,e=c.Pouch,f=new d(this.mapping.collection,this.mapping.type,this.query);return f.execute(function(b,c){b?a(b):(j.debug.isEnabled&&j.debug("got results",c),a&&a(null,e.toSiesta(c)))}),b.promise}function f(a){for(var b=Object.keys(this.query),c=0;c<b.length;c++){var d=b[c];
if(a[d]!=this.query[d])return!1}return!0}function g(a){var b=k.defer();a=l.constructCallbackAndPromiseHandler(a,b);var c,d=i._localCacheByType,e=this.mapping.type,g=this.mapping.collection,h=d[g];if(h&&(c=h[e]),c){var j=Object.keys(c),m=this,n=_.reduce(j,function(a,b){var d=c[b];return f.call(m,d)&&a.push(d),a},[]);a&&a(null,n)}else a&&a(null,[]);return b.promise}var h=a("../vendor/operations.js/src/log"),i=a("./cache"),j=h.loggerWithName("Query"),k=a("q"),l=a("./util");j.setLevel(h.Level.warn),d.prototype.execute=function(a){var b=k.defer();return a=l.constructCallbackAndPromiseHandler(a,b),siesta.ext.storageEnabled?e.call(this,a):g.call(this,a),b.promise},d.prototype._dump=function(a){return a?"{}":{}},c.Query=d},{"../vendor/operations.js/src/log":25,"./cache":6,"./util":23,q:5}],21:[function(a,b,c){function d(a,b){this.relationship=a,this.object=b,this._id=null,this.relatedObject=null}function e(a,b,c,d){if(!this)return new e(a,b,c,d);var f=this;this.mapping=c,this.name=a,this._reverseName=b,Object.defineProperty(this,"reverseName",{get:function(){return f._reverseName?f._reverseName:"reverse_"+f.name}}),this.reverseMapping=d}var f=a("./error").RestError,g=a("./store"),h=a("q");RelationshipType={OneToMany:"OneToMany",OneToOne:"OneToOne",ManyToMany:"ManyToMany"},d.prototype.get=function(a){var b=h.defer();a=util.constructCallbackAndPromiseHandler(a,b);var c=this;return this.relationship.getRelated(this.object,function(b,d){b||(c.relatedObject=d),a&&a(b,d)}),b.promise},d.prototype.set=function(a,b){var c=h.defer();return b=util.constructCallbackAndPromiseHandler(b,c),this.relationship.setRelated(this.object,a,b),c.promise},d.prototype.remove=function(a,b){var c=h.defer();return b=util.constructCallbackAndPromiseHandler(b,c),this.relationship.removeRelated(this.object,a,b),c.promise},d.prototype.add=function(a,b){var c=h.defer();return b=util.constructCallbackAndPromiseHandler(b,c),this.relationship.addRelated(this.object,a,b),c.promise},d.prototype.isFault=function(){return this._id?!this.relatedObject:!1},e.prototype.getRelated=function(){throw Error("Relationship.getRelated must be overridden")},e.prototype.setRelated=function(){throw Error("Relationship.setRelated must be overridden")},e.prototype.isForward=function(a){return a.mapping===this.mapping},e.prototype.isReverse=function(a){return a.mapping===this.reverseMapping},e.prototype.contributeToSiestaModel=function(a){if(this.isForward(a))a[this.name]=new d(this,a);else{if(!this.isReverse(a))throw new f("Cannot contribute to object as this relationship has neither a forward or reverse mapping that matches",{relationship:this,obj:a});a[this.reverseName]=new d(this,a)}},e.prototype.setRelatedById=function(a,b,c){var d=this,e=h.defer();return c=util.constructCallbackAndPromiseHandler(c,e),g.get({_id:b},function(b,e){b?c(b):d.setRelated(a,e,function(){c&&c()})}),e.promise},e.prototype._dump=function(a){var b={};return b.forward={name:this.name,mapping:this.mapping.type},b.reverse={name:this.reverseName,mapping:this.reverseMapping.type},a?JSON.stringify(b,null,4):b},c.Relationship=e,c.RelatedObjectProxy=d,c.RelationshipType=RelationshipType},{"./error":10,"./store":22,q:5}],22:[function(a,b,c){function d(a,b){var c=o.defer();b=l.constructCallbackAndPromiseHandler(b,c),k.debug.isEnabled&&k.debug("get",a);var d;if(a._id){if(l.isArray(a._id))e(m.map(a._id,function(a){return{_id:a}}),b);else if(d=n.get(a))k.debug.isEnabled&&k.debug("Had cached object",{opts:a,obj:d}),h(b)(null,d);else if(l.isArray(a._id))e(m.map(a._id,function(a){return{_id:a}}),b);else if(b){var f=siesta.ext.storage;if(!f)throw"Storage module not installed";f.store.getFromPouch(a,b)}}else if(a.mapping)if(l.isArray(a[a.mapping.id]))e(m.map(a[a.mapping.id],function(b){var c={};return c[a.mapping.id]=b,c.mapping=a.mapping,c}),b);else if(d=n.get(a))k.debug.isEnabled&&k.debug("Had cached object",{opts:a,obj:d}),h(b)(null,d);else{var g=a.mapping;if(g.singleton)g.get(b);else{var j=g.id,p=a[j];p?g.get(p,function(a,c){a?b(a):c?b(null,c):b(null,null)}):h(b)(new i('Invalid options given to store. Missing "'+j.toString()+'."',{opts:a}))}}else{var q={opts:a},r="Invalid options given to store";k.error(r,q),h(b)(new i(r,q))}return c.promise}function e(a,b){var c=o.defer();b=l.constructCallbackAndPromiseHandler(b,c);var e=[],f=[];return m.each(a,function(c){d(c,function(c,d){c?f.push(c):e.push(d),e.length+f.length==a.length&&b&&(f.length?b(f):b(null,e))})}),c.promise}function f(a,b){function c(c){b&&(c?b(c):b(null,m.map(a,function(a){return e.cached[a]})))}var d=o.defer();b=l.constructCallbackAndPromiseHandler(b,d);var e=m.reduce(a,function(a,b){var c=n.get({_id:b});return c?a.cached[b]=c:a.notCached.push(b),a},{cached:{},notCached:[]});return e.notCached.length?siesta.ext.storage.store.getMultipleLocalFromCouch(e,c):c(),d.promise}function g(a,b,c){function d(b){c&&(b?c(b):c(null,m.map(a,function(a){return f.cached[a]})))}var e=o.defer();c=l.constructCallbackAndPromiseHandler(c,e);var f=m.reduce(a,function(a,c){var d={mapping:b};d[b.id]=c;var e=n.get(d);return e?a.cached[c]=e:a.notCached.push(c),a},{cached:{},notCached:[]});return f.notCached.length?siesta.ext.storage.store.getMultipleRemoteFrompouch(b,a,f,d):d(),e.promise}var h=a("./misc").wrappedCallback,i=a("./error").RestError,j=a("../vendor/operations.js/src/log"),k=j.loggerWithName("Store");k.setLevel(j.Level.warn);var l=a("./util"),m=l._,n=a("./cache"),o=a("q");c.get=d,c.getMultiple=e,c.getMultipleLocal=f,c.getMultipleRemote=g},{"../vendor/operations.js/src/log":25,"./cache":6,"./error":10,"./misc":14,"./util":23,q:5}],23:[function(a,b,c){function d(){var a=new Error("printStackTrace"),b=a.stack;console.log(b)}function e(a){return a.charAt(0).toUpperCase()+a.slice(1)}function f(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[j].concat(b))}}function g(a,b){if(a.map)return a.map(b);var c=[];return j(a,function(a,d,e){c.push(b(a,d,e))}),c}function h(a,b,c,d){if(b=g(b,function(a,b){return{index:b,value:a}}),d){var e=[];a(b,function(a,b){c(a.value,function(c,d){e[a.index]=d,b(c)})},function(a){d(a,e)})}else a(b,function(a,b){c(a.value,function(a){b(a)})})}function i(a,b){if(a.forEach)return a.forEach(b);for(var c=0;c<a.length;c+=1)b(a[c],c,a)}function j(a,b,c){function d(b){b?(c(b),c=function(){}):(e+=1,e>=a.length&&c())}if(c=c||function(){},!a.length)return c();var e=0;i(a,function(a){b(a,l(d))})}function k(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}function l(a){var b=!1;return function(){if(b)throw new Error("Callback was already called.");b=!0,a.apply(m,arguments)}}c.printStackTrace=d,c.capitaliseFirstLetter=e;var m={},n=Array.isArray||function(a){return"[object Array]"===_toString.call(a)},o=f(h),p=function(a,b,c){if(c=c||function(){},n(b))a.map(b,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},c);else{var d={};a.each(k(b),function(a,c){b[a](function(b){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),d[a]=e,c(b)})},function(a){c(a,d)})}};c.parallel=function(a,b){p({map:o,each:j},a,b)},c.isArray=n;var q={},r=Array.prototype,s=Function.prototype,t=r.forEach,u=r.map,v=r.reduce,w=s.bind,x=r.slice,y={};q.keys=k,q.each=q.forEach=function(a,b,c){if(null==a)return a;if(t&&a.forEach===t)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,e=a.length;e>d;d++)if(b.call(c,a[d],d,a)===y)return}else for(var f=q.keys(a),d=0,e=f.length;e>d;d++)if(b.call(c,a[f[d]],f[d],a)===y)return;return a},q.map=q.collect=function(a,b,c){var d=[];return null==a?d:u&&a.map===u?a.map(b,c):(q.each(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)},q.partial=function(a){var b=x.call(arguments,1);return function(){for(var c=0,d=b.slice(),e=0,f=d.length;f>e;e++)d[e]===q&&(d[e]=arguments[c++]);for(;c<arguments.length;)d.push(arguments[c++]);return a.apply(this,d)}},q.pluck=function(a,b){return q.map(a,q.property(b))};var z="Reduce of empty array with no initial value";q.reduce=q.foldl=q.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),v&&a.reduce===v)return d&&(b=q.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(q.each(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},q.property=function(a){return function(b){return b[a]}},"function"!=typeof/./&&(q.isFunction=function(a){return"function"==typeof a});var A=function(a){return null==a?q.identity:q.isFunction(a)?a:q.property(a)};q.sortBy=function(a,b,c){return b=A(b),q.pluck(q.map(a,function(a,d,e){return{value:a,index:d,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var B=function(){};q.bind=function(a,b){var c,d;if(w&&a.bind===w)return w.apply(a,x.call(arguments,1));if(!q.isFunction(a))throw new TypeError;return c=x.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(x.call(arguments)));B.prototype=a.prototype;var e=new B;B.prototype=null;var f=a.apply(e,c.concat(x.call(arguments)));return Object(f)===f?f:e}},c._=q;var C=a("../vendor/observe-js/src/observe").Platform;c.next=function(a){C.performMicrotaskCheckpoint(),setTimeout(a)},c.constructCallbackAndPromiseHandler=function(a,b){return function(c){a&&a.apply(a,arguments),b&&(c?b.reject(c):b.resolve.apply(b,Array.prototype.slice.call(arguments,1)))}}},{"../vendor/observe-js/src/observe":24}],24:[function(require,module,exports){(function(global){!function(global){"use strict";function detectObjectObserve(){function a(a){b=a}if("function"!=typeof Object.observe||"function"!=typeof Array.observe)return!1;var b=[],c={},d=[];return Object.observe(c,a),Array.observe(d,a),c.id=1,c.id=2,delete c.id,d.push(1,2),d.length=0,Object.deliverChangeRecords(a),5!==b.length?!1:"add"!=b[0].type||"update"!=b[1].type||"delete"!=b[2].type||"splice"!=b[3].type||"splice"!=b[4].type?!1:(Object.unobserve(c,a),Array.unobserve(d,a),!0)}function detectEval(){if("undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime)return!1;if(navigator.getDeviceStorage)return!1;try{var a=new Function("","return true;");return a()}catch(b){return!1}}function isIndex(a){return+a===a>>>0&&""!==a}function toNumber(a){return+a}function isObject(a){return a===Object(a)}function areSameValue(a,b){return a===b?0!==a||1/a===1/b:numberIsNaN(a)&&numberIsNaN(b)?!0:a!==a&&b!==b}function getPathCharType(a){if(void 0===a)return"eof";var b=a.charCodeAt(0);switch(b){case 91:case 93:case 46:case 34:case 39:case 48:return a;case 95:case 36:return"ident";case 32:case 9:case 10:case 13:case 160:case 65279:case 8232:case 8233:return"ws"}return b>=97&&122>=b||b>=65&&90>=b?"ident":b>=49&&57>=b?"number":"else"}function noop(){}function parsePath(a){function b(){if(!(k>=a.length)){var b=a[k+1];return"inSingleQuote"==l&&"'"==b||"inDoubleQuote"==l&&'"'==b?(k++,d=b,m.append(),!0):void 0}}for(var c,d,e,f,g,h,i,j=[],k=-1,l="beforePath",m={push:function(){void 0!==e&&(j.push(e),e=void 0)},append:function(){void 0===e?e=d:e+=d}};l;)if(k++,c=a[k],"\\"!=c||!b(l)){if(f=getPathCharType(c),i=pathStateMachine[l],g=i[f]||i["else"]||"error","error"==g)return;if(l=g[0],h=m[g[1]]||noop,d=void 0===g[2]?c:g[2],h(),"afterPath"===l)return j}}function isIdent(a){return identRegExp.test(a)}function Path(a,b){if(b!==constructorIsPrivate)throw Error("Use Path.get to retrieve path objects");for(var c=0;c<a.length;c++)this.push(String(a[c]));hasEval&&this.length&&(this.getValueFrom=this.compiledGetValueFromFn())}function getPath(a){if(a instanceof Path)return a;if((null==a||0==a.length)&&(a=""),"string"!=typeof a){if(isIndex(a.length))return new Path(a,constructorIsPrivate);a=String(a)}var b=pathCache[a];if(b)return b;var c=parsePath(a);if(!c)return invalidPath;var b=new Path(c,constructorIsPrivate);return pathCache[a]=b,b}function formatAccessor(a){return isIndex(a)?"["+a+"]":'["'+a.replace(/"/g,'\\"')+'"]'}function dirtyCheck(a){for(var b=0;MAX_DIRTY_CHECK_CYCLES>b&&a.check_();)b++;return testingExposeCycleCount&&(global.dirtyCheckCycleCount=b),b>0}function objectIsEmpty(a){for(var b in a)return!1;return!0}function diffIsEmpty(a){return objectIsEmpty(a.added)&&objectIsEmpty(a.removed)&&objectIsEmpty(a.changed)}function diffObjectFromOldObject(a,b){var c={},d={},e={};for(var f in b){var g=a[f];(void 0===g||g!==b[f])&&(f in a?g!==b[f]&&(e[f]=g):d[f]=void 0)}for(var f in a)f in b||(c[f]=a[f]);return Array.isArray(a)&&a.length!==b.length&&(e.length=a.length),{added:c,removed:d,changed:e}}function runEOMTasks(){if(!eomTasks.length)return!1;for(var a=0;a<eomTasks.length;a++)eomTasks[a]();return eomTasks.length=0,!0}function newObservedObject(){function a(a){b&&b.state_===OPENED&&!d&&b.check_(a)}var b,c,d=!1,e=!0;return{open:function(c){if(b)throw Error("ObservedObject in use");e||Object.deliverChangeRecords(a),b=c,e=!1},observe:function(b,d){c=b,d?Array.observe(c,a):Object.observe(c,a)},deliver:function(b){d=b,Object.deliverChangeRecords(a),d=!1},close:function(){b=void 0,Object.unobserve(c,a),observedObjectCache.push(this)}}}function getObservedObject(a,b,c){var d=observedObjectCache.pop()||newObservedObject();return d.open(a),d.observe(b,c),d}function newObservedSet(){function a(b,f){b&&(b===d&&(e[f]=!0),h.indexOf(b)<0&&(h.push(b),Object.observe(b,c)),a(Object.getPrototypeOf(b),f))}function b(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.object!==d||e[c.name]||"setPrototype"===c.type)return!1}return!0}function c(c){if(!b(c)){for(var d,e=0;e<g.length;e++)d=g[e],d.state_==OPENED&&d.iterateObjects_(a);for(var e=0;e<g.length;e++)d=g[e],d.state_==OPENED&&d.check_()}}var d,e,f=0,g=[],h=[],i={object:void 0,objects:h,open:function(b,c){d||(d=c,e={}),g.push(b),f++,b.iterateObjects_(a)},close:function(){if(f--,!(f>0)){for(var a=0;a<h.length;a++)Object.unobserve(h[a],c),Observer.unobservedCount++;g.length=0,h.length=0,d=void 0,e=void 0,observedSetCache.push(this)}}};return i}function getObservedSet(a,b){return lastObservedSet&&lastObservedSet.object===b||(lastObservedSet=observedSetCache.pop()||newObservedSet(),lastObservedSet.object=b),lastObservedSet.open(a,b),lastObservedSet}function Observer(){this.state_=UNOPENED,this.callback_=void 0,this.target_=void 0,this.directObserver_=void 0,this.value_=void 0,this.id_=nextObserverId++}function addToAll(a){Observer._allObserversCount++,collectObservers&&allObservers.push(a)}function removeFromAll(){Observer._allObserversCount--}function ObjectObserver(a){Observer.call(this),this.value_=a,this.oldObject_=void 0}function ArrayObserver(a){if(!Array.isArray(a))throw Error("Provided object is not an Array");ObjectObserver.call(this,a)}function PathObserver(a,b){Observer.call(this),this.object_=a,this.path_=getPath(b),this.directObserver_=void 0}function CompoundObserver(a){Observer.call(this),this.reportChangesOnOpen_=a,this.value_=[],this.directObserver_=void 0,this.observed_=[]}function identFn(a){return a}function ObserverTransform(a,b,c,d){this.callback_=void 0,this.target_=void 0,this.value_=void 0,this.observable_=a,this.getValueFn_=b||identFn,this.setValueFn_=c||identFn,this.dontPassThroughSet_=d}function diffObjectFromChangeRecords(a,b,c){for(var d={},e={},f=0;f<b.length;f++){var g=b[f];expectedRecordTypes[g.type]?(g.name in c||(c[g.name]=g.oldValue),"update"!=g.type&&("add"!=g.type?g.name in d?(delete d[g.name],delete c[g.name]):e[g.name]=!0:g.name in e?delete e[g.name]:d[g.name]=!0)):(console.error("Unknown changeRecord type: "+g.type),console.error(g))}for(var h in d)d[h]=a[h];for(var h in e)e[h]=void 0;var i={};for(var h in c)if(!(h in d||h in e)){var j=a[h];c[h]!==j&&(i[h]=j)}return{added:d,removed:e,changed:i}}function newSplice(a,b,c){return{index:a,removed:b,addedCount:c}}function ArraySplice(){}function calcSplices(a,b,c,d,e,f){return arraySplice.calcSplices(a,b,c,d,e,f)}function intersect(a,b,c,d){return c>b||a>d?-1:b==c||d==a?0:c>a?d>b?b-c:d-c:b>d?d-a:b-a}function mergeSplice(a,b,c,d){for(var e=newSplice(b,c,d),f=!1,g=0,h=0;h<a.length;h++){var i=a[h];if(i.index+=g,!f){var j=intersect(e.index,e.index+e.removed.length,i.index,i.index+i.addedCount);if(j>=0){a.splice(h,1),h--,g-=i.addedCount-i.removed.length,e.addedCount+=i.addedCount-j;var k=e.removed.length+i.removed.length-j;if(e.addedCount||k){var c=i.removed;if(e.index<i.index){var l=e.removed.slice(0,i.index-e.index);Array.prototype.push.apply(l,c),c=l}if(e.index+e.removed.length>i.index+i.addedCount){var m=e.removed.slice(i.index+i.addedCount-e.index);Array.prototype.push.apply(c,m)}e.removed=c,i.index<e.index&&(e.index=i.index)}else f=!0}else if(e.index<i.index){f=!0,a.splice(h,0,e),h++;var n=e.addedCount-e.removed.length;i.index+=n,g+=n}}}f||a.push(e)}function createInitialSplices(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];switch(e.type){case"splice":mergeSplice(c,e.index,e.removed.slice(),e.addedCount);break;case"add":case"update":case"delete":if(!isIndex(e.name))continue;var f=toNumber(e.name);if(0>f)continue;mergeSplice(c,f,[e.oldValue],1);break;default:console.error("Unexpected record type: "+JSON.stringify(e))}}return c}function projectArraySplices(a,b){var c=[];return createInitialSplices(a,b).forEach(function(b){return 1==b.addedCount&&1==b.removed.length?void(b.removed[0]!==a[b.index]&&c.push(b)):void(c=c.concat(calcSplices(a,b.index,b.index+b.addedCount,b.removed,0,b.removed.length)))}),c}var testingExposeCycleCount=global.testingExposeCycleCount,hasObserve=detectObjectObserve(),hasEval=detectEval(),numberIsNaN=global.Number.isNaN||function(a){return"number"==typeof a&&global.isNaN(a)},createObject="__proto__"in{}?function(a){return a}:function(a){var b=a.__proto__;if(!b)return a;var c=Object.create(b);return Object.getOwnPropertyNames(a).forEach(function(b){Object.defineProperty(c,b,Object.getOwnPropertyDescriptor(a,b))}),c},identStart="[$_a-zA-Z]",identPart="[$_a-zA-Z0-9]",identRegExp=new RegExp("^"+identStart+"+"+identPart+"*$"),pathStateMachine={beforePath:{ws:["beforePath"],ident:["inIdent","append"],"[":["beforeElement"],eof:["afterPath"]},inPath:{ws:["inPath"],".":["beforeIdent"],"[":["beforeElement"],eof:["afterPath"]},beforeIdent:{ws:["beforeIdent"],ident:["inIdent","append"]},inIdent:{ident:["inIdent","append"],0:["inIdent","append"],number:["inIdent","append"],ws:["inPath","push"],".":["beforeIdent","push"],"[":["beforeElement","push"],eof:["afterPath","push"]},beforeElement:{ws:["beforeElement"],0:["afterZero","append"],number:["inIndex","append"],"'":["inSingleQuote","append",""],'"':["inDoubleQuote","append",""]},afterZero:{ws:["afterElement","push"],"]":["inPath","push"]},inIndex:{0:["inIndex","append"],number:["inIndex","append"],ws:["afterElement"],"]":["inPath","push"]},inSingleQuote:{"'":["afterElement"],eof:["error"],"else":["inSingleQuote","append"]},inDoubleQuote:{'"':["afterElement"],eof:["error"],"else":["inDoubleQuote","append"]},afterElement:{ws:["afterElement"],"]":["inPath","push"]}},constructorIsPrivate={},pathCache={};Path.get=getPath,Path.prototype=createObject({__proto__:[],valid:!0,toString:function(){for(var a="",b=0;b<this.length;b++){var c=this[b];a+=isIdent(c)?b?"."+c:c:formatAccessor(c)}return a},getValueFrom:function(a){for(var b=0;b<this.length;b++){if(null==a)return;a=a[this[b]]}return a},iterateObjects:function(a,b){for(var c=0;c<this.length;c++){if(c&&(a=a[this[c-1]]),!isObject(a))return;b(a,this[0])}},compiledGetValueFromFn:function(){var a="",b="obj";a+="if (obj != null";for(var c,d=0;d<this.length-1;d++)c=this[d],b+=isIdent(c)?"."+c:formatAccessor(c),a+=" &&\n     "+b+" != null";a+=")\n";var c=this[d];return b+=isIdent(c)?"."+c:formatAccessor(c),a+="  return "+b+";\nelse\n  return undefined;",new Function("obj",a)},setValueFrom:function(a,b){if(!this.length)return!1;for(var c=0;c<this.length-1;c++){if(!isObject(a))return!1;a=a[this[c]]}return isObject(a)?(a[this[c]]=b,!0):!1}});var invalidPath=new Path("",constructorIsPrivate);invalidPath.valid=!1,invalidPath.getValueFrom=invalidPath.setValueFrom=function(){};var MAX_DIRTY_CHECK_CYCLES=1e3,eomTasks=[],runEOM=hasObserve?function(){var a={pingPong:!0},b=!1;return Object.observe(a,function(){runEOMTasks(),b=!1}),function(c){eomTasks.push(c),b||(b=!0,a.pingPong=!a.pingPong)}}():function(){return function(a){eomTasks.push(a)}}(),observedObjectCache=[],observedSetCache=[],lastObservedSet,UNOPENED=0,OPENED=1,CLOSED=2,RESETTING=3,nextObserverId=1;Observer.prototype={open:function(a,b){if(this.state_!=UNOPENED)throw Error("Observer has already been opened.");return addToAll(this),this.callback_=a,this.target_=b,this.connect_(),this.state_=OPENED,this.value_},close:function(){this.state_==OPENED&&(removeFromAll(this),this.disconnect_(),this.value_=void 0,this.callback_=void 0,this.target_=void 0,this.state_=CLOSED)},deliver:function(){this.state_==OPENED&&dirtyCheck(this)},report_:function(a){try{this.callback_.apply(this.target_,a)}catch(b){Observer._errorThrownDuringCallback=!0,console.error("Exception caught during observer callback: "+(b.stack||b))}},discardChanges:function(){return this.check_(void 0,!0),this.value_}};var collectObservers=!hasObserve,allObservers;Observer._allObserversCount=0,collectObservers&&(allObservers=[]);var runningMicrotaskCheckpoint=!1,hasDebugForceFullDelivery=hasObserve&&hasEval&&function(){try{return eval("%RunMicrotasks()"),!0}catch(ex){return!1}}();global.Platform=global.Platform||{},global.Platform.performMicrotaskCheckpoint=function(){if(!runningMicrotaskCheckpoint){if(hasDebugForceFullDelivery)return void eval("%RunMicrotasks()");if(collectObservers){runningMicrotaskCheckpoint=!0;var cycles=0,anyChanged,toCheck;do{cycles++,toCheck=allObservers,allObservers=[],anyChanged=!1;for(var i=0;i<toCheck.length;i++){var observer=toCheck[i];observer.state_==OPENED&&(observer.check_()&&(anyChanged=!0),allObservers.push(observer))}runEOMTasks()&&(anyChanged=!0)}while(MAX_DIRTY_CHECK_CYCLES>cycles&&anyChanged);testingExposeCycleCount&&(global.dirtyCheckCycleCount=cycles),runningMicrotaskCheckpoint=!1}}},collectObservers&&(global.Platform.clearObservers=function(){allObservers=[]}),ObjectObserver.prototype=createObject({__proto__:Observer.prototype,arrayObserve:!1,connect_:function(){hasObserve?this.directObserver_=getObservedObject(this,this.value_,this.arrayObserve):this.oldObject_=this.copyObject(this.value_)},copyObject:function(a){var b=Array.isArray(a)?[]:{};for(var c in a)b[c]=a[c];return Array.isArray(a)&&(b.length=a.length),b},check_:function(a){var b,c;if(hasObserve){if(!a)return!1;c={},b=diffObjectFromChangeRecords(this.value_,a,c)}else c=this.oldObject_,b=diffObjectFromOldObject(this.value_,this.oldObject_);return diffIsEmpty(b)?!1:(hasObserve||(this.oldObject_=this.copyObject(this.value_)),this.report_([b.added||{},b.removed||{},b.changed||{},function(a){return c[a]}]),!0)},disconnect_:function(){hasObserve?(this.directObserver_.close(),this.directObserver_=void 0):this.oldObject_=void 0},deliver:function(){this.state_==OPENED&&(hasObserve?this.directObserver_.deliver(!1):dirtyCheck(this))},discardChanges:function(){return this.directObserver_?this.directObserver_.deliver(!0):this.oldObject_=this.copyObject(this.value_),this.value_}}),ArrayObserver.prototype=createObject({__proto__:ObjectObserver.prototype,arrayObserve:!0,copyObject:function(a){return a.slice()},check_:function(a){var b;if(hasObserve){if(!a)return!1;b=projectArraySplices(this.value_,a)}else b=calcSplices(this.value_,0,this.value_.length,this.oldObject_,0,this.oldObject_.length);return b&&b.length?(hasObserve||(this.oldObject_=this.copyObject(this.value_)),this.report_([b]),!0):!1}}),ArrayObserver.applySplices=function(a,b,c){c.forEach(function(c){for(var d=[c.index,c.removed.length],e=c.index;e<c.index+c.addedCount;)d.push(b[e]),e++;Array.prototype.splice.apply(a,d)})},PathObserver.prototype=createObject({__proto__:Observer.prototype,get path(){return this.path_},connect_:function(){hasObserve&&(this.directObserver_=getObservedSet(this,this.object_)),this.check_(void 0,!0)},disconnect_:function(){this.value_=void 0,this.directObserver_&&(this.directObserver_.close(this),this.directObserver_=void 0)},iterateObjects_:function(a){this.path_.iterateObjects(this.object_,a)},check_:function(a,b){var c=this.value_;return this.value_=this.path_.getValueFrom(this.object_),b||areSameValue(this.value_,c)?!1:(this.report_([this.value_,c,this]),!0)},setValue:function(a){this.path_&&this.path_.setValueFrom(this.object_,a)}});var observerSentinel={};CompoundObserver.prototype=createObject({__proto__:Observer.prototype,connect_:function(){if(hasObserve){for(var a,b=!1,c=0;c<this.observed_.length;c+=2)if(a=this.observed_[c],a!==observerSentinel){b=!0;break}b&&(this.directObserver_=getObservedSet(this,a))}this.check_(void 0,!this.reportChangesOnOpen_)},disconnect_:function(){for(var a=0;a<this.observed_.length;a+=2)this.observed_[a]===observerSentinel&&this.observed_[a+1].close();this.observed_.length=0,this.value_.length=0,this.directObserver_&&(this.directObserver_.close(this),this.directObserver_=void 0)},addPath:function(a,b){if(this.state_!=UNOPENED&&this.state_!=RESETTING)throw Error("Cannot add paths once started.");var b=getPath(b);if(this.observed_.push(a,b),this.reportChangesOnOpen_){var c=this.observed_.length/2-1;this.value_[c]=b.getValueFrom(a)}},addObserver:function(a){if(this.state_!=UNOPENED&&this.state_!=RESETTING)throw Error("Cannot add observers once started.");if(this.observed_.push(observerSentinel,a),this.reportChangesOnOpen_){var b=this.observed_.length/2-1;this.value_[b]=a.open(this.deliver,this)}},startReset:function(){if(this.state_!=OPENED)throw Error("Can only reset while open");this.state_=RESETTING,this.disconnect_()},finishReset:function(){if(this.state_!=RESETTING)throw Error("Can only finishReset after startReset");return this.state_=OPENED,this.connect_(),this.value_},iterateObjects_:function(a){for(var b,c=0;c<this.observed_.length;c+=2)b=this.observed_[c],b!==observerSentinel&&this.observed_[c+1].iterateObjects(b,a)},check_:function(a,b){for(var c,d=0;d<this.observed_.length;d+=2){var e,f=this.observed_[d],g=this.observed_[d+1];if(f===observerSentinel){var h=g;e=this.state_===UNOPENED?h.open(this.deliver,this):h.discardChanges()}else e=g.getValueFrom(f);b?this.value_[d/2]=e:areSameValue(e,this.value_[d/2])||(c=c||[],c[d/2]=this.value_[d/2],this.value_[d/2]=e)}return c?(this.report_([this.value_,c,this.observed_]),!0):!1}}),ObserverTransform.prototype={open:function(a,b){return this.callback_=a,this.target_=b,this.value_=this.getValueFn_(this.observable_.open(this.observedCallback_,this)),this.value_},observedCallback_:function(a){if(a=this.getValueFn_(a),!areSameValue(a,this.value_)){var b=this.value_;this.value_=a,this.callback_.call(this.target_,this.value_,b)}},discardChanges:function(){return this.value_=this.getValueFn_(this.observable_.discardChanges()),this.value_},deliver:function(){return this.observable_.deliver()},setValue:function(a){return a=this.setValueFn_(a),!this.dontPassThroughSet_&&this.observable_.setValue?this.observable_.setValue(a):void 0},close:function(){this.observable_&&this.observable_.close(),this.callback_=void 0,this.target_=void 0,this.observable_=void 0,this.value_=void 0,this.getValueFn_=void 0,this.setValueFn_=void 0}};var expectedRecordTypes={add:!0,update:!0,"delete":!0},EDIT_LEAVE=0,EDIT_UPDATE=1,EDIT_ADD=2,EDIT_DELETE=3;ArraySplice.prototype={calcEditDistances:function(a,b,c,d,e,f){for(var g=f-e+1,h=c-b+1,i=new Array(g),j=0;g>j;j++)i[j]=new Array(h),i[j][0]=j;for(var k=0;h>k;k++)i[0][k]=k;for(var j=1;g>j;j++)for(var k=1;h>k;k++)if(this.equals(a[b+k-1],d[e+j-1]))i[j][k]=i[j-1][k-1];else{var l=i[j-1][k]+1,m=i[j][k-1]+1;i[j][k]=m>l?l:m}return i},spliceOperationsFromEditDistances:function(a){for(var b=a.length-1,c=a[0].length-1,d=a[b][c],e=[];b>0||c>0;)if(0!=b)if(0!=c){var f,g=a[b-1][c-1],h=a[b-1][c],i=a[b][c-1];f=i>h?g>h?h:g:g>i?i:g,f==g?(g==d?e.push(EDIT_LEAVE):(e.push(EDIT_UPDATE),d=g),b--,c--):f==h?(e.push(EDIT_DELETE),b--,d=h):(e.push(EDIT_ADD),c--,d=i)}else e.push(EDIT_DELETE),b--;else e.push(EDIT_ADD),c--;return e.reverse(),e},calcSplices:function(a,b,c,d,e,f){var g=0,h=0,i=Math.min(c-b,f-e);if(0==b&&0==e&&(g=this.sharedPrefix(a,d,i)),c==a.length&&f==d.length&&(h=this.sharedSuffix(a,d,i-g)),b+=g,e+=g,c-=h,f-=h,c-b==0&&f-e==0)return[];if(b==c){for(var j=newSplice(b,[],0);f>e;)j.removed.push(d[e++]);return[j]}if(e==f)return[newSplice(b,[],c-b)];for(var k=this.spliceOperationsFromEditDistances(this.calcEditDistances(a,b,c,d,e,f)),j=void 0,l=[],m=b,n=e,o=0;o<k.length;o++)switch(k[o]){case EDIT_LEAVE:j&&(l.push(j),j=void 0),m++,n++;break;case EDIT_UPDATE:j||(j=newSplice(m,[],0)),j.addedCount++,m++,j.removed.push(d[n]),n++;break;case EDIT_ADD:j||(j=newSplice(m,[],0)),j.addedCount++,m++;break;case EDIT_DELETE:j||(j=newSplice(m,[],0)),j.removed.push(d[n]),n++}return j&&l.push(j),l},sharedPrefix:function(a,b,c){for(var d=0;c>d;d++)if(!this.equals(a[d],b[d]))return d;return c},sharedSuffix:function(a,b,c){for(var d=a.length,e=b.length,f=0;c>f&&this.equals(a[--d],b[--e]);)f++;return f},calculateSplices:function(a,b){return this.calcSplices(a,0,a.length,b,0,b.length)},equals:function(a,b){return a===b}};var arraySplice=new ArraySplice,expose=global;"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(expose=exports=module.exports),expose=exports),expose.Observer=Observer,expose.Observer.runEOM_=runEOM,expose.Observer.observerSentinel_=observerSentinel,expose.Observer.hasObjectObserve=hasObserve,expose.ArrayObserver=ArrayObserver,expose.ArrayObserver.calculateSplices=function(a,b){return arraySplice.calculateSplices(a,b)},expose.Platform=global.Platform,expose.ArraySplice=ArraySplice,expose.ObjectObserver=ObjectObserver,expose.PathObserver=PathObserver,expose.CompoundObserver=CompoundObserver,expose.Path=Path,expose.ObserverTransform=ObserverTransform}("undefined"!=typeof global&&global&&"undefined"!=typeof module&&module?global:this||window)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],25:[function(a,b){function c(a){return this?(this.name=a,this.trace=d(this,_.bind(console.debug?console.debug:console.log,console),c.Level.trace),this.debug=d(this,_.bind(console.debug?console.debug:console.log,console),c.Level.debug),this.info=d(this,_.bind(console.info?console.info:console.log,console),c.Level.info),this.log=d(this,_.bind(console.log?console.log:console.log,console),c.Level.info),this.warn=d(this,_.bind(console.warn?console.warn:console.log,console),c.Level.warning),this.error=d(this,_.bind(console.error?console.error:console.log,console),c.Level.error),void(this.fatal=d(this,_.bind(console.error?console.error:console.log,console),c.Level.fatal))):new c(a)}function d(a,b,c){var d=function(d){a.performLog(b,c,d,arguments)};return Object.defineProperty(d,"isEnabled",{get:function(){var b=a.currentLevel();return c>=b},enumerable:!0,configurable:!0}),d.f=b,d.logger=a,d.level=c,d}var e={};c.Level={trace:0,debug:1,info:2,warning:3,warn:3,error:4,fatal:5},c.LevelText={},c.LevelText[c.Level.trace]="TRACE",c.LevelText[c.Level.debug]="DEBUG",c.LevelText[c.Level.info]="INFO ",c.LevelText[c.Level.warning]="WARN ",c.LevelText[c.Level.error]="ERROR",c.levelAsText=function(a){return this.LevelText[a]},c.loggerWithName=function(a){return new c(a)},c.prototype.currentLevel=function(){var a=e[this.name];return a?a:c.Level.trace},c.prototype.setLevel=function(a){e[this.name]=a},c.prototype.override=function(a,b,d){var e=c.levelAsText(a),f=this[e.trim().toLowerCase()],g=f.f,h=Array.prototype.slice.call(arguments,3,arguments.length);this.performLog(g,a,d,h,b)},c.prototype.performLog=function(a,b,d,e,f){var g=this,h=void 0!==f?f:this.currentLevel();if(b>=h){a=_.partial(a,c.levelAsText(b)+" ["+g.name+"]: "+d);for(var i=[],j=0;j<e.length;j++)i[j]=e[j];i.splice(0,1),a.apply(a,i)}},b.exports=c},{}],26:[function(a,b){function c(){if(!this)return new(Function.prototype.bind.apply(c,arguments));var a=this;arguments.length&&("string"==typeof arguments[0]?(this.name=arguments[0],this.work=arguments[1],this.completion=arguments[2]):("function"==typeof arguments[0]||"[object Array]"===Object.prototype.toString.call(arguments[0])||arguments[0]instanceof c)&&(this.work=arguments[0],this.completion=arguments[1])),this.error=null,this.completed=!1,this.result=null,this.running=!1,this.cancelled=!1,this.dependencies=[],this._mustSucceed=[],this._onCompletion=[],this.logLevel=null,Object.defineProperty(this,"failed",{get:function(){return!!a.error||a.failedDueToDependency
},enumerable:!0,configurable:!0}),Object.defineProperty(this,"composite",{get:function(){return a.work instanceof c||"[object Array]"===Object.prototype.toString.call(a.work)},enumerable:!0,configurable:!0}),Object.defineProperty(this,"numOperationsRemaining",{get:function(){return a.work instanceof c?a.work.completed?0:1:"[object Array]"===Object.prototype.toString.call(a.work)?_.reduce(a.work,function(a,b){return b.completed?a:a+1},0):null},enumerable:!0,configurable:!0}),Object.defineProperty(this,"canRun",{get:function(){return a.dependencies.length?_.reduce(a.dependencies,function(b,c){var d=a._mustSucceed.indexOf(c)>-1,e=b&&c.completed;return d&&e&&(e=e&&!(c.failed||c.cancelled)),e},!0):!0},enumerable:!0,configurable:!0}),Object.defineProperty(this,"failedDueToDependency",{get:function(){if(a.dependencies.length){var b=_.reduce(a.dependencies,function(b,c){var d=a._mustSucceed.indexOf(c)>-1,e=(c.failed||c.cancelled)&&d;return e&&b.push(c),b},[]);return b.length?b:!1}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(this,"failedDueToCancellationOfDependency",{get:function(){if(a.dependencies.length){var b=_.reduce(a.dependencies,function(b,c){var d=a._mustSucceed.indexOf(c)>-1;return d&&c.cancelled&&b.push(c),b},[]);return b.length?b:!1}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(this,"loggingOveridden",{get:function(){return a.logLevel?a.logLevel<=d.Level.info:!1},enumerable:!0,configurable:!0})}var d=a("./log"),e=d.loggerWithName("Operation");c.running=[],c.prototype._startSingle=function(){var a=this;this.work(function(b,c){a.result=c,a.error=b,a.completed=!0,a.running=!1,a._complete()})},c.prototype._startComposite=function(){var a=this,b=a.work instanceof c?[a.work]:a.work;_.each(b,function(c){c.onCompletion(function(){var c=a.numOperationsRemaining,d=a.name||"Unnamed";if(e.debug(d+" has "+c.toString()+" operations remaining"),!c){var f=_.pluck(b,"error"),g=_.pluck(b,"result");a.result=_.some(g)?g:null,a.error=_.some(f)?f:null,a.completed=!0,a.running=!1,a._complete()}}),c.start()})},c.prototype._logCompletion=function(){var a=this._getLogFunc();if(e.info.isEnabled||this.loggingOveridden){var b=this.name||"Unnamed",c=this.failedDueToDependency;if(c)a('"'+b+'" failed due to failure/cancellation of dependencies: '+_.pluck(c,"name").join(", "));else if(this.failed){var d=this.error;d="[object Array]"===Object.prototype.toString.call(d)?_.filter(d,function(a){return a}):[this.error],a('"'+b+'" failed due to errors:',d)}else a(this.cancelled?'"'+b+'" has been cancelled.':'"'+b+'" has succeeded.')}},c.prototype._getLogFunc=function(){return this.logLevel?_.bind(e.override,e,d.Level.info,this.logLevel):e.info},c.prototype._logStart=function(){if(e.info.isEnabled||this.loggingOveridden){var a=this.name||"Unnamed",b=this._getLogFunc();b('"'+a+'" has started.')}},c.prototype._complete=function(){var a=this;this.completed=!0;var b=c.running.indexOf(this);c.running.splice(b,1),this.completion&&_.bind(this.completion,this)(),this._logCompletion(),_.each(this._onCompletion,function(b){_.bind(b,a)()})},c.prototype.__start=function(){this._logStart(),this.work?(this.composite?this._startComposite():this._startSingle(),c.running.push(this)):(this.result=null,this.error=null,this.running=!1,this._complete())},c.prototype.start=function(){var a=this,b=!this.running&&!this.completed,c=b&&this.failed;c?this._complete():b&&(this.running=!0,this.canRun?this.__start():_.each(this.dependencies,function(b){b.onCompletion(function(){a.canRun&&a.__start()})}))},c.prototype.addDependency=function(){var a=this;if(1==arguments.length)this.dependencies.push(arguments[0]);else if(arguments.length){var b=arguments,c=b[b.length-1],d=!1;"boolean"==typeof c&&(b=Array.prototype.slice.call(b,0,b.length-1),d=c),_.each(b,function(b){a.dependencies.push(b)}),d&&_.each(b,function(b){a._mustSucceed.push(b)})}},c.prototype.onCompletion=function(a){this.completed?_.bind(a,this)():this._onCompletion.push(a)},c.prototype.cancel=function(a){this.cancelled||(this.cancelled=!0,e.debug("Cancelling "+this.name,this),this.composite&&_.each(this.work,function(a){a.cancel()}),this.onCompletion(function(){this.running=!1,a&&a()}))},Object.defineProperty(c,"logLevel",{get:function(){return e.currentLevel()},set:function(a){e.setLevel(a)},configurable:!0,enumerable:!0}),b.exports.Operation=c},{"./log":25}],27:[function(a,b){function c(){if(!this)return new(Function.prototype.bind.apply(c,arguments));var a=this;arguments.length&&("number"==typeof arguments[0]?this.maxConcurrentOperations=arguments[0]:(this.name=arguments[0],this.maxConcurrentOperations=arguments[1])),this._queuedOperations=[],this._runningOperations=[],this._running=!1,this._onStart=[],this._onStop=[],this.logLevel=null,Object.defineProperty(this,"numRunningOperations",{get:function(){return a._runningOperations.length},configurable:!0,enumerable:!0}),Object.defineProperty(this,"loggingOveridden",{get:function(){return a.logLevel?a.logLevel<=d.Level.info:!1},enumerable:!0,configurable:!0})}var d=a("./log"),e=d.loggerWithName("OperationQueue");c.prototype._nextOperations=function(){for(var a=this;a._runningOperations.length<a.maxConcurrentOperations&&a._queuedOperations.length;){var b=a._queuedOperations[0];a._queuedOperations.splice(0,1),a._runOperation(b)}},c.prototype._runOperation=function(a){for(var b=this,c=0;c<this._queuedOperations.length;c++)if(this._queuedOperations[c]==a){this._queuedOperations.splice(c,1);break}this._runningOperations.push(a),a.completion=function(){var c=b._runningOperations.indexOf(a);b._runningOperations.splice(c,1),b._running&&b._nextOperations(),b._logStatus()},a.start(),this._logStatus()},c.prototype._logStatus=function(){var a=this._getLogFunc();if(e.info.isEnabled||this.loggingOveridden){var b=this.numRunningOperations,c=this._queuedOperations.length,d=this.name||"Unnamed Queue";a(b&&c?'"'+d+'" now has '+b.toString()+" operations running and "+c.toString()+" operations queued":b?'"'+d+'" now has '+b.toString()+" operations running":c?'"'+d+'" now has '+c.toString()+" operations queued":'"'+d+'" has no operations running or queued')}},c.prototype._logStart=function(){var a=this._getLogFunc();if(e.info.isEnabled||this.loggingOveridden){var b=this.name||"Unnamed Queue";a('"'+b+'" is now running')}},c.prototype._getLogFunc=function(){return this.logLevel?_.bind(e.override,e,d.Level.info,this.logLevel):e.info},c.prototype._logStop=function(){var a=this._getLogFunc();if(e.info.isEnabled||this.loggingOveridden){var b=this.name||"Unnamed Queue";a('"'+b+'" is no longer running')}},c.prototype._addOperation=function(a){this.numRunningOperations<this.maxConcurrentOperations&&this._running?this._runOperation(a):this._queuedOperations.push(a),this._logStatus()},c.prototype.addOperation=function(a){var b=this;"[object Array]"===Object.prototype.toString.call(a)?_.each(a,function(a){b._addOperation(a)}):this._addOperation(a)},c.prototype.start=function(){var a=this,b=this._running;this._running=!0,b||(_.each(a._onStart,function(b){_.bind(b,a)()}),a._nextOperations(),a._logStart())},c.prototype.stop=function(a){var b=this,c=this._running;if(this._running=!1,c){if(a){var d=this._runningOperations.slice(0);_.each(d,function(a){a.cancel()})}b._logStop(),_.each(b._onStop,function(a){_.bind(a,b)()})}},c.prototype.onStart=function(a){this._onStart.push(a)},c.prototype.onStop=function(a){this._onStop.push(a)},Object.defineProperty(c,"logLevel",{get:function(){return e.currentLevel()},set:function(a){e.setLevel(a)},configurable:!0,enumerable:!0}),b.exports.OperationQueue=c},{"./log":25}]},{},[1]),function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d;d=d||function(a){"use strict";function b(a,b,c){var d;for(d in l.prototype)l.prototype.hasOwnProperty(d)&&(a[d]=l.prototype[d]);return a.xregexp={captureNames:b,isNative:!!c},a}function d(a){return(a.global?"g":"")+(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.extended?"x":"")+(a.sticky?"y":"")}function e(a,c,e){if(!l.isRegExp(a))throw new TypeError("type RegExp expected");var f=p.replace.call(d(a)+(c||""),x,"");return e&&(f=p.replace.call(f,new RegExp("["+e+"]+","g"),"")),a=a.xregexp&&!a.xregexp.isNative?b(l(a.source,f),a.xregexp.captureNames?a.xregexp.captureNames.slice(0):null):b(new RegExp(a.source,f),null,!0)}function f(a,b){var c=a.length;if(Array.prototype.lastIndexOf)return a.lastIndexOf(b);for(;c--;)if(a[c]===b)return c;return-1}function g(a,b){return Object.prototype.toString.call(a).toLowerCase()==="[object "+b+"]"}function h(a){return a=a||{},"all"===a||a.all?a={natives:!0,extensibility:!0}:g(a,"string")&&(a=l.forEach(a,/[^\s,]+/,function(a){this[a]=!0},{})),a}function i(a,b,c,d){var e,f,g=s.length,h=null;B=!0;try{for(;g--;)if(f=s[g],!("all"!==f.scope&&f.scope!==c||f.trigger&&!f.trigger.call(d))&&(f.pattern.lastIndex=b,e=q.exec.call(f.pattern,a),e&&e.index===b)){h={output:f.handler.call(d,e,c),match:e};break}}catch(i){throw i}finally{B=!1}return h}function j(a){l.addToken=m[a?"on":"off"],o.extensibility=a}function k(a){RegExp.prototype.exec=(a?q:p).exec,RegExp.prototype.test=(a?q:p).test,String.prototype.match=(a?q:p).match,String.prototype.replace=(a?q:p).replace,String.prototype.split=(a?q:p).split,o.natives=a}var l,m,n,o={natives:!1,extensibility:!1},p={exec:RegExp.prototype.exec,test:RegExp.prototype.test,match:String.prototype.match,replace:String.prototype.replace,split:String.prototype.split},q={},r={},s=[],t="default",u="class",v={"default":/^(?:\\(?:0(?:[0-3][0-7]{0,2}|[4-7][0-7]?)?|[1-9]\d*|x[\dA-Fa-f]{2}|u[\dA-Fa-f]{4}|c[A-Za-z]|[\s\S])|\(\?[:=!]|[?*+]\?|{\d+(?:,\d*)?}\??)/,"class":/^(?:\\(?:[0-3][0-7]{0,2}|[4-7][0-7]?|x[\dA-Fa-f]{2}|u[\dA-Fa-f]{4}|c[A-Za-z]|[\s\S]))/},w=/\$(?:{([\w$]+)}|(\d\d?|[\s\S]))/g,x=/([\s\S])(?=[\s\S]*\1)/g,y=/^(?:[?*+]|{\d+(?:,\d*)?})\??/,z=p.exec.call(/()??/,"")[1]===a,A=RegExp.prototype.sticky!==a,B=!1,C="gim"+(A?"y":"");return l=function(c,d){if(l.isRegExp(c)){if(d!==a)throw new TypeError("can't supply flags when constructing one RegExp from another");return e(c)}if(B)throw new Error("can't call the XRegExp constructor within token definition functions");var f,g,h,j=[],k=t,m={hasNamedCapture:!1,captureNames:[],hasFlag:function(a){return d.indexOf(a)>-1}},n=0;if(c=c===a?"":String(c),d=d===a?"":String(d),p.match.call(d,x))throw new SyntaxError("invalid duplicate regular expression flag");for(c=p.replace.call(c,/^\(\?([\w$]+)\)/,function(a,b){if(p.test.call(/[gy]/,b))throw new SyntaxError("can't use flag g or y in mode modifier");return d=p.replace.call(d+b,x,""),""}),l.forEach(d,/[\s\S]/,function(a){if(C.indexOf(a[0])<0)throw new SyntaxError("invalid regular expression flag "+a[0])});n<c.length;)f=i(c,n,k,m),f?(j.push(f.output),n+=f.match[0].length||1):(g=p.exec.call(v[k],c.slice(n)),g?(j.push(g[0]),n+=g[0].length):(h=c.charAt(n),"["===h?k=u:"]"===h&&(k=t),j.push(h),++n));return b(new RegExp(j.join(""),p.replace.call(d,/[^gimy]+/g,"")),m.hasNamedCapture?m.captureNames:null)},m={on:function(a,b,c){c=c||{},a&&s.push({pattern:e(a,"g"+(A?"y":"")),handler:b,scope:c.scope||t,trigger:c.trigger||null}),c.customFlags&&(C=p.replace.call(C+c.customFlags,x,""))},off:function(){throw new Error("extensibility must be installed before using addToken")}},l.addToken=m.off,l.cache=function(a,b){var c=a+"/"+(b||"");return r[c]||(r[c]=l(a,b))},l.escape=function(a){return p.replace.call(a,/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},l.exec=function(a,b,c,d){var f,g=e(b,"g"+(d&&A?"y":""),d===!1?"y":"");return g.lastIndex=c=c||0,f=q.exec.call(g,a),d&&f&&f.index!==c&&(f=null),b.global&&(b.lastIndex=f?g.lastIndex:0),f},l.forEach=function(a,b,c,d){for(var e,f=0,g=-1;e=l.exec(a,b,f);)c.call(d,e,++g,a,b),f=e.index+(e[0].length||1);return d},l.globalize=function(a){return e(a,"g")},l.install=function(a){a=h(a),!o.natives&&a.natives&&k(!0),!o.extensibility&&a.extensibility&&j(!0)},l.isInstalled=function(a){return!!o[a]},l.isRegExp=function(a){return g(a,"regexp")},l.matchChain=function(a,b){return function c(a,d){var e,f=b[d].regex?b[d]:{regex:b[d]},g=[],h=function(a){g.push(f.backref?a[f.backref]||"":a[0])};for(e=0;e<a.length;++e)l.forEach(a[e],f.regex,h);return d!==b.length-1&&g.length?c(g,d+1):g}([a],0)},l.replace=function(b,c,d,f){var g,h=l.isRegExp(c),i=c;return h?(f===a&&c.global&&(f="all"),i=e(c,"all"===f?"g":"","all"===f?"":"g")):"all"===f&&(i=new RegExp(l.escape(String(c)),"g")),g=q.replace.call(String(b),i,d),h&&c.global&&(c.lastIndex=0),g},l.split=function(a,b,c){return q.split.call(a,b,c)},l.test=function(a,b,c,d){return!!l.exec(a,b,c,d)},l.uninstall=function(a){a=h(a),o.natives&&a.natives&&k(!1),o.extensibility&&a.extensibility&&j(!1)},l.union=function(a,b){var c,d,e,f,h=/(\()(?!\?)|\\([1-9]\d*)|\\[\s\S]|\[(?:[^\\\]]|\\[\s\S])*]/g,i=0,j=function(a,b,e){var f=d[i-c];if(b){if(++i,f)return"(?<"+f+">"}else if(e)return"\\"+(+e+c);return a},k=[];if(!g(a,"array")||!a.length)throw new TypeError("patterns must be a nonempty array");for(f=0;f<a.length;++f)e=a[f],l.isRegExp(e)?(c=i,d=e.xregexp&&e.xregexp.captureNames||[],k.push(l(e.source).source.replace(h,j))):k.push(l.escape(e));return l(k.join("|"),b)},l.version="2.0.0",q.exec=function(b){var c,e,g,h,i;if(this.global||(h=this.lastIndex),c=p.exec.apply(this,arguments)){if(!z&&c.length>1&&f(c,"")>-1&&(g=new RegExp(this.source,p.replace.call(d(this),"g","")),p.replace.call(String(b).slice(c.index),g,function(){var b;for(b=1;b<arguments.length-2;++b)arguments[b]===a&&(c[b]=a)})),this.xregexp&&this.xregexp.captureNames)for(i=1;i<c.length;++i)e=this.xregexp.captureNames[i-1],e&&(c[e]=c[i]);this.global&&!c[0].length&&this.lastIndex>c.index&&(this.lastIndex=c.index)}return this.global||(this.lastIndex=h),c},q.test=function(a){return!!q.exec.call(this,a)},q.match=function(a){if(l.isRegExp(a)){if(a.global){var b=p.match.apply(this,arguments);return a.lastIndex=0,b}}else a=new RegExp(a);return q.exec.call(a,this)},q.replace=function(a,b){var c,d,e,h,i=l.isRegExp(a);return i?(a.xregexp&&(c=a.xregexp.captureNames),a.global||(h=a.lastIndex)):a+="",g(b,"function")?d=p.replace.call(String(this),a,function(){var d,e=arguments;if(c)for(e[0]=new String(e[0]),d=0;d<c.length;++d)c[d]&&(e[0][c[d]]=e[d+1]);return i&&a.global&&(a.lastIndex=e[e.length-2]+e[0].length),b.apply(null,e)}):(e=String(this),d=p.replace.call(e,a,function(){var a=arguments;return p.replace.call(String(b),w,function(b,d,e){var g;if(d){if(g=+d,g<=a.length-3)return a[g]||"";if(g=c?f(c,d):-1,0>g)throw new SyntaxError("backreference to undefined group "+b);return a[g+1]||""}if("$"===e)return"$";if("&"===e||0===+e)return a[0];if("`"===e)return a[a.length-1].slice(0,a[a.length-2]);if("'"===e)return a[a.length-1].slice(a[a.length-2]+a[0].length);if(e=+e,!isNaN(e)){if(e>a.length-3)throw new SyntaxError("backreference to undefined group "+b);return a[e]||""}throw new SyntaxError("invalid token "+b)})})),i&&(a.lastIndex=a.global?0:h),d},q.split=function(b,c){if(!l.isRegExp(b))return p.split.apply(this,arguments);var d,e=String(this),f=b.lastIndex,g=[],h=0;return c=(c===a?-1:c)>>>0,l.forEach(e,b,function(a){a.index+a[0].length>h&&(g.push(e.slice(h,a.index)),a.length>1&&a.index<e.length&&Array.prototype.push.apply(g,a.slice(1)),d=a[0].length,h=a.index+d)}),h===e.length?(!p.test.call(b,"")||d)&&g.push(""):g.push(e.slice(h)),b.lastIndex=f,g.length>c?g.slice(0,c):g},n=m.on,n(/\\([ABCE-RTUVXYZaeg-mopqyz]|c(?![A-Za-z])|u(?![\dA-Fa-f]{4})|x(?![\dA-Fa-f]{2}))/,function(a,b){if("B"===a[1]&&b===t)return a[0];throw new SyntaxError("invalid escape "+a[0])},{scope:"all"}),n(/\[(\^?)]/,function(a){return a[1]?"[\\s\\S]":"\\b\\B"}),n(/(?:\(\?#[^)]*\))+/,function(a){return p.test.call(y,a.input.slice(a.index+a[0].length))?"":"(?:)"}),n(/\\k<([\w$]+)>/,function(a){var b=isNaN(a[1])?f(this.captureNames,a[1])+1:+a[1],c=a.index+a[0].length;if(!b||b>this.captureNames.length)throw new SyntaxError("backreference to undefined group "+a[0]);return"\\"+b+(c===a.input.length||isNaN(a.input.charAt(c))?"":"(?:)")}),n(/(?:\s+|#.*)+/,function(a){return p.test.call(y,a.input.slice(a.index+a[0].length))?"":"(?:)"},{trigger:function(){return this.hasFlag("x")},customFlags:"x"}),n(/\./,function(){return"[\\s\\S]"},{trigger:function(){return this.hasFlag("s")},customFlags:"s"}),n(/\(\?P?<([\w$]+)>/,function(a){if(!isNaN(a[1]))throw new SyntaxError("can't use integer as capture name "+a[0]);return this.captureNames.push(a[1]),this.hasNamedCapture=!0,"("}),n(/\\(\d+)/,function(a,b){if(!(b===t&&/^[1-9]/.test(a[1])&&+a[1]<=this.captureNames.length)&&"0"!==a[1])throw new SyntaxError("can't use octal escape or backreference to undefined group "+a[0]);return a[0]},{scope:"all"}),n(/\((?!\?)/,function(){return this.hasFlag("n")?"(?:":(this.captureNames.push(null),"(")},{customFlags:"n"}),"undefined"!=typeof c&&(c.XRegExp=l),l}(),function(a){"use strict";function b(a){return a.replace(/[- _]+/g,"").toLowerCase()}function c(a){return a.replace(/\w{4}/g,"\\u$&")}function d(a){for(;a.length<4;)a="0"+a;return a}function e(a){return parseInt(a,16)}function f(a){return parseInt(a,10).toString(16)}function g(b){var c,g=[],h=-1;return a.forEach(b,/\\u(\w{4})(?:-\\u(\w{4}))?/,function(a){c=e(a[1]),c>h+1&&(g.push("\\u"+d(f(h+1))),c>h+2&&g.push("-\\u"+d(f(c-1)))),h=e(a[2]||a[1])}),65535>h&&(g.push("\\u"+d(f(h+1))),65534>h&&g.push("-\\uFFFF")),g.join("")}function h(a){return i["^"+a]||(i["^"+a]=g(i[a]))}var i={};a.install("extensibility"),a.addUnicodePackage=function(d,e){var f;if(!a.isInstalled("extensibility"))throw new Error("extensibility must be installed before adding Unicode packages");if(d)for(f in d)d.hasOwnProperty(f)&&(i[b(f)]=c(d[f]));if(e)for(f in e)e.hasOwnProperty(f)&&(i[b(e[f])]=i[b(f)])},a.addUnicodePackage({L:"0041-005A0061-007A00AA00B500BA00C0-00D600D8-00F600F8-02C102C6-02D102E0-02E402EC02EE0370-037403760377037A-037D03860388-038A038C038E-03A103A3-03F503F7-0481048A-05270531-055605590561-058705D0-05EA05F0-05F20620-064A066E066F0671-06D306D506E506E606EE06EF06FA-06FC06FF07100712-072F074D-07A507B107CA-07EA07F407F507FA0800-0815081A082408280840-085808A008A2-08AC0904-0939093D09500958-09610971-09770979-097F0985-098C098F09900993-09A809AA-09B009B209B6-09B909BD09CE09DC09DD09DF-09E109F009F10A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A59-0A5C0A5E0A72-0A740A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD0AD00AE00AE10B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D0B5C0B5D0B5F-0B610B710B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BD00C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D0C580C590C600C610C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD0CDE0CE00CE10CF10CF20D05-0D0C0D0E-0D100D12-0D3A0D3D0D4E0D600D610D7A-0D7F0D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60E01-0E300E320E330E40-0E460E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB00EB20EB30EBD0EC0-0EC40EC60EDC-0EDF0F000F40-0F470F49-0F6C0F88-0F8C1000-102A103F1050-1055105A-105D106110651066106E-10701075-1081108E10A0-10C510C710CD10D0-10FA10FC-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA1700-170C170E-17111720-17311740-17511760-176C176E-17701780-17B317D717DC1820-18771880-18A818AA18B0-18F51900-191C1950-196D1970-19741980-19AB19C1-19C71A00-1A161A20-1A541AA71B05-1B331B45-1B4B1B83-1BA01BAE1BAF1BBA-1BE51C00-1C231C4D-1C4F1C5A-1C7D1CE9-1CEC1CEE-1CF11CF51CF61D00-1DBF1E00-1F151F18-1F1D1F20-1F451F48-1F4D1F50-1F571F591F5B1F5D1F5F-1F7D1F80-1FB41FB6-1FBC1FBE1FC2-1FC41FC6-1FCC1FD0-1FD31FD6-1FDB1FE0-1FEC1FF2-1FF41FF6-1FFC2071207F2090-209C21022107210A-211321152119-211D212421262128212A-212D212F-2139213C-213F2145-2149214E218321842C00-2C2E2C30-2C5E2C60-2CE42CEB-2CEE2CF22CF32D00-2D252D272D2D2D30-2D672D6F2D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE2E2F300530063031-3035303B303C3041-3096309D-309F30A1-30FA30FC-30FF3105-312D3131-318E31A0-31BA31F0-31FF3400-4DB54E00-9FCCA000-A48CA4D0-A4FDA500-A60CA610-A61FA62AA62BA640-A66EA67F-A697A6A0-A6E5A717-A71FA722-A788A78B-A78EA790-A793A7A0-A7AAA7F8-A801A803-A805A807-A80AA80C-A822A840-A873A882-A8B3A8F2-A8F7A8FBA90A-A925A930-A946A960-A97CA984-A9B2A9CFAA00-AA28AA40-AA42AA44-AA4BAA60-AA76AA7AAA80-AAAFAAB1AAB5AAB6AAB9-AABDAAC0AAC2AADB-AADDAAE0-AAEAAAF2-AAF4AB01-AB06AB09-AB0EAB11-AB16AB20-AB26AB28-AB2EABC0-ABE2AC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA6DFA70-FAD9FB00-FB06FB13-FB17FB1DFB1F-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF21-FF3AFF41-FF5AFF66-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC"},{L:"Letter"}),a.addToken(/\\([pP]){(\^?)([^}]*)}/,function(a,c){var d="P"===a[1]||a[2]?"^":"",e=b(a[3]);if("P"===a[1]&&a[2])throw new SyntaxError("invalid double negation \\P{^");if(!i.hasOwnProperty(e))throw new SyntaxError("invalid or unknown Unicode property "+a[0]);return"class"===c?d?h(e):i[e]:"["+d+i[e]+"]"},{scope:"all"})}(d),function(a){"use strict";if(!a.addUnicodePackage)throw new ReferenceError("Unicode Base must be loaded before Unicode Categories");a.install("extensibility"),a.addUnicodePackage({Ll:"0061-007A00B500DF-00F600F8-00FF01010103010501070109010B010D010F01110113011501170119011B011D011F01210123012501270129012B012D012F01310133013501370138013A013C013E014001420144014601480149014B014D014F01510153015501570159015B015D015F01610163016501670169016B016D016F0171017301750177017A017C017E-0180018301850188018C018D019201950199-019B019E01A101A301A501A801AA01AB01AD01B001B401B601B901BA01BD-01BF01C601C901CC01CE01D001D201D401D601D801DA01DC01DD01DF01E101E301E501E701E901EB01ED01EF01F001F301F501F901FB01FD01FF02010203020502070209020B020D020F02110213021502170219021B021D021F02210223022502270229022B022D022F02310233-0239023C023F0240024202470249024B024D024F-02930295-02AF037103730377037B-037D039003AC-03CE03D003D103D5-03D703D903DB03DD03DF03E103E303E503E703E903EB03ED03EF-03F303F503F803FB03FC0430-045F04610463046504670469046B046D046F04710473047504770479047B047D047F0481048B048D048F04910493049504970499049B049D049F04A104A304A504A704A904AB04AD04AF04B104B304B504B704B904BB04BD04BF04C204C404C604C804CA04CC04CE04CF04D104D304D504D704D904DB04DD04DF04E104E304E504E704E904EB04ED04EF04F104F304F504F704F904FB04FD04FF05010503050505070509050B050D050F05110513051505170519051B051D051F05210523052505270561-05871D00-1D2B1D6B-1D771D79-1D9A1E011E031E051E071E091E0B1E0D1E0F1E111E131E151E171E191E1B1E1D1E1F1E211E231E251E271E291E2B1E2D1E2F1E311E331E351E371E391E3B1E3D1E3F1E411E431E451E471E491E4B1E4D1E4F1E511E531E551E571E591E5B1E5D1E5F1E611E631E651E671E691E6B1E6D1E6F1E711E731E751E771E791E7B1E7D1E7F1E811E831E851E871E891E8B1E8D1E8F1E911E931E95-1E9D1E9F1EA11EA31EA51EA71EA91EAB1EAD1EAF1EB11EB31EB51EB71EB91EBB1EBD1EBF1EC11EC31EC51EC71EC91ECB1ECD1ECF1ED11ED31ED51ED71ED91EDB1EDD1EDF1EE11EE31EE51EE71EE91EEB1EED1EEF1EF11EF31EF51EF71EF91EFB1EFD1EFF-1F071F10-1F151F20-1F271F30-1F371F40-1F451F50-1F571F60-1F671F70-1F7D1F80-1F871F90-1F971FA0-1FA71FB0-1FB41FB61FB71FBE1FC2-1FC41FC61FC71FD0-1FD31FD61FD71FE0-1FE71FF2-1FF41FF61FF7210A210E210F2113212F21342139213C213D2146-2149214E21842C30-2C5E2C612C652C662C682C6A2C6C2C712C732C742C76-2C7B2C812C832C852C872C892C8B2C8D2C8F2C912C932C952C972C992C9B2C9D2C9F2CA12CA32CA52CA72CA92CAB2CAD2CAF2CB12CB32CB52CB72CB92CBB2CBD2CBF2CC12CC32CC52CC72CC92CCB2CCD2CCF2CD12CD32CD52CD72CD92CDB2CDD2CDF2CE12CE32CE42CEC2CEE2CF32D00-2D252D272D2DA641A643A645A647A649A64BA64DA64FA651A653A655A657A659A65BA65DA65FA661A663A665A667A669A66BA66DA681A683A685A687A689A68BA68DA68FA691A693A695A697A723A725A727A729A72BA72DA72F-A731A733A735A737A739A73BA73DA73FA741A743A745A747A749A74BA74DA74FA751A753A755A757A759A75BA75DA75FA761A763A765A767A769A76BA76DA76FA771-A778A77AA77CA77FA781A783A785A787A78CA78EA791A793A7A1A7A3A7A5A7A7A7A9A7FAFB00-FB06FB13-FB17FF41-FF5A",Lu:"0041-005A00C0-00D600D8-00DE01000102010401060108010A010C010E01100112011401160118011A011C011E01200122012401260128012A012C012E01300132013401360139013B013D013F0141014301450147014A014C014E01500152015401560158015A015C015E01600162016401660168016A016C016E017001720174017601780179017B017D018101820184018601870189-018B018E-0191019301940196-0198019C019D019F01A001A201A401A601A701A901AC01AE01AF01B1-01B301B501B701B801BC01C401C701CA01CD01CF01D101D301D501D701D901DB01DE01E001E201E401E601E801EA01EC01EE01F101F401F6-01F801FA01FC01FE02000202020402060208020A020C020E02100212021402160218021A021C021E02200222022402260228022A022C022E02300232023A023B023D023E02410243-02460248024A024C024E03700372037603860388-038A038C038E038F0391-03A103A3-03AB03CF03D2-03D403D803DA03DC03DE03E003E203E403E603E803EA03EC03EE03F403F703F903FA03FD-042F04600462046404660468046A046C046E04700472047404760478047A047C047E0480048A048C048E04900492049404960498049A049C049E04A004A204A404A604A804AA04AC04AE04B004B204B404B604B804BA04BC04BE04C004C104C304C504C704C904CB04CD04D004D204D404D604D804DA04DC04DE04E004E204E404E604E804EA04EC04EE04F004F204F404F604F804FA04FC04FE05000502050405060508050A050C050E05100512051405160518051A051C051E05200522052405260531-055610A0-10C510C710CD1E001E021E041E061E081E0A1E0C1E0E1E101E121E141E161E181E1A1E1C1E1E1E201E221E241E261E281E2A1E2C1E2E1E301E321E341E361E381E3A1E3C1E3E1E401E421E441E461E481E4A1E4C1E4E1E501E521E541E561E581E5A1E5C1E5E1E601E621E641E661E681E6A1E6C1E6E1E701E721E741E761E781E7A1E7C1E7E1E801E821E841E861E881E8A1E8C1E8E1E901E921E941E9E1EA01EA21EA41EA61EA81EAA1EAC1EAE1EB01EB21EB41EB61EB81EBA1EBC1EBE1EC01EC21EC41EC61EC81ECA1ECC1ECE1ED01ED21ED41ED61ED81EDA1EDC1EDE1EE01EE21EE41EE61EE81EEA1EEC1EEE1EF01EF21EF41EF61EF81EFA1EFC1EFE1F08-1F0F1F18-1F1D1F28-1F2F1F38-1F3F1F48-1F4D1F591F5B1F5D1F5F1F68-1F6F1FB8-1FBB1FC8-1FCB1FD8-1FDB1FE8-1FEC1FF8-1FFB21022107210B-210D2110-211221152119-211D212421262128212A-212D2130-2133213E213F214521832C00-2C2E2C602C62-2C642C672C692C6B2C6D-2C702C722C752C7E-2C802C822C842C862C882C8A2C8C2C8E2C902C922C942C962C982C9A2C9C2C9E2CA02CA22CA42CA62CA82CAA2CAC2CAE2CB02CB22CB42CB62CB82CBA2CBC2CBE2CC02CC22CC42CC62CC82CCA2CCC2CCE2CD02CD22CD42CD62CD82CDA2CDC2CDE2CE02CE22CEB2CED2CF2A640A642A644A646A648A64AA64CA64EA650A652A654A656A658A65AA65CA65EA660A662A664A666A668A66AA66CA680A682A684A686A688A68AA68CA68EA690A692A694A696A722A724A726A728A72AA72CA72EA732A734A736A738A73AA73CA73EA740A742A744A746A748A74AA74CA74EA750A752A754A756A758A75AA75CA75EA760A762A764A766A768A76AA76CA76EA779A77BA77DA77EA780A782A784A786A78BA78DA790A792A7A0A7A2A7A4A7A6A7A8A7AAFF21-FF3A",Lt:"01C501C801CB01F21F88-1F8F1F98-1F9F1FA8-1FAF1FBC1FCC1FFC",Lm:"02B0-02C102C6-02D102E0-02E402EC02EE0374037A0559064006E506E607F407F507FA081A0824082809710E460EC610FC17D718431AA71C78-1C7D1D2C-1D6A1D781D9B-1DBF2071207F2090-209C2C7C2C7D2D6F2E2F30053031-3035303B309D309E30FC-30FEA015A4F8-A4FDA60CA67FA717-A71FA770A788A7F8A7F9A9CFAA70AADDAAF3AAF4FF70FF9EFF9F",Lo:"00AA00BA01BB01C0-01C3029405D0-05EA05F0-05F20620-063F0641-064A066E066F0671-06D306D506EE06EF06FA-06FC06FF07100712-072F074D-07A507B107CA-07EA0800-08150840-085808A008A2-08AC0904-0939093D09500958-09610972-09770979-097F0985-098C098F09900993-09A809AA-09B009B209B6-09B909BD09CE09DC09DD09DF-09E109F009F10A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A59-0A5C0A5E0A72-0A740A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD0AD00AE00AE10B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D0B5C0B5D0B5F-0B610B710B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BD00C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D0C580C590C600C610C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD0CDE0CE00CE10CF10CF20D05-0D0C0D0E-0D100D12-0D3A0D3D0D4E0D600D610D7A-0D7F0D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60E01-0E300E320E330E40-0E450E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB00EB20EB30EBD0EC0-0EC40EDC-0EDF0F000F40-0F470F49-0F6C0F88-0F8C1000-102A103F1050-1055105A-105D106110651066106E-10701075-1081108E10D0-10FA10FD-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA1700-170C170E-17111720-17311740-17511760-176C176E-17701780-17B317DC1820-18421844-18771880-18A818AA18B0-18F51900-191C1950-196D1970-19741980-19AB19C1-19C71A00-1A161A20-1A541B05-1B331B45-1B4B1B83-1BA01BAE1BAF1BBA-1BE51C00-1C231C4D-1C4F1C5A-1C771CE9-1CEC1CEE-1CF11CF51CF62135-21382D30-2D672D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE3006303C3041-3096309F30A1-30FA30FF3105-312D3131-318E31A0-31BA31F0-31FF3400-4DB54E00-9FCCA000-A014A016-A48CA4D0-A4F7A500-A60BA610-A61FA62AA62BA66EA6A0-A6E5A7FB-A801A803-A805A807-A80AA80C-A822A840-A873A882-A8B3A8F2-A8F7A8FBA90A-A925A930-A946A960-A97CA984-A9B2AA00-AA28AA40-AA42AA44-AA4BAA60-AA6FAA71-AA76AA7AAA80-AAAFAAB1AAB5AAB6AAB9-AABDAAC0AAC2AADBAADCAAE0-AAEAAAF2AB01-AB06AB09-AB0EAB11-AB16AB20-AB26AB28-AB2EABC0-ABE2AC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA6DFA70-FAD9FB1DFB1F-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF66-FF6FFF71-FF9DFFA0-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",M:"0300-036F0483-04890591-05BD05BF05C105C205C405C505C70610-061A064B-065F067006D6-06DC06DF-06E406E706E806EA-06ED07110730-074A07A6-07B007EB-07F30816-0819081B-08230825-08270829-082D0859-085B08E4-08FE0900-0903093A-093C093E-094F0951-0957096209630981-098309BC09BE-09C409C709C809CB-09CD09D709E209E30A01-0A030A3C0A3E-0A420A470A480A4B-0A4D0A510A700A710A750A81-0A830ABC0ABE-0AC50AC7-0AC90ACB-0ACD0AE20AE30B01-0B030B3C0B3E-0B440B470B480B4B-0B4D0B560B570B620B630B820BBE-0BC20BC6-0BC80BCA-0BCD0BD70C01-0C030C3E-0C440C46-0C480C4A-0C4D0C550C560C620C630C820C830CBC0CBE-0CC40CC6-0CC80CCA-0CCD0CD50CD60CE20CE30D020D030D3E-0D440D46-0D480D4A-0D4D0D570D620D630D820D830DCA0DCF-0DD40DD60DD8-0DDF0DF20DF30E310E34-0E3A0E47-0E4E0EB10EB4-0EB90EBB0EBC0EC8-0ECD0F180F190F350F370F390F3E0F3F0F71-0F840F860F870F8D-0F970F99-0FBC0FC6102B-103E1056-1059105E-10601062-10641067-106D1071-10741082-108D108F109A-109D135D-135F1712-17141732-1734175217531772177317B4-17D317DD180B-180D18A91920-192B1930-193B19B0-19C019C819C91A17-1A1B1A55-1A5E1A60-1A7C1A7F1B00-1B041B34-1B441B6B-1B731B80-1B821BA1-1BAD1BE6-1BF31C24-1C371CD0-1CD21CD4-1CE81CED1CF2-1CF41DC0-1DE61DFC-1DFF20D0-20F02CEF-2CF12D7F2DE0-2DFF302A-302F3099309AA66F-A672A674-A67DA69FA6F0A6F1A802A806A80BA823-A827A880A881A8B4-A8C4A8E0-A8F1A926-A92DA947-A953A980-A983A9B3-A9C0AA29-AA36AA43AA4CAA4DAA7BAAB0AAB2-AAB4AAB7AAB8AABEAABFAAC1AAEB-AAEFAAF5AAF6ABE3-ABEAABECABEDFB1EFE00-FE0FFE20-FE26",Mn:"0300-036F0483-04870591-05BD05BF05C105C205C405C505C70610-061A064B-065F067006D6-06DC06DF-06E406E706E806EA-06ED07110730-074A07A6-07B007EB-07F30816-0819081B-08230825-08270829-082D0859-085B08E4-08FE0900-0902093A093C0941-0948094D0951-095709620963098109BC09C1-09C409CD09E209E30A010A020A3C0A410A420A470A480A4B-0A4D0A510A700A710A750A810A820ABC0AC1-0AC50AC70AC80ACD0AE20AE30B010B3C0B3F0B41-0B440B4D0B560B620B630B820BC00BCD0C3E-0C400C46-0C480C4A-0C4D0C550C560C620C630CBC0CBF0CC60CCC0CCD0CE20CE30D41-0D440D4D0D620D630DCA0DD2-0DD40DD60E310E34-0E3A0E47-0E4E0EB10EB4-0EB90EBB0EBC0EC8-0ECD0F180F190F350F370F390F71-0F7E0F80-0F840F860F870F8D-0F970F99-0FBC0FC6102D-10301032-10371039103A103D103E10581059105E-10601071-1074108210851086108D109D135D-135F1712-17141732-1734175217531772177317B417B517B7-17BD17C617C9-17D317DD180B-180D18A91920-19221927192819321939-193B1A171A181A561A58-1A5E1A601A621A65-1A6C1A73-1A7C1A7F1B00-1B031B341B36-1B3A1B3C1B421B6B-1B731B801B811BA2-1BA51BA81BA91BAB1BE61BE81BE91BED1BEF-1BF11C2C-1C331C361C371CD0-1CD21CD4-1CE01CE2-1CE81CED1CF41DC0-1DE61DFC-1DFF20D0-20DC20E120E5-20F02CEF-2CF12D7F2DE0-2DFF302A-302D3099309AA66FA674-A67DA69FA6F0A6F1A802A806A80BA825A826A8C4A8E0-A8F1A926-A92DA947-A951A980-A982A9B3A9B6-A9B9A9BCAA29-AA2EAA31AA32AA35AA36AA43AA4CAAB0AAB2-AAB4AAB7AAB8AABEAABFAAC1AAECAAEDAAF6ABE5ABE8ABEDFB1EFE00-FE0FFE20-FE26",Mc:"0903093B093E-09400949-094C094E094F0982098309BE-09C009C709C809CB09CC09D70A030A3E-0A400A830ABE-0AC00AC90ACB0ACC0B020B030B3E0B400B470B480B4B0B4C0B570BBE0BBF0BC10BC20BC6-0BC80BCA-0BCC0BD70C01-0C030C41-0C440C820C830CBE0CC0-0CC40CC70CC80CCA0CCB0CD50CD60D020D030D3E-0D400D46-0D480D4A-0D4C0D570D820D830DCF-0DD10DD8-0DDF0DF20DF30F3E0F3F0F7F102B102C10311038103B103C105610571062-10641067-106D108310841087-108C108F109A-109C17B617BE-17C517C717C81923-19261929-192B193019311933-193819B0-19C019C819C91A19-1A1B1A551A571A611A631A641A6D-1A721B041B351B3B1B3D-1B411B431B441B821BA11BA61BA71BAA1BAC1BAD1BE71BEA-1BEC1BEE1BF21BF31C24-1C2B1C341C351CE11CF21CF3302E302FA823A824A827A880A881A8B4-A8C3A952A953A983A9B4A9B5A9BAA9BBA9BD-A9C0AA2FAA30AA33AA34AA4DAA7BAAEBAAEEAAEFAAF5ABE3ABE4ABE6ABE7ABE9ABEAABEC",Me:"0488048920DD-20E020E2-20E4A670-A672",N:"0030-003900B200B300B900BC-00BE0660-066906F0-06F907C0-07C90966-096F09E6-09EF09F4-09F90A66-0A6F0AE6-0AEF0B66-0B6F0B72-0B770BE6-0BF20C66-0C6F0C78-0C7E0CE6-0CEF0D66-0D750E50-0E590ED0-0ED90F20-0F331040-10491090-10991369-137C16EE-16F017E0-17E917F0-17F91810-18191946-194F19D0-19DA1A80-1A891A90-1A991B50-1B591BB0-1BB91C40-1C491C50-1C5920702074-20792080-20892150-21822185-21892460-249B24EA-24FF2776-27932CFD30073021-30293038-303A3192-31953220-32293248-324F3251-325F3280-328932B1-32BFA620-A629A6E6-A6EFA830-A835A8D0-A8D9A900-A909A9D0-A9D9AA50-AA59ABF0-ABF9FF10-FF19",Nd:"0030-00390660-066906F0-06F907C0-07C90966-096F09E6-09EF0A66-0A6F0AE6-0AEF0B66-0B6F0BE6-0BEF0C66-0C6F0CE6-0CEF0D66-0D6F0E50-0E590ED0-0ED90F20-0F291040-10491090-109917E0-17E91810-18191946-194F19D0-19D91A80-1A891A90-1A991B50-1B591BB0-1BB91C40-1C491C50-1C59A620-A629A8D0-A8D9A900-A909A9D0-A9D9AA50-AA59ABF0-ABF9FF10-FF19",Nl:"16EE-16F02160-21822185-218830073021-30293038-303AA6E6-A6EF",No:"00B200B300B900BC-00BE09F4-09F90B72-0B770BF0-0BF20C78-0C7E0D70-0D750F2A-0F331369-137C17F0-17F919DA20702074-20792080-20892150-215F21892460-249B24EA-24FF2776-27932CFD3192-31953220-32293248-324F3251-325F3280-328932B1-32BFA830-A835",P:"0021-00230025-002A002C-002F003A003B003F0040005B-005D005F007B007D00A100A700AB00B600B700BB00BF037E0387055A-055F0589058A05BE05C005C305C605F305F40609060A060C060D061B061E061F066A-066D06D40700-070D07F7-07F90830-083E085E0964096509700AF00DF40E4F0E5A0E5B0F04-0F120F140F3A-0F3D0F850FD0-0FD40FD90FDA104A-104F10FB1360-13681400166D166E169B169C16EB-16ED1735173617D4-17D617D8-17DA1800-180A194419451A1E1A1F1AA0-1AA61AA8-1AAD1B5A-1B601BFC-1BFF1C3B-1C3F1C7E1C7F1CC0-1CC71CD32010-20272030-20432045-20512053-205E207D207E208D208E2329232A2768-277527C527C627E6-27EF2983-299829D8-29DB29FC29FD2CF9-2CFC2CFE2CFF2D702E00-2E2E2E30-2E3B3001-30033008-30113014-301F3030303D30A030FBA4FEA4FFA60D-A60FA673A67EA6F2-A6F7A874-A877A8CEA8CFA8F8-A8FAA92EA92FA95FA9C1-A9CDA9DEA9DFAA5C-AA5FAADEAADFAAF0AAF1ABEBFD3EFD3FFE10-FE19FE30-FE52FE54-FE61FE63FE68FE6AFE6BFF01-FF03FF05-FF0AFF0C-FF0FFF1AFF1BFF1FFF20FF3B-FF3DFF3FFF5BFF5DFF5F-FF65",Pd:"002D058A05BE140018062010-20152E172E1A2E3A2E3B301C303030A0FE31FE32FE58FE63FF0D",Ps:"0028005B007B0F3A0F3C169B201A201E2045207D208D23292768276A276C276E27702772277427C527E627E827EA27EC27EE2983298529872989298B298D298F299129932995299729D829DA29FC2E222E242E262E283008300A300C300E3010301430163018301A301DFD3EFE17FE35FE37FE39FE3BFE3DFE3FFE41FE43FE47FE59FE5BFE5DFF08FF3BFF5BFF5FFF62",Pe:"0029005D007D0F3B0F3D169C2046207E208E232A2769276B276D276F27712773277527C627E727E927EB27ED27EF298429862988298A298C298E2990299229942996299829D929DB29FD2E232E252E272E293009300B300D300F3011301530173019301B301E301FFD3FFE18FE36FE38FE3AFE3CFE3EFE40FE42FE44FE48FE5AFE5CFE5EFF09FF3DFF5DFF60FF63",Pi:"00AB2018201B201C201F20392E022E042E092E0C2E1C2E20",Pf:"00BB2019201D203A2E032E052E0A2E0D2E1D2E21",Pc:"005F203F20402054FE33FE34FE4D-FE4FFF3F",Po:"0021-00230025-0027002A002C002E002F003A003B003F0040005C00A100A700B600B700BF037E0387055A-055F058905C005C305C605F305F40609060A060C060D061B061E061F066A-066D06D40700-070D07F7-07F90830-083E085E0964096509700AF00DF40E4F0E5A0E5B0F04-0F120F140F850FD0-0FD40FD90FDA104A-104F10FB1360-1368166D166E16EB-16ED1735173617D4-17D617D8-17DA1800-18051807-180A194419451A1E1A1F1AA0-1AA61AA8-1AAD1B5A-1B601BFC-1BFF1C3B-1C3F1C7E1C7F1CC0-1CC71CD3201620172020-20272030-2038203B-203E2041-20432047-205120532055-205E2CF9-2CFC2CFE2CFF2D702E002E012E06-2E082E0B2E0E-2E162E182E192E1B2E1E2E1F2E2A-2E2E2E30-2E393001-3003303D30FBA4FEA4FFA60D-A60FA673A67EA6F2-A6F7A874-A877A8CEA8CFA8F8-A8FAA92EA92FA95FA9C1-A9CDA9DEA9DFAA5C-AA5FAADEAADFAAF0AAF1ABEBFE10-FE16FE19FE30FE45FE46FE49-FE4CFE50-FE52FE54-FE57FE5F-FE61FE68FE6AFE6BFF01-FF03FF05-FF07FF0AFF0CFF0EFF0FFF1AFF1BFF1FFF20FF3CFF61FF64FF65",S:"0024002B003C-003E005E0060007C007E00A2-00A600A800A900AC00AE-00B100B400B800D700F702C2-02C502D2-02DF02E5-02EB02ED02EF-02FF03750384038503F60482058F0606-0608060B060E060F06DE06E906FD06FE07F609F209F309FA09FB0AF10B700BF3-0BFA0C7F0D790E3F0F01-0F030F130F15-0F170F1A-0F1F0F340F360F380FBE-0FC50FC7-0FCC0FCE0FCF0FD5-0FD8109E109F1390-139917DB194019DE-19FF1B61-1B6A1B74-1B7C1FBD1FBF-1FC11FCD-1FCF1FDD-1FDF1FED-1FEF1FFD1FFE20442052207A-207C208A-208C20A0-20B9210021012103-21062108210921142116-2118211E-2123212521272129212E213A213B2140-2144214A-214D214F2190-2328232B-23F32400-24262440-244A249C-24E92500-26FF2701-27672794-27C427C7-27E527F0-29822999-29D729DC-29FB29FE-2B4C2B50-2B592CE5-2CEA2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB300430123013302030363037303E303F309B309C319031913196-319F31C0-31E33200-321E322A-324732503260-327F328A-32B032C0-32FE3300-33FF4DC0-4DFFA490-A4C6A700-A716A720A721A789A78AA828-A82BA836-A839AA77-AA79FB29FBB2-FBC1FDFCFDFDFE62FE64-FE66FE69FF04FF0BFF1C-FF1EFF3EFF40FF5CFF5EFFE0-FFE6FFE8-FFEEFFFCFFFD",Sm:"002B003C-003E007C007E00AC00B100D700F703F60606-060820442052207A-207C208A-208C21182140-2144214B2190-2194219A219B21A021A321A621AE21CE21CF21D221D421F4-22FF2308-230B23202321237C239B-23B323DC-23E125B725C125F8-25FF266F27C0-27C427C7-27E527F0-27FF2900-29822999-29D729DC-29FB29FE-2AFF2B30-2B442B47-2B4CFB29FE62FE64-FE66FF0BFF1C-FF1EFF5CFF5EFFE2FFE9-FFEC",Sc:"002400A2-00A5058F060B09F209F309FB0AF10BF90E3F17DB20A0-20B9A838FDFCFE69FF04FFE0FFE1FFE5FFE6",Sk:"005E006000A800AF00B400B802C2-02C502D2-02DF02E5-02EB02ED02EF-02FF0375038403851FBD1FBF-1FC11FCD-1FCF1FDD-1FDF1FED-1FEF1FFD1FFE309B309CA700-A716A720A721A789A78AFBB2-FBC1FF3EFF40FFE3",So:"00A600A900AE00B00482060E060F06DE06E906FD06FE07F609FA0B700BF3-0BF80BFA0C7F0D790F01-0F030F130F15-0F170F1A-0F1F0F340F360F380FBE-0FC50FC7-0FCC0FCE0FCF0FD5-0FD8109E109F1390-1399194019DE-19FF1B61-1B6A1B74-1B7C210021012103-210621082109211421162117211E-2123212521272129212E213A213B214A214C214D214F2195-2199219C-219F21A121A221A421A521A7-21AD21AF-21CD21D021D121D321D5-21F32300-2307230C-231F2322-2328232B-237B237D-239A23B4-23DB23E2-23F32400-24262440-244A249C-24E92500-25B625B8-25C025C2-25F72600-266E2670-26FF2701-27672794-27BF2800-28FF2B00-2B2F2B452B462B50-2B592CE5-2CEA2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB300430123013302030363037303E303F319031913196-319F31C0-31E33200-321E322A-324732503260-327F328A-32B032C0-32FE3300-33FF4DC0-4DFFA490-A4C6A828-A82BA836A837A839AA77-AA79FDFDFFE4FFE8FFEDFFEEFFFCFFFD",Z:"002000A01680180E2000-200A20282029202F205F3000",Zs:"002000A01680180E2000-200A202F205F3000",Zl:"2028",Zp:"2029",C:"0000-001F007F-009F00AD03780379037F-0383038B038D03A20528-05300557055805600588058B-058E059005C8-05CF05EB-05EF05F5-0605061C061D06DD070E070F074B074C07B2-07BF07FB-07FF082E082F083F085C085D085F-089F08A108AD-08E308FF097809800984098D098E0991099209A909B109B3-09B509BA09BB09C509C609C909CA09CF-09D609D8-09DB09DE09E409E509FC-0A000A040A0B-0A0E0A110A120A290A310A340A370A3A0A3B0A3D0A43-0A460A490A4A0A4E-0A500A52-0A580A5D0A5F-0A650A76-0A800A840A8E0A920AA90AB10AB40ABA0ABB0AC60ACA0ACE0ACF0AD1-0ADF0AE40AE50AF2-0B000B040B0D0B0E0B110B120B290B310B340B3A0B3B0B450B460B490B4A0B4E-0B550B58-0B5B0B5E0B640B650B78-0B810B840B8B-0B8D0B910B96-0B980B9B0B9D0BA0-0BA20BA5-0BA70BAB-0BAD0BBA-0BBD0BC3-0BC50BC90BCE0BCF0BD1-0BD60BD8-0BE50BFB-0C000C040C0D0C110C290C340C3A-0C3C0C450C490C4E-0C540C570C5A-0C5F0C640C650C70-0C770C800C810C840C8D0C910CA90CB40CBA0CBB0CC50CC90CCE-0CD40CD7-0CDD0CDF0CE40CE50CF00CF3-0D010D040D0D0D110D3B0D3C0D450D490D4F-0D560D58-0D5F0D640D650D76-0D780D800D810D840D97-0D990DB20DBC0DBE0DBF0DC7-0DC90DCB-0DCE0DD50DD70DE0-0DF10DF5-0E000E3B-0E3E0E5C-0E800E830E850E860E890E8B0E8C0E8E-0E930E980EA00EA40EA60EA80EA90EAC0EBA0EBE0EBF0EC50EC70ECE0ECF0EDA0EDB0EE0-0EFF0F480F6D-0F700F980FBD0FCD0FDB-0FFF10C610C8-10CC10CE10CF1249124E124F12571259125E125F1289128E128F12B112B612B712BF12C112C612C712D7131113161317135B135C137D-137F139A-139F13F5-13FF169D-169F16F1-16FF170D1715-171F1737-173F1754-175F176D17711774-177F17DE17DF17EA-17EF17FA-17FF180F181A-181F1878-187F18AB-18AF18F6-18FF191D-191F192C-192F193C-193F1941-1943196E196F1975-197F19AC-19AF19CA-19CF19DB-19DD1A1C1A1D1A5F1A7D1A7E1A8A-1A8F1A9A-1A9F1AAE-1AFF1B4C-1B4F1B7D-1B7F1BF4-1BFB1C38-1C3A1C4A-1C4C1C80-1CBF1CC8-1CCF1CF7-1CFF1DE7-1DFB1F161F171F1E1F1F1F461F471F4E1F4F1F581F5A1F5C1F5E1F7E1F7F1FB51FC51FD41FD51FDC1FF01FF11FF51FFF200B-200F202A-202E2060-206F20722073208F209D-209F20BA-20CF20F1-20FF218A-218F23F4-23FF2427-243F244B-245F27002B4D-2B4F2B5A-2BFF2C2F2C5F2CF4-2CF82D262D28-2D2C2D2E2D2F2D68-2D6E2D71-2D7E2D97-2D9F2DA72DAF2DB72DBF2DC72DCF2DD72DDF2E3C-2E7F2E9A2EF4-2EFF2FD6-2FEF2FFC-2FFF3040309730983100-3104312E-3130318F31BB-31BF31E4-31EF321F32FF4DB6-4DBF9FCD-9FFFA48D-A48FA4C7-A4CFA62C-A63FA698-A69EA6F8-A6FFA78FA794-A79FA7AB-A7F7A82C-A82FA83A-A83FA878-A87FA8C5-A8CDA8DA-A8DFA8FC-A8FFA954-A95EA97D-A97FA9CEA9DA-A9DDA9E0-A9FFAA37-AA3FAA4EAA4FAA5AAA5BAA7C-AA7FAAC3-AADAAAF7-AB00AB07AB08AB0FAB10AB17-AB1FAB27AB2F-ABBFABEEABEFABFA-ABFFD7A4-D7AFD7C7-D7CAD7FC-F8FFFA6EFA6FFADA-FAFFFB07-FB12FB18-FB1CFB37FB3DFB3FFB42FB45FBC2-FBD2FD40-FD4FFD90FD91FDC8-FDEFFDFEFDFFFE1A-FE1FFE27-FE2FFE53FE67FE6C-FE6FFE75FEFD-FF00FFBF-FFC1FFC8FFC9FFD0FFD1FFD8FFD9FFDD-FFDFFFE7FFEF-FFFBFFFEFFFF",Cc:"0000-001F007F-009F",Cf:"00AD0600-060406DD070F200B-200F202A-202E2060-2064206A-206FFEFFFFF9-FFFB",Co:"E000-F8FF",Cs:"D800-DFFF",Cn:"03780379037F-0383038B038D03A20528-05300557055805600588058B-058E059005C8-05CF05EB-05EF05F5-05FF0605061C061D070E074B074C07B2-07BF07FB-07FF082E082F083F085C085D085F-089F08A108AD-08E308FF097809800984098D098E0991099209A909B109B3-09B509BA09BB09C509C609C909CA09CF-09D609D8-09DB09DE09E409E509FC-0A000A040A0B-0A0E0A110A120A290A310A340A370A3A0A3B0A3D0A43-0A460A490A4A0A4E-0A500A52-0A580A5D0A5F-0A650A76-0A800A840A8E0A920AA90AB10AB40ABA0ABB0AC60ACA0ACE0ACF0AD1-0ADF0AE40AE50AF2-0B000B040B0D0B0E0B110B120B290B310B340B3A0B3B0B450B460B490B4A0B4E-0B550B58-0B5B0B5E0B640B650B78-0B810B840B8B-0B8D0B910B96-0B980B9B0B9D0BA0-0BA20BA5-0BA70BAB-0BAD0BBA-0BBD0BC3-0BC50BC90BCE0BCF0BD1-0BD60BD8-0BE50BFB-0C000C040C0D0C110C290C340C3A-0C3C0C450C490C4E-0C540C570C5A-0C5F0C640C650C70-0C770C800C810C840C8D0C910CA90CB40CBA0CBB0CC50CC90CCE-0CD40CD7-0CDD0CDF0CE40CE50CF00CF3-0D010D040D0D0D110D3B0D3C0D450D490D4F-0D560D58-0D5F0D640D650D76-0D780D800D810D840D97-0D990DB20DBC0DBE0DBF0DC7-0DC90DCB-0DCE0DD50DD70DE0-0DF10DF5-0E000E3B-0E3E0E5C-0E800E830E850E860E890E8B0E8C0E8E-0E930E980EA00EA40EA60EA80EA90EAC0EBA0EBE0EBF0EC50EC70ECE0ECF0EDA0EDB0EE0-0EFF0F480F6D-0F700F980FBD0FCD0FDB-0FFF10C610C8-10CC10CE10CF1249124E124F12571259125E125F1289128E128F12B112B612B712BF12C112C612C712D7131113161317135B135C137D-137F139A-139F13F5-13FF169D-169F16F1-16FF170D1715-171F1737-173F1754-175F176D17711774-177F17DE17DF17EA-17EF17FA-17FF180F181A-181F1878-187F18AB-18AF18F6-18FF191D-191F192C-192F193C-193F1941-1943196E196F1975-197F19AC-19AF19CA-19CF19DB-19DD1A1C1A1D1A5F1A7D1A7E1A8A-1A8F1A9A-1A9F1AAE-1AFF1B4C-1B4F1B7D-1B7F1BF4-1BFB1C38-1C3A1C4A-1C4C1C80-1CBF1CC8-1CCF1CF7-1CFF1DE7-1DFB1F161F171F1E1F1F1F461F471F4E1F4F1F581F5A1F5C1F5E1F7E1F7F1FB51FC51FD41FD51FDC1FF01FF11FF51FFF2065-206920722073208F209D-209F20BA-20CF20F1-20FF218A-218F23F4-23FF2427-243F244B-245F27002B4D-2B4F2B5A-2BFF2C2F2C5F2CF4-2CF82D262D28-2D2C2D2E2D2F2D68-2D6E2D71-2D7E2D97-2D9F2DA72DAF2DB72DBF2DC72DCF2DD72DDF2E3C-2E7F2E9A2EF4-2EFF2FD6-2FEF2FFC-2FFF3040309730983100-3104312E-3130318F31BB-31BF31E4-31EF321F32FF4DB6-4DBF9FCD-9FFFA48D-A48FA4C7-A4CFA62C-A63FA698-A69EA6F8-A6FFA78FA794-A79FA7AB-A7F7A82C-A82FA83A-A83FA878-A87FA8C5-A8CDA8DA-A8DFA8FC-A8FFA954-A95EA97D-A97FA9CEA9DA-A9DDA9E0-A9FFAA37-AA3FAA4EAA4FAA5AAA5BAA7C-AA7FAAC3-AADAAAF7-AB00AB07AB08AB0FAB10AB17-AB1FAB27AB2F-ABBFABEEABEFABFA-ABFFD7A4-D7AFD7C7-D7CAD7FC-D7FFFA6EFA6FFADA-FAFFFB07-FB12FB18-FB1CFB37FB3DFB3FFB42FB45FBC2-FBD2FD40-FD4FFD90FD91FDC8-FDEFFDFEFDFFFE1A-FE1FFE27-FE2FFE53FE67FE6C-FE6FFE75FEFDFEFEFF00FFBF-FFC1FFC8FFC9FFD0FFD1FFD8FFD9FFDD-FFDFFFE7FFEF-FFF8FFFEFFFF"},{Ll:"Lowercase_Letter",Lu:"Uppercase_Letter",Lt:"Titlecase_Letter",Lm:"Modifier_Letter",Lo:"Other_Letter",M:"Mark",Mn:"Nonspacing_Mark",Mc:"Spacing_Mark",Me:"Enclosing_Mark",N:"Number",Nd:"Decimal_Number",Nl:"Letter_Number",No:"Other_Number",P:"Punctuation",Pd:"Dash_Punctuation",Ps:"Open_Punctuation",Pe:"Close_Punctuation",Pi:"Initial_Punctuation",Pf:"Final_Punctuation",Pc:"Connector_Punctuation",Po:"Other_Punctuation",S:"Symbol",Sm:"Math_Symbol",Sc:"Currency_Symbol",Sk:"Modifier_Symbol",So:"Other_Symbol",Z:"Separator",Zs:"Space_Separator",Zl:"Line_Separator",Zp:"Paragraph_Separator",C:"Other",Cc:"Control",Cf:"Format",Co:"Private_Use",Cs:"Surrogate",Cn:"Unassigned"})
}(d),function(a){"use strict";if(!a.addUnicodePackage)throw new ReferenceError("Unicode Base must be loaded before Unicode Scripts");a.install("extensibility"),a.addUnicodePackage({Arabic:"0600-06040606-060B060D-061A061E0620-063F0641-064A0656-065E066A-066F0671-06DC06DE-06FF0750-077F08A008A2-08AC08E4-08FEFB50-FBC1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFCFE70-FE74FE76-FEFC",Armenian:"0531-05560559-055F0561-0587058A058FFB13-FB17",Balinese:"1B00-1B4B1B50-1B7C",Bamum:"A6A0-A6F7",Batak:"1BC0-1BF31BFC-1BFF",Bengali:"0981-09830985-098C098F09900993-09A809AA-09B009B209B6-09B909BC-09C409C709C809CB-09CE09D709DC09DD09DF-09E309E6-09FB",Bopomofo:"02EA02EB3105-312D31A0-31BA",Braille:"2800-28FF",Buginese:"1A00-1A1B1A1E1A1F",Buhid:"1740-1753",Canadian_Aboriginal:"1400-167F18B0-18F5",Cham:"AA00-AA36AA40-AA4DAA50-AA59AA5C-AA5F",Cherokee:"13A0-13F4",Common:"0000-0040005B-0060007B-00A900AB-00B900BB-00BF00D700F702B9-02DF02E5-02E902EC-02FF0374037E038503870589060C061B061F06400660-066906DD096409650E3F0FD5-0FD810FB16EB-16ED173517361802180318051CD31CE11CE9-1CEC1CEE-1CF31CF51CF62000-200B200E-2064206A-20702074-207E2080-208E20A0-20B92100-21252127-2129212C-21312133-214D214F-215F21892190-23F32400-24262440-244A2460-26FF2701-27FF2900-2B4C2B50-2B592E00-2E3B2FF0-2FFB3000-300430063008-30203030-3037303C-303F309B309C30A030FB30FC3190-319F31C0-31E33220-325F327F-32CF3358-33FF4DC0-4DFFA700-A721A788-A78AA830-A839FD3EFD3FFDFDFE10-FE19FE30-FE52FE54-FE66FE68-FE6BFEFFFF01-FF20FF3B-FF40FF5B-FF65FF70FF9EFF9FFFE0-FFE6FFE8-FFEEFFF9-FFFD",Coptic:"03E2-03EF2C80-2CF32CF9-2CFF",Cyrillic:"0400-04840487-05271D2B1D782DE0-2DFFA640-A697A69F",Devanagari:"0900-09500953-09630966-09770979-097FA8E0-A8FB",Ethiopic:"1200-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A135D-137C1380-13992D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDEAB01-AB06AB09-AB0EAB11-AB16AB20-AB26AB28-AB2E",Georgian:"10A0-10C510C710CD10D0-10FA10FC-10FF2D00-2D252D272D2D",Glagolitic:"2C00-2C2E2C30-2C5E",Greek:"0370-03730375-0377037A-037D038403860388-038A038C038E-03A103A3-03E103F0-03FF1D26-1D2A1D5D-1D611D66-1D6A1DBF1F00-1F151F18-1F1D1F20-1F451F48-1F4D1F50-1F571F591F5B1F5D1F5F-1F7D1F80-1FB41FB6-1FC41FC6-1FD31FD6-1FDB1FDD-1FEF1FF2-1FF41FF6-1FFE2126",Gujarati:"0A81-0A830A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABC-0AC50AC7-0AC90ACB-0ACD0AD00AE0-0AE30AE6-0AF1",Gurmukhi:"0A01-0A030A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A3C0A3E-0A420A470A480A4B-0A4D0A510A59-0A5C0A5E0A66-0A75",Han:"2E80-2E992E9B-2EF32F00-2FD5300530073021-30293038-303B3400-4DB54E00-9FCCF900-FA6DFA70-FAD9",Hangul:"1100-11FF302E302F3131-318E3200-321E3260-327EA960-A97CAC00-D7A3D7B0-D7C6D7CB-D7FBFFA0-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",Hanunoo:"1720-1734",Hebrew:"0591-05C705D0-05EA05F0-05F4FB1D-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FB4F",Hiragana:"3041-3096309D-309F",Inherited:"0300-036F04850486064B-0655065F0670095109521CD0-1CD21CD4-1CE01CE2-1CE81CED1CF41DC0-1DE61DFC-1DFF200C200D20D0-20F0302A-302D3099309AFE00-FE0FFE20-FE26",Javanese:"A980-A9CDA9CF-A9D9A9DEA9DF",Kannada:"0C820C830C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBC-0CC40CC6-0CC80CCA-0CCD0CD50CD60CDE0CE0-0CE30CE6-0CEF0CF10CF2",Katakana:"30A1-30FA30FD-30FF31F0-31FF32D0-32FE3300-3357FF66-FF6FFF71-FF9D",Kayah_Li:"A900-A92F",Khmer:"1780-17DD17E0-17E917F0-17F919E0-19FF",Lao:"0E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB90EBB-0EBD0EC0-0EC40EC60EC8-0ECD0ED0-0ED90EDC-0EDF",Latin:"0041-005A0061-007A00AA00BA00C0-00D600D8-00F600F8-02B802E0-02E41D00-1D251D2C-1D5C1D62-1D651D6B-1D771D79-1DBE1E00-1EFF2071207F2090-209C212A212B2132214E2160-21882C60-2C7FA722-A787A78B-A78EA790-A793A7A0-A7AAA7F8-A7FFFB00-FB06FF21-FF3AFF41-FF5A",Lepcha:"1C00-1C371C3B-1C491C4D-1C4F",Limbu:"1900-191C1920-192B1930-193B19401944-194F",Lisu:"A4D0-A4FF",Malayalam:"0D020D030D05-0D0C0D0E-0D100D12-0D3A0D3D-0D440D46-0D480D4A-0D4E0D570D60-0D630D66-0D750D79-0D7F",Mandaic:"0840-085B085E",Meetei_Mayek:"AAE0-AAF6ABC0-ABEDABF0-ABF9",Mongolian:"1800180118041806-180E1810-18191820-18771880-18AA",Myanmar:"1000-109FAA60-AA7B",New_Tai_Lue:"1980-19AB19B0-19C919D0-19DA19DE19DF",Nko:"07C0-07FA",Ogham:"1680-169C",Ol_Chiki:"1C50-1C7F",Oriya:"0B01-0B030B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3C-0B440B470B480B4B-0B4D0B560B570B5C0B5D0B5F-0B630B66-0B77",Phags_Pa:"A840-A877",Rejang:"A930-A953A95F",Runic:"16A0-16EA16EE-16F0",Samaritan:"0800-082D0830-083E",Saurashtra:"A880-A8C4A8CE-A8D9",Sinhala:"0D820D830D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60DCA0DCF-0DD40DD60DD8-0DDF0DF2-0DF4",Sundanese:"1B80-1BBF1CC0-1CC7",Syloti_Nagri:"A800-A82B",Syriac:"0700-070D070F-074A074D-074F",Tagalog:"1700-170C170E-1714",Tagbanwa:"1760-176C176E-177017721773",Tai_Le:"1950-196D1970-1974",Tai_Tham:"1A20-1A5E1A60-1A7C1A7F-1A891A90-1A991AA0-1AAD",Tai_Viet:"AA80-AAC2AADB-AADF",Tamil:"0B820B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BBE-0BC20BC6-0BC80BCA-0BCD0BD00BD70BE6-0BFA",Telugu:"0C01-0C030C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D-0C440C46-0C480C4A-0C4D0C550C560C580C590C60-0C630C66-0C6F0C78-0C7F",Thaana:"0780-07B1",Thai:"0E01-0E3A0E40-0E5B",Tibetan:"0F00-0F470F49-0F6C0F71-0F970F99-0FBC0FBE-0FCC0FCE-0FD40FD90FDA",Tifinagh:"2D30-2D672D6F2D702D7F",Vai:"A500-A62B",Yi:"A000-A48CA490-A4C6"})}(d),function(a){"use strict";if(!a.addUnicodePackage)throw new ReferenceError("Unicode Base must be loaded before Unicode Blocks");a.install("extensibility"),a.addUnicodePackage({InBasic_Latin:"0000-007F",InLatin_1_Supplement:"0080-00FF",InLatin_Extended_A:"0100-017F",InLatin_Extended_B:"0180-024F",InIPA_Extensions:"0250-02AF",InSpacing_Modifier_Letters:"02B0-02FF",InCombining_Diacritical_Marks:"0300-036F",InGreek_and_Coptic:"0370-03FF",InCyrillic:"0400-04FF",InCyrillic_Supplement:"0500-052F",InArmenian:"0530-058F",InHebrew:"0590-05FF",InArabic:"0600-06FF",InSyriac:"0700-074F",InArabic_Supplement:"0750-077F",InThaana:"0780-07BF",InNKo:"07C0-07FF",InSamaritan:"0800-083F",InMandaic:"0840-085F",InArabic_Extended_A:"08A0-08FF",InDevanagari:"0900-097F",InBengali:"0980-09FF",InGurmukhi:"0A00-0A7F",InGujarati:"0A80-0AFF",InOriya:"0B00-0B7F",InTamil:"0B80-0BFF",InTelugu:"0C00-0C7F",InKannada:"0C80-0CFF",InMalayalam:"0D00-0D7F",InSinhala:"0D80-0DFF",InThai:"0E00-0E7F",InLao:"0E80-0EFF",InTibetan:"0F00-0FFF",InMyanmar:"1000-109F",InGeorgian:"10A0-10FF",InHangul_Jamo:"1100-11FF",InEthiopic:"1200-137F",InEthiopic_Supplement:"1380-139F",InCherokee:"13A0-13FF",InUnified_Canadian_Aboriginal_Syllabics:"1400-167F",InOgham:"1680-169F",InRunic:"16A0-16FF",InTagalog:"1700-171F",InHanunoo:"1720-173F",InBuhid:"1740-175F",InTagbanwa:"1760-177F",InKhmer:"1780-17FF",InMongolian:"1800-18AF",InUnified_Canadian_Aboriginal_Syllabics_Extended:"18B0-18FF",InLimbu:"1900-194F",InTai_Le:"1950-197F",InNew_Tai_Lue:"1980-19DF",InKhmer_Symbols:"19E0-19FF",InBuginese:"1A00-1A1F",InTai_Tham:"1A20-1AAF",InBalinese:"1B00-1B7F",InSundanese:"1B80-1BBF",InBatak:"1BC0-1BFF",InLepcha:"1C00-1C4F",InOl_Chiki:"1C50-1C7F",InSundanese_Supplement:"1CC0-1CCF",InVedic_Extensions:"1CD0-1CFF",InPhonetic_Extensions:"1D00-1D7F",InPhonetic_Extensions_Supplement:"1D80-1DBF",InCombining_Diacritical_Marks_Supplement:"1DC0-1DFF",InLatin_Extended_Additional:"1E00-1EFF",InGreek_Extended:"1F00-1FFF",InGeneral_Punctuation:"2000-206F",InSuperscripts_and_Subscripts:"2070-209F",InCurrency_Symbols:"20A0-20CF",InCombining_Diacritical_Marks_for_Symbols:"20D0-20FF",InLetterlike_Symbols:"2100-214F",InNumber_Forms:"2150-218F",InArrows:"2190-21FF",InMathematical_Operators:"2200-22FF",InMiscellaneous_Technical:"2300-23FF",InControl_Pictures:"2400-243F",InOptical_Character_Recognition:"2440-245F",InEnclosed_Alphanumerics:"2460-24FF",InBox_Drawing:"2500-257F",InBlock_Elements:"2580-259F",InGeometric_Shapes:"25A0-25FF",InMiscellaneous_Symbols:"2600-26FF",InDingbats:"2700-27BF",InMiscellaneous_Mathematical_Symbols_A:"27C0-27EF",InSupplemental_Arrows_A:"27F0-27FF",InBraille_Patterns:"2800-28FF",InSupplemental_Arrows_B:"2900-297F",InMiscellaneous_Mathematical_Symbols_B:"2980-29FF",InSupplemental_Mathematical_Operators:"2A00-2AFF",InMiscellaneous_Symbols_and_Arrows:"2B00-2BFF",InGlagolitic:"2C00-2C5F",InLatin_Extended_C:"2C60-2C7F",InCoptic:"2C80-2CFF",InGeorgian_Supplement:"2D00-2D2F",InTifinagh:"2D30-2D7F",InEthiopic_Extended:"2D80-2DDF",InCyrillic_Extended_A:"2DE0-2DFF",InSupplemental_Punctuation:"2E00-2E7F",InCJK_Radicals_Supplement:"2E80-2EFF",InKangxi_Radicals:"2F00-2FDF",InIdeographic_Description_Characters:"2FF0-2FFF",InCJK_Symbols_and_Punctuation:"3000-303F",InHiragana:"3040-309F",InKatakana:"30A0-30FF",InBopomofo:"3100-312F",InHangul_Compatibility_Jamo:"3130-318F",InKanbun:"3190-319F",InBopomofo_Extended:"31A0-31BF",InCJK_Strokes:"31C0-31EF",InKatakana_Phonetic_Extensions:"31F0-31FF",InEnclosed_CJK_Letters_and_Months:"3200-32FF",InCJK_Compatibility:"3300-33FF",InCJK_Unified_Ideographs_Extension_A:"3400-4DBF",InYijing_Hexagram_Symbols:"4DC0-4DFF",InCJK_Unified_Ideographs:"4E00-9FFF",InYi_Syllables:"A000-A48F",InYi_Radicals:"A490-A4CF",InLisu:"A4D0-A4FF",InVai:"A500-A63F",InCyrillic_Extended_B:"A640-A69F",InBamum:"A6A0-A6FF",InModifier_Tone_Letters:"A700-A71F",InLatin_Extended_D:"A720-A7FF",InSyloti_Nagri:"A800-A82F",InCommon_Indic_Number_Forms:"A830-A83F",InPhags_pa:"A840-A87F",InSaurashtra:"A880-A8DF",InDevanagari_Extended:"A8E0-A8FF",InKayah_Li:"A900-A92F",InRejang:"A930-A95F",InHangul_Jamo_Extended_A:"A960-A97F",InJavanese:"A980-A9DF",InCham:"AA00-AA5F",InMyanmar_Extended_A:"AA60-AA7F",InTai_Viet:"AA80-AADF",InMeetei_Mayek_Extensions:"AAE0-AAFF",InEthiopic_Extended_A:"AB00-AB2F",InMeetei_Mayek:"ABC0-ABFF",InHangul_Syllables:"AC00-D7AF",InHangul_Jamo_Extended_B:"D7B0-D7FF",InHigh_Surrogates:"D800-DB7F",InHigh_Private_Use_Surrogates:"DB80-DBFF",InLow_Surrogates:"DC00-DFFF",InPrivate_Use_Area:"E000-F8FF",InCJK_Compatibility_Ideographs:"F900-FAFF",InAlphabetic_Presentation_Forms:"FB00-FB4F",InArabic_Presentation_Forms_A:"FB50-FDFF",InVariation_Selectors:"FE00-FE0F",InVertical_Forms:"FE10-FE1F",InCombining_Half_Marks:"FE20-FE2F",InCJK_Compatibility_Forms:"FE30-FE4F",InSmall_Form_Variants:"FE50-FE6F",InArabic_Presentation_Forms_B:"FE70-FEFF",InHalfwidth_and_Fullwidth_Forms:"FF00-FFEF",InSpecials:"FFF0-FFFF"})}(d),function(a){"use strict";if(!a.addUnicodePackage)throw new ReferenceError("Unicode Base must be loaded before Unicode Properties");a.install("extensibility"),a.addUnicodePackage({Alphabetic:"0041-005A0061-007A00AA00B500BA00C0-00D600D8-00F600F8-02C102C6-02D102E0-02E402EC02EE03450370-037403760377037A-037D03860388-038A038C038E-03A103A3-03F503F7-0481048A-05270531-055605590561-058705B0-05BD05BF05C105C205C405C505C705D0-05EA05F0-05F20610-061A0620-06570659-065F066E-06D306D5-06DC06E1-06E806ED-06EF06FA-06FC06FF0710-073F074D-07B107CA-07EA07F407F507FA0800-0817081A-082C0840-085808A008A2-08AC08E4-08E908F0-08FE0900-093B093D-094C094E-09500955-09630971-09770979-097F0981-09830985-098C098F09900993-09A809AA-09B009B209B6-09B909BD-09C409C709C809CB09CC09CE09D709DC09DD09DF-09E309F009F10A01-0A030A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A3E-0A420A470A480A4B0A4C0A510A59-0A5C0A5E0A70-0A750A81-0A830A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD-0AC50AC7-0AC90ACB0ACC0AD00AE0-0AE30B01-0B030B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D-0B440B470B480B4B0B4C0B560B570B5C0B5D0B5F-0B630B710B820B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BBE-0BC20BC6-0BC80BCA-0BCC0BD00BD70C01-0C030C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D-0C440C46-0C480C4A-0C4C0C550C560C580C590C60-0C630C820C830C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD-0CC40CC6-0CC80CCA-0CCC0CD50CD60CDE0CE0-0CE30CF10CF20D020D030D05-0D0C0D0E-0D100D12-0D3A0D3D-0D440D46-0D480D4A-0D4C0D4E0D570D60-0D630D7A-0D7F0D820D830D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60DCF-0DD40DD60DD8-0DDF0DF20DF30E01-0E3A0E40-0E460E4D0E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB90EBB-0EBD0EC0-0EC40EC60ECD0EDC-0EDF0F000F40-0F470F49-0F6C0F71-0F810F88-0F970F99-0FBC1000-10361038103B-103F1050-10621065-1068106E-1086108E109C109D10A0-10C510C710CD10D0-10FA10FC-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A135F1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA16EE-16F01700-170C170E-17131720-17331740-17531760-176C176E-1770177217731780-17B317B6-17C817D717DC1820-18771880-18AA18B0-18F51900-191C1920-192B1930-19381950-196D1970-19741980-19AB19B0-19C91A00-1A1B1A20-1A5E1A61-1A741AA71B00-1B331B35-1B431B45-1B4B1B80-1BA91BAC-1BAF1BBA-1BE51BE7-1BF11C00-1C351C4D-1C4F1C5A-1C7D1CE9-1CEC1CEE-1CF31CF51CF61D00-1DBF1E00-1F151F18-1F1D1F20-1F451F48-1F4D1F50-1F571F591F5B1F5D1F5F-1F7D1F80-1FB41FB6-1FBC1FBE1FC2-1FC41FC6-1FCC1FD0-1FD31FD6-1FDB1FE0-1FEC1FF2-1FF41FF6-1FFC2071207F2090-209C21022107210A-211321152119-211D212421262128212A-212D212F-2139213C-213F2145-2149214E2160-218824B6-24E92C00-2C2E2C30-2C5E2C60-2CE42CEB-2CEE2CF22CF32D00-2D252D272D2D2D30-2D672D6F2D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE2DE0-2DFF2E2F3005-30073021-30293031-30353038-303C3041-3096309D-309F30A1-30FA30FC-30FF3105-312D3131-318E31A0-31BA31F0-31FF3400-4DB54E00-9FCCA000-A48CA4D0-A4FDA500-A60CA610-A61FA62AA62BA640-A66EA674-A67BA67F-A697A69F-A6EFA717-A71FA722-A788A78B-A78EA790-A793A7A0-A7AAA7F8-A801A803-A805A807-A80AA80C-A827A840-A873A880-A8C3A8F2-A8F7A8FBA90A-A92AA930-A952A960-A97CA980-A9B2A9B4-A9BFA9CFAA00-AA36AA40-AA4DAA60-AA76AA7AAA80-AABEAAC0AAC2AADB-AADDAAE0-AAEFAAF2-AAF5AB01-AB06AB09-AB0EAB11-AB16AB20-AB26AB28-AB2EABC0-ABEAAC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA6DFA70-FAD9FB00-FB06FB13-FB17FB1D-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF21-FF3AFF41-FF5AFF66-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",Uppercase:"0041-005A00C0-00D600D8-00DE01000102010401060108010A010C010E01100112011401160118011A011C011E01200122012401260128012A012C012E01300132013401360139013B013D013F0141014301450147014A014C014E01500152015401560158015A015C015E01600162016401660168016A016C016E017001720174017601780179017B017D018101820184018601870189-018B018E-0191019301940196-0198019C019D019F01A001A201A401A601A701A901AC01AE01AF01B1-01B301B501B701B801BC01C401C701CA01CD01CF01D101D301D501D701D901DB01DE01E001E201E401E601E801EA01EC01EE01F101F401F6-01F801FA01FC01FE02000202020402060208020A020C020E02100212021402160218021A021C021E02200222022402260228022A022C022E02300232023A023B023D023E02410243-02460248024A024C024E03700372037603860388-038A038C038E038F0391-03A103A3-03AB03CF03D2-03D403D803DA03DC03DE03E003E203E403E603E803EA03EC03EE03F403F703F903FA03FD-042F04600462046404660468046A046C046E04700472047404760478047A047C047E0480048A048C048E04900492049404960498049A049C049E04A004A204A404A604A804AA04AC04AE04B004B204B404B604B804BA04BC04BE04C004C104C304C504C704C904CB04CD04D004D204D404D604D804DA04DC04DE04E004E204E404E604E804EA04EC04EE04F004F204F404F604F804FA04FC04FE05000502050405060508050A050C050E05100512051405160518051A051C051E05200522052405260531-055610A0-10C510C710CD1E001E021E041E061E081E0A1E0C1E0E1E101E121E141E161E181E1A1E1C1E1E1E201E221E241E261E281E2A1E2C1E2E1E301E321E341E361E381E3A1E3C1E3E1E401E421E441E461E481E4A1E4C1E4E1E501E521E541E561E581E5A1E5C1E5E1E601E621E641E661E681E6A1E6C1E6E1E701E721E741E761E781E7A1E7C1E7E1E801E821E841E861E881E8A1E8C1E8E1E901E921E941E9E1EA01EA21EA41EA61EA81EAA1EAC1EAE1EB01EB21EB41EB61EB81EBA1EBC1EBE1EC01EC21EC41EC61EC81ECA1ECC1ECE1ED01ED21ED41ED61ED81EDA1EDC1EDE1EE01EE21EE41EE61EE81EEA1EEC1EEE1EF01EF21EF41EF61EF81EFA1EFC1EFE1F08-1F0F1F18-1F1D1F28-1F2F1F38-1F3F1F48-1F4D1F591F5B1F5D1F5F1F68-1F6F1FB8-1FBB1FC8-1FCB1FD8-1FDB1FE8-1FEC1FF8-1FFB21022107210B-210D2110-211221152119-211D212421262128212A-212D2130-2133213E213F21452160-216F218324B6-24CF2C00-2C2E2C602C62-2C642C672C692C6B2C6D-2C702C722C752C7E-2C802C822C842C862C882C8A2C8C2C8E2C902C922C942C962C982C9A2C9C2C9E2CA02CA22CA42CA62CA82CAA2CAC2CAE2CB02CB22CB42CB62CB82CBA2CBC2CBE2CC02CC22CC42CC62CC82CCA2CCC2CCE2CD02CD22CD42CD62CD82CDA2CDC2CDE2CE02CE22CEB2CED2CF2A640A642A644A646A648A64AA64CA64EA650A652A654A656A658A65AA65CA65EA660A662A664A666A668A66AA66CA680A682A684A686A688A68AA68CA68EA690A692A694A696A722A724A726A728A72AA72CA72EA732A734A736A738A73AA73CA73EA740A742A744A746A748A74AA74CA74EA750A752A754A756A758A75AA75CA75EA760A762A764A766A768A76AA76CA76EA779A77BA77DA77EA780A782A784A786A78BA78DA790A792A7A0A7A2A7A4A7A6A7A8A7AAFF21-FF3A",Lowercase:"0061-007A00AA00B500BA00DF-00F600F8-00FF01010103010501070109010B010D010F01110113011501170119011B011D011F01210123012501270129012B012D012F01310133013501370138013A013C013E014001420144014601480149014B014D014F01510153015501570159015B015D015F01610163016501670169016B016D016F0171017301750177017A017C017E-0180018301850188018C018D019201950199-019B019E01A101A301A501A801AA01AB01AD01B001B401B601B901BA01BD-01BF01C601C901CC01CE01D001D201D401D601D801DA01DC01DD01DF01E101E301E501E701E901EB01ED01EF01F001F301F501F901FB01FD01FF02010203020502070209020B020D020F02110213021502170219021B021D021F02210223022502270229022B022D022F02310233-0239023C023F0240024202470249024B024D024F-02930295-02B802C002C102E0-02E40345037103730377037A-037D039003AC-03CE03D003D103D5-03D703D903DB03DD03DF03E103E303E503E703E903EB03ED03EF-03F303F503F803FB03FC0430-045F04610463046504670469046B046D046F04710473047504770479047B047D047F0481048B048D048F04910493049504970499049B049D049F04A104A304A504A704A904AB04AD04AF04B104B304B504B704B904BB04BD04BF04C204C404C604C804CA04CC04CE04CF04D104D304D504D704D904DB04DD04DF04E104E304E504E704E904EB04ED04EF04F104F304F504F704F904FB04FD04FF05010503050505070509050B050D050F05110513051505170519051B051D051F05210523052505270561-05871D00-1DBF1E011E031E051E071E091E0B1E0D1E0F1E111E131E151E171E191E1B1E1D1E1F1E211E231E251E271E291E2B1E2D1E2F1E311E331E351E371E391E3B1E3D1E3F1E411E431E451E471E491E4B1E4D1E4F1E511E531E551E571E591E5B1E5D1E5F1E611E631E651E671E691E6B1E6D1E6F1E711E731E751E771E791E7B1E7D1E7F1E811E831E851E871E891E8B1E8D1E8F1E911E931E95-1E9D1E9F1EA11EA31EA51EA71EA91EAB1EAD1EAF1EB11EB31EB51EB71EB91EBB1EBD1EBF1EC11EC31EC51EC71EC91ECB1ECD1ECF1ED11ED31ED51ED71ED91EDB1EDD1EDF1EE11EE31EE51EE71EE91EEB1EED1EEF1EF11EF31EF51EF71EF91EFB1EFD1EFF-1F071F10-1F151F20-1F271F30-1F371F40-1F451F50-1F571F60-1F671F70-1F7D1F80-1F871F90-1F971FA0-1FA71FB0-1FB41FB61FB71FBE1FC2-1FC41FC61FC71FD0-1FD31FD61FD71FE0-1FE71FF2-1FF41FF61FF72071207F2090-209C210A210E210F2113212F21342139213C213D2146-2149214E2170-217F218424D0-24E92C30-2C5E2C612C652C662C682C6A2C6C2C712C732C742C76-2C7D2C812C832C852C872C892C8B2C8D2C8F2C912C932C952C972C992C9B2C9D2C9F2CA12CA32CA52CA72CA92CAB2CAD2CAF2CB12CB32CB52CB72CB92CBB2CBD2CBF2CC12CC32CC52CC72CC92CCB2CCD2CCF2CD12CD32CD52CD72CD92CDB2CDD2CDF2CE12CE32CE42CEC2CEE2CF32D00-2D252D272D2DA641A643A645A647A649A64BA64DA64FA651A653A655A657A659A65BA65DA65FA661A663A665A667A669A66BA66DA681A683A685A687A689A68BA68DA68FA691A693A695A697A723A725A727A729A72BA72DA72F-A731A733A735A737A739A73BA73DA73FA741A743A745A747A749A74BA74DA74FA751A753A755A757A759A75BA75DA75FA761A763A765A767A769A76BA76DA76F-A778A77AA77CA77FA781A783A785A787A78CA78EA791A793A7A1A7A3A7A5A7A7A7A9A7F8-A7FAFB00-FB06FB13-FB17FF41-FF5A",White_Space:"0009-000D0020008500A01680180E2000-200A20282029202F205F3000",Noncharacter_Code_Point:"FDD0-FDEFFFFEFFFF",Default_Ignorable_Code_Point:"00AD034F115F116017B417B5180B-180D200B-200F202A-202E2060-206F3164FE00-FE0FFEFFFFA0FFF0-FFF8",Any:"0000-FFFF",Ascii:"0000-007F",Assigned:"0000-0377037A-037E0384-038A038C038E-03A103A3-05270531-05560559-055F0561-05870589058A058F0591-05C705D0-05EA05F0-05F40600-06040606-061B061E-070D070F-074A074D-07B107C0-07FA0800-082D0830-083E0840-085B085E08A008A2-08AC08E4-08FE0900-09770979-097F0981-09830985-098C098F09900993-09A809AA-09B009B209B6-09B909BC-09C409C709C809CB-09CE09D709DC09DD09DF-09E309E6-09FB0A01-0A030A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A3C0A3E-0A420A470A480A4B-0A4D0A510A59-0A5C0A5E0A66-0A750A81-0A830A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABC-0AC50AC7-0AC90ACB-0ACD0AD00AE0-0AE30AE6-0AF10B01-0B030B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3C-0B440B470B480B4B-0B4D0B560B570B5C0B5D0B5F-0B630B66-0B770B820B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BBE-0BC20BC6-0BC80BCA-0BCD0BD00BD70BE6-0BFA0C01-0C030C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D-0C440C46-0C480C4A-0C4D0C550C560C580C590C60-0C630C66-0C6F0C78-0C7F0C820C830C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBC-0CC40CC6-0CC80CCA-0CCD0CD50CD60CDE0CE0-0CE30CE6-0CEF0CF10CF20D020D030D05-0D0C0D0E-0D100D12-0D3A0D3D-0D440D46-0D480D4A-0D4E0D570D60-0D630D66-0D750D79-0D7F0D820D830D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60DCA0DCF-0DD40DD60DD8-0DDF0DF2-0DF40E01-0E3A0E3F-0E5B0E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB90EBB-0EBD0EC0-0EC40EC60EC8-0ECD0ED0-0ED90EDC-0EDF0F00-0F470F49-0F6C0F71-0F970F99-0FBC0FBE-0FCC0FCE-0FDA1000-10C510C710CD10D0-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A135D-137C1380-139913A0-13F41400-169C16A0-16F01700-170C170E-17141720-17361740-17531760-176C176E-1770177217731780-17DD17E0-17E917F0-17F91800-180E1810-18191820-18771880-18AA18B0-18F51900-191C1920-192B1930-193B19401944-196D1970-19741980-19AB19B0-19C919D0-19DA19DE-1A1B1A1E-1A5E1A60-1A7C1A7F-1A891A90-1A991AA0-1AAD1B00-1B4B1B50-1B7C1B80-1BF31BFC-1C371C3B-1C491C4D-1C7F1CC0-1CC71CD0-1CF61D00-1DE61DFC-1F151F18-1F1D1F20-1F451F48-1F4D1F50-1F571F591F5B1F5D1F5F-1F7D1F80-1FB41FB6-1FC41FC6-1FD31FD6-1FDB1FDD-1FEF1FF2-1FF41FF6-1FFE2000-2064206A-20712074-208E2090-209C20A0-20B920D0-20F02100-21892190-23F32400-24262440-244A2460-26FF2701-2B4C2B50-2B592C00-2C2E2C30-2C5E2C60-2CF32CF9-2D252D272D2D2D30-2D672D6F2D702D7F-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE2DE0-2E3B2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB3000-303F3041-30963099-30FF3105-312D3131-318E3190-31BA31C0-31E331F0-321E3220-32FE3300-4DB54DC0-9FCCA000-A48CA490-A4C6A4D0-A62BA640-A697A69F-A6F7A700-A78EA790-A793A7A0-A7AAA7F8-A82BA830-A839A840-A877A880-A8C4A8CE-A8D9A8E0-A8FBA900-A953A95F-A97CA980-A9CDA9CF-A9D9A9DEA9DFAA00-AA36AA40-AA4DAA50-AA59AA5C-AA7BAA80-AAC2AADB-AAF6AB01-AB06AB09-AB0EAB11-AB16AB20-AB26AB28-AB2EABC0-ABEDABF0-ABF9AC00-D7A3D7B0-D7C6D7CB-D7FBD800-FA6DFA70-FAD9FB00-FB06FB13-FB17FB1D-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBC1FBD3-FD3FFD50-FD8FFD92-FDC7FDF0-FDFDFE00-FE19FE20-FE26FE30-FE52FE54-FE66FE68-FE6BFE70-FE74FE76-FEFCFEFFFF01-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDCFFE0-FFE6FFE8-FFEEFFF9-FFFD"})}(d),function(a){"use strict";function b(a,b,c,d){return{value:a,name:b,start:c,end:d}}a.matchRecursive=function(c,d,e,f,g){f=f||"",g=g||{};var h,i,j,k,l,m=f.indexOf("g")>-1,n=f.indexOf("y")>-1,o=f.replace(/y/g,""),p=g.escapeChar,q=g.valueNames,r=[],s=0,t=0,u=0,v=0;if(d=a(d,o),e=a(e,o),p){if(p.length>1)throw new SyntaxError("can't use more than one escape character");p=a.escape(p),l=new RegExp("(?:"+p+"[\\S\\s]|(?:(?!"+a.union([d,e]).source+")[^"+p+"])+)+",f.replace(/[^im]+/g,""))}for(;;){if(p&&(u+=(a.exec(c,l,u,"sticky")||[""])[0].length),j=a.exec(c,d,u),k=a.exec(c,e,u),j&&k&&(j.index<=k.index?k=null:j=null),j||k)t=(j||k).index,u=t+(j||k)[0].length;else if(!s)break;if(n&&!s&&t>v)break;if(j)s||(h=t,i=u),++s;else{if(!k||!s)throw new Error("string contains unbalanced delimiters");if(!--s&&(q?(q[0]&&h>v&&r.push(b(q[0],c.slice(v,h),v,h)),q[1]&&r.push(b(q[1],c.slice(h,i),h,i)),q[2]&&r.push(b(q[2],c.slice(i,t),i,t)),q[3]&&r.push(b(q[3],c.slice(t,u),t,u))):r.push(c.slice(i,t)),v=u,!m))break}t===u&&++u}return m&&!n&&q&&q[0]&&c.length>v&&r.push(b(q[0],c.slice(v),v,c.length)),r}}(d),function(a){"use strict";function b(a){var b=/^(?:\(\?:\))?\^/,c=/\$(?:\(\?:\))?$/;return c.test(a.replace(/\\[\s\S]/g,""))?a.replace(b,"").replace(c,""):a}function c(b){return a.isRegExp(b)?b.xregexp&&!b.xregexp.isNative?b:a(b.source):a(b)}var d=/(\()(?!\?)|\\([1-9]\d*)|\\[\s\S]|\[(?:[^\\\]]|\\[\s\S])*]/g,e=a.union([/\({{([\w$]+)}}\)|{{([\w$]+)}}/,d],"g");a.build=function(f,g,h){var i,j,k,l,m=/^\(\?([\w$]+)\)/.exec(f),n={},o=0,p=0,q=[0];m&&(h=h||"",m[1].replace(/./g,function(a){h+=h.indexOf(a)>-1?"":a}));for(l in g)g.hasOwnProperty(l)&&(k=c(g[l]),n[l]={pattern:b(k.source),names:k.xregexp.captureNames||[]});return f=c(f),j=f.xregexp.captureNames||[],f=f.source.replace(e,function(a,b,c,e,f){var g,h,k=b||c;if(k){if(!n.hasOwnProperty(k))throw new ReferenceError("undefined property "+a);return b?(g=j[p],q[++p]=++o,h="(?<"+(g||k)+">"):h="(?:",i=o,h+n[k].pattern.replace(d,function(a,b,c){if(b){if(g=n[k].names[o-i],++o,g)return"(?<"+g+">"}else if(c)return"\\"+(+c+i);return a})+")"}if(e){if(g=j[p],q[++p]=++o,g)return"(?<"+g+">"}else if(f)return"\\"+q[+f];return a}),a(f,h)}}(d),function(a){"use strict";function b(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}b(a.prototype,{apply:function(a,b){return this.test(b[0])},call:function(a,b){return this.test(b)},forEach:function(b,c,d){return a.forEach(b,this,c,d)},globalize:function(){return a.globalize(this)},xexec:function(b,c,d){return a.exec(b,this,c,d)},xtest:function(b,c,d){return a.test(b,this,c,d)}})}(d)},{}],2:[function(a,b,c){function d(a){if(!this)return new d(a);if(this._rawOpts=l(!0,{},a),this._opts=a,this._opts.path?this._opts.path instanceof q||(this._opts.path=q(this._opts.path)):this._opts.path="",this._opts.method?"*"==this._opts.method||this._opts.method.indexOf("*")>-1?this._opts.method=this.httpMethods:"string"==typeof this._opts.method&&(this._opts.method=[this._opts.method]):this._opts.method=this.httpMethods,this._opts.method=n.map(this._opts.method,function(a){return a.toUpperCase()}),!this._opts.mapping)throw new h("Descriptors must be initialised with a mapping",{opts:a,descriptor:this});if("string"==typeof this._opts.mapping){if(!this._opts.collection)throw new h("Passed mapping as string, but did not specify the collection it belongs to",{opts:a,descriptor:this});var b;if(b="string"==typeof this._opts.collection?k[this._opts.collection]:this._opts.collection,!b)throw new h("Collection "+this._opts.collection+" does not exist",{opts:a,descriptor:this});var c=b[this._opts.mapping];if(!c)throw new h("Mapping "+this._opts.mapping+" does not exist",{opts:a,descriptor:this});this._opts.mapping=c}var e=this._opts.data;if(e&&e.length){var f,g=e.split(".");if(1==g.length)f=g[0];else{var i={};f=i;for(var m=g[0],o=1;o<g.length;o++){var p=g[o];if(o==g.length-1)i[m]=p;else{var r={};i[m]=r,i=r,m=p}}}this._opts.data=f}j.call(this,"path",this._opts),j.call(this,"method",this._opts),j.call(this,"mapping",this._opts),j.call(this,"data",this._opts),j.call(this,"transforms",this._opts)}function e(a,b){var c=b,d=Object.keys(b);i(1==d.length);for(var e=d[0],f=b;"string"!=typeof f[e];)f=f[e],d=Object.keys(f),i(1==d.length),e=d[0];var g=f[e],h={};return f[e]=h,h[g]=a,c}var f=siesta._internal,g=f.log,h=f.error.RestError,i=f.misc.assert,j=f.misc.defineSubProperty,k=f.CollectionRegistry,l=f.extend,m=f.util,n=m._,o=g.loggerWithName("Descriptor");o.setLevel(g.Level.warn);var p=["index","input"],q=a("xregexp").XRegExp;d.prototype.httpMethods=["POST","PATCH","PUT","HEAD","GET","DELETE","OPTIONS","TRACE","CONNECT"],d.prototype._matchPath=function(a){var b=q.exec(a,this.path),c=null;if(b){c={};for(var d in b)b.hasOwnProperty(d)&&isNaN(parseInt(d))&&p.indexOf(d)<0&&(c[d]=b[d])}return c},d.prototype._matchMethod=function(a){for(var b=0;b<this.method.length;b++)if(a.toUpperCase()==this.method[b])return!0;return!1},d.prototype._embedData=function(a){if(this.data){var b;return"string"==typeof this.data?(b={},b[this.data]=a):b=e(a,l(!0,{},this.data)),b}return a},d.prototype._extractData=function(a){if(o.debug.isEnabled&&o.debug("_extractData",a),this.data){if("string"==typeof this.data)return a[this.data];var b=Object.keys(this.data);i(1==b.length);for(var c=a,d=this.data;"string"!=typeof d;){b=Object.keys(d),i(1==b.length);var e=b[0];if(d=d[e],c=c[e],!c)break}return c?c[d]:null}return a},d.prototype._matchConfig=function(a){var b=a.type?this._matchMethod(a.type):{};return b&&(b=a.url?this._matchPath(a.url):{}),b&&o.trace.isEnabled&&o.trace("matched config"),b},d.prototype._matchData=function(a){var b=null;return this.data?a&&(b=this._extractData(a)):b=a,b&&o.trace("matched data"),b},d.prototype.match=function(a,b){var c=this._matchConfig(a),d=!!c,e=!1;if(d)if(o.trace("config matches"),e=this._matchData(b),d=!!e){var f;if(m.isArray(e))for(f in c)c.hasOwnProperty(f)&&n.each(e,function(a){a[f]=c[f]});else for(f in c)c.hasOwnProperty(f)&&(e[f]=c[f]);o.trace("data matches")}else o.trace("data doesnt match");else o.trace("config doesnt match");return e},d.prototype._transformData=function(a){var b=this.transforms;for(var c in b)if(b.hasOwnProperty(c)&&a[c]){var d=b[c],e=a[c];if("string"==typeof d){var f=d.split(".");if(delete a[c],1==f.length)a[f[0]]=e;else{a[f[0]]={};for(var g=a[f[0]],i=1;i<f.length-1;i++){var j=f[i];g[j]={},g=g[j]}g[f[f.length-1]]=e}}else{if("function"!=typeof d)throw new h("Invalid transformer");var k=d(e);m.isArray(k)?(delete a[c],a[k[0]]=k[1]):a[c]=k}}},c.Descriptor=d},{xregexp:1}],3:[function(a,b,c){function d(){return this?(this.requestDescriptors={},void(this.responseDescriptors={})):new d(opts)}function e(a,b){var c=b.mapping,d=c.collection;j(c),j(d),j("string"==typeof d),a[d]||(a[d]=[]),a[d].push(b)}function f(a,b){var c;return c="string"==typeof b?a[b]||[]:a[b._name]||[]}var g=siesta._internal,h=g.log,i=h.loggerWithName("DescriptorRegistry");i.setLevel(h.Level.warn);var j=g.misc.assert;d.prototype.registerRequestDescriptor=function(a){e(this.requestDescriptors,a)},d.prototype.registerResponseDescriptor=function(a){i.trace.isEnabled&&i.trace("registerResponseDescriptor"),e(this.responseDescriptors,a)},d.prototype.requestDescriptorsForCollection=function(a){return f(this.requestDescriptors,a)},d.prototype.responseDescriptorsForCollection=function(a){var b=f(this.responseDescriptors,a);return b.length||i.debug.isEnabled&&i.debug("No response descriptors for collection ",this.responseDescriptors),b},d.prototype.reset=function(){this.requestDescriptors={},this.responseDescriptors={}},c.DescriptorRegistry=new d},{}],4:[function(a){!function(){if(!siesta)throw new Error("Could not find siesta");var b=siesta.Collection,c=siesta._internal.log,d=siesta._internal.util,e=siesta._internal.q,f=a("./descriptorRegistry").DescriptorRegistry,g=c.loggerWithName("HTTP");g.setLevel(c.Level.warn),siesta.ext||(siesta.ext={}),siesta.ext.http={RequestDescriptor:a("./requestDescriptor").RequestDescriptor,ResponseDescriptor:a("./responseDescriptor").ResponseDescriptor,Descriptor:a("./descriptor").Descriptor,Serialiser:a("./serialiser"),DescriptorRegistry:a("./descriptorRegistry").DescriptorRegistry},b.prototype._httpResponse=function(a,b){var c,h=this,i=Array.prototype.slice.call(arguments,2),j={},k=this._name;"function"==typeof i[0]?c=i[0]:"object"==typeof i[0]&&(j=i[0],c=i[1]);var l=e.defer();if(c=d.constructCallbackAndPromiseHandler(c,l),j.type=a,!j.url){var m=this.baseURL;j.url=m+b}j.success=function(a,b,d){g.trace.isEnabled&&g.trace(j.type+" "+d.status+" "+j.url+": "+JSON.stringify(a,null,4));for(var e,i,l={data:a,textStatus:b,jqXHR:d},m=f.responseDescriptorsForCollection(h),n=0;n<m.length;n++){var o=m[n];if(i=o.match(j,a)){e=o;break}}if(e)if(g.trace.isEnabled&&g.trace("Mapping extracted data: "+JSON.stringify(i,null,4)),"object"==typeof i){var p=e.mapping;p.map(i,function(a,b){c&&c(a,b,l)},j.obj)}else c(null,!0,l);else if(c){if(!k)throw new RestError("Unnamed collection");c(null,null,l)}},j.error=function(a,b,d){var e={jqXHR:a,textStatus:b,errorThrown:d};c&&c(e,null,e)},$.ajax(j)},b.prototype._httpRequest=function(a,b,c){var h,i=this,j=Array.prototype.slice.call(arguments,2),k={};"function"==typeof j[0]?h=j[0]:"object"==typeof j[0]&&(k=j[0],h=j[1]);var l=e.defer();h=d.constructCallbackAndPromiseHandler(h,l),j=Array.prototype.slice.call(j,2);var m,n=f.requestDescriptorsForCollection(this);k.type=a;var o=this.baseURL;k.url=o+b;for(var p=0;p<n.length;p++){var q=n[p];if(q._matchConfig(k)){m=q;break}}return m?(g.trace.isEnabled&&g.trace("Matched descriptor: "+m._dump(!0)),m._serialise(c,function(d,e){g.trace.isEnabled&&g.trace("_serialise",{err:d,data:e}),d?h&&h(d,null,null):(k.data=e,k.obj=c,_.partial(i._httpResponse,a,b,k,h).apply(i,j))
})):h&&(g.trace.isEnabled&&g.trace("Did not match descriptor"),h(null,null,null)),l.promise}}()},{"./descriptor":2,"./descriptorRegistry":3,"./requestDescriptor":5,"./responseDescriptor":6,"./serialiser":7}],5:[function(a,b,c){function d(a){return this?(e.call(this,a),this._opts.serializer&&(this._opts.serialiser=this._opts.serializer),this._opts.serialiser||(this._opts.serialiser=f.depthSerializer(0)),k.call(this,"serialiser",this._opts),void k.call(this,"serializer",this._opts,"serialiser")):new d(a)}var e=a("./descriptor").Descriptor,f=a("./serialiser"),g=siesta._internal,h=g.q,i=g.util,j=g.log,k=g.misc.defineSubProperty,l=j.loggerWithName("RequestDescriptor");l.setLevel(j.Level.warn),d.prototype=Object.create(e.prototype),d.prototype._serialise=function(a,b){var c=h.defer();b=i.constructCallbackAndPromiseHandler(b,c);var d=this;l.trace.isEnabled&&l.trace("_serialise");var e,f=this.serialiser(a,function(a,c){e||(d._transformData(c),b&&b(a,d._embedData(c)))});return void 0!==f?(l.trace.isEnabled&&l.trace("serialiser doesnt use a callback"),e=!0,d._transformData(f),b&&b(null,d._embedData(f))):l.trace.isEnabled&&l.trace("serialiser uses a callback",this.serialiser),c.promise},d.prototype._dump=function(a){var b={};b.methods=this.method,b.mapping=this.mapping.type,b.path=this._rawOpts.path;var c;c="function"==typeof this._rawOpts.serialiser?"function () { ... }":this._rawOpts.serialiser,b.serialiser=c;var d={};for(var e in this.transforms)if(this.transforms.hasOwnProperty(e)){var f=this.transforms[e];d[e]="function"==typeof f?"function () { ... }":this.transforms[e]}return b.transforms=d,a?JSON.stringify(b,null,4):b},c.RequestDescriptor=d},{"./descriptor":2,"./serialiser":7}],6:[function(a,b,c){function d(a){return this?void e.call(this,a):new d(a)}var e=a("./descriptor").Descriptor;d.prototype=Object.create(e.prototype),d.prototype._extractData=function(a){var b=e.prototype._extractData.call(this,a);return b&&this._transformData(b),b},d.prototype._matchData=function(a){var b=e.prototype._matchData.call(this,a);return b&&this._transformData(b),b},d.prototype._dump=function(a){var b={};b.methods=this.method,b.mapping=this.mapping.type,b.path=this._rawOpts.path;var c={};for(var d in this.transforms)if(this.transforms.hasOwnProperty(d)){var e=this.transforms[d];c[d]="function"==typeof e?"function () { ... }":this.transforms[d]}return b.transforms=c,a?JSON.stringify(b,null,4):b},c.ResponseDescriptor=d},{"./descriptor":2}],7:[function(a,b,c){function d(a){var b=a.mapping.id;return b?a[b]?a[b]:null:void(i.debug.isEnabled&&i.debug("No idfield"))}function e(a,b,c){i.trace.isEnabled&&i.trace("depthSerialiser");var d={};j.each(b._fields,function(a){i.trace.isEnabled&&i.trace("field",a),b[a]&&(d[a]=b[a])});var f=[],g=[],h={},k=[];j.each(b._relationshipFields,function(j){i.trace.isEnabled&&i.trace("relationshipField",j);var l=b[j+"Proxy"];l.isForward&&(i.debug.isEnabled&&i.debug(j),f.push(j),l.get(function(l,m){i.trace.isEnabled&&i.trace("proxy.get",j),i.debug.isEnabled&&i.debug(j,m),l?(g.push(l),k.push(j),h[j]={err:l,v:m}):m?a?e(a-1,m,function(a,b,e){a?g.push(a):d[j]=b,k.push(j),h[j]={err:a,v:m,resp:e},f.length==k.length&&c&&c(g.length?g:null,d,h)}):(k.push(j),d[j]=m[b[j+"Proxy"].forwardMapping.id],h[j]={err:l,v:m},f.length==k.length&&c&&c(g.length?g:null,d,h)):(i.debug.isEnabled&&i.debug("no value for "+j),k.push(j),h[j]={err:l,v:m},f.length==k.length&&c&&c(g.length?g:null,d,h))}))}),f.length||c&&c(null,d,{})}var f=siesta._internal,g=f.log,h=f.util,i=g.loggerWithName("Serialiser");i.setLevel(g.Level.warn);var j=h._;c.depthSerialiser=function(a){return j.partial(e,a)},c.depthSerializer=function(a){return j.partial(e,a)},c.idSerializer=d,c.idSerialiser=d},{}]},{},[4]),function c(a,b,d){function e(g,h){if(!b[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=b[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,c,a,b,d)}return b[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a,b){if(a===b)return!0;if(null==a||null==b)return!1;if(a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0}function e(a,b,c,e,f){if(!e&&!f)throw new t("Must remove or add something with a splice change.");if(void 0===c||null===c)throw new t("Must pass index to splice change");var g=a[b],h=v.partial(g.splice,c,e.length).apply(g,f);if(!d(h,e))throw new t("Objects actually removed did not match those specified in the change")}function f(a,b,c){if(!b)throw new t("Must pass removed");v.each(b,function(b){var d=c[a],e=d.indexOf(b);d.splice(e,1)})}function g(a,b,c,d){var e=a[b];if(e!=d)throw new t("Old value does not match new value: "+JSON.stringify({old:d?d:null,actualOld:e?e:null},null,4));a[b]=c}function h(){if(!this.field)throw new t("Must pass field to change");if(!this.collection)throw new t("Must pass collection to change");if(!this.mapping)throw new t("Must pass mapping to change")}function i(a){if(a._id!=this._id)throw new t('Cannot apply change with _id="'+this._id.toString()+'" to object with _id="'+a._id.toString()+'"')}function j(a,b){if(a)g.call(this,b.__values,this.field,this.new,this.old);else{var c=this.newId||(this.new?this.new._id:null),d=this.oldId||(this.old?this.old._id:null),e=b[this.field+"Proxy"];g.call(this,e,"_id",c,d);var f=this.new||(this.newId?C.get({_id:this.newId}):null),h=this.old||(this.oldId?C.get({_id:this.oldId}):null);f||h?g.call(this,e,"related",f,h):e.related=null}}function k(a,b){if(a)e.call(this,b.__values,this.field,this.index,this.removed,this.added);else{var c=this.removedId||(this.removed?v.pluck(this.removed,"_id"):[]),d=this.addedId||(this.added?v.pluck(this.added,"_id"):[]),f=b[this.field+"Proxy"],g=f.isFault;if(e.call(this,f,"_id",this.index,c,d),!g){var h=this.removed||v.map(c,function(a){return C.get({_id:a})}),i=v.reduce(h,function(a,b){return b&&a},!0),j=this.added||v.map(d,function(a){return C.get({_id:a})}),k=v.reduce(j,function(a,b){return b&&a},!0);if(i&&k)e.call(this,f,"related",this.index,h,j);else{if(!i)throw new t("If not faulted, all removed objects should be cache.");f.related=null}}}}function l(a,b){if(a)f.call(this,this.field,this.removed,b);else{var c=this.removedId||(this.removed?v.pluck(this.removed,"_id"):[]),d=b[this.field+"Proxy"],e=d.isFault;f.call(this,"_id",c,d),!e&&this.removed&&f.call(this,"related",this.removed,d)}}function m(){var a={};for(var b in K)if(K.hasOwnProperty(b)){var c=K[b];for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];A(a,e)}}return a}function n(a){return m()[a]||[]}function o(a){var b=G.defer();a=u.constructCallbackAndPromiseHandler(a,b);var c=m(),d=v.keys(c).length;if(d){I.debug.isEnabled&&I.debug("Merging "+d.toString()+" changes");var e=new w("Merge Changes",function(a){I.debug.isEnabled&&I.debug("Beggining merge operation");var b=[];for(var d in c)c.hasOwnProperty(d)&&b.push(d);var e=H.getPouch();I.debug.isEnabled&&I.debug("Getting docs"),v.each(b,function(a){L[a]={}}),e.allDocs({keys:b,include_docs:!0},function(b,d){if(b)a(b);else{I.debug.isEnabled&&I.debug("Got docs");var f=[],g=[];I.debug.isEnabled&&I.debug("Updating docs docs"),v.each(d.rows,function(a){var b;a.error?"not_found"==a.error?b={_id:a.key}:g.push(a.error):b=a.doc;var d=c[b._id];v.each(d,function(a){a.apply(b)}),f.push(b)}),I.debug.isEnabled&&I.debug("Saving docs");var h=[];h.push(function(a){v.keys(L).length?(I.debug.isEnabled&&I.debug("waiting for observations"),J=function(){I.debug.isEnabled&&I.debug("finished waiting for observations"),a()}):(I.debug.isEnabled&&I.debug("no observations to wait for"),a())}),h.push(function(a){e.bulkDocs(f,function(c,d){b?g.length?(g.push(b),a(g)):a(b):(I.debug.isEnabled&&I.debug("Saved docs",d),a())})}),u.parallel(h,a)}})});e.onCompletion(function(){a&&a(e.error)}),M.addOperation(e)}else a&&(I.debug.isEnabled&&I.debug("Nothing to merge"),a());return b.promise}function p(){var a=[];for(var b in K)if(K.hasOwnProperty(b)){var c=K[b];for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];for(var f in e)e.hasOwnProperty(f)&&(a=a.concat(e[f]))}}return a}function q(){K={}}function r(a){O.call(this,a),Object.defineProperty(this,"changes",{get:function(){return n(this._id)},enumerable:!0})}var s=siesta._internal,t=s.error.RestError,u=s.util,v=u._,w=s.Operation,x=s.OperationQueue,y=s.object,z=y.SiestaModel,A=s.extend,B=s.log,C=s.cache,D=s.coreChanges,E=D.Change,F=D.ChangeType,G=(s.collection,s.q),H=a("./pouch"),I=(a("./index"),B.loggerWithName("changes"));I.setLevel(B.Level.warn);var J,K={},L={};H.addObserver(function(a){var b=a.id;for(var c in K)if(K.hasOwnProperty(c)){var d=K[c];for(var e in d)if(d.hasOwnProperty(e)){var f=d[e];if(f[b])return delete f[b],delete L[b],void(!v.keys(L).length&&J&&(J(),J=null))}}});var M=new x("Merge Queue");M.maxConcurrentOperations=1,M.start();var N=D.registerChange;D.registerChange=function(a){D.validateChange(a);var b=a.collection,c=a.mapping,d=a._id;K[b.name]||(K[b.name]={});var e=K[b.name];e[c.type]||(e[c.type]={}),e[c.type][d]||(e[c.type][d]=[]);var f=e[c.type][d],g=N(a);f.push(g)},E.prototype.apply=function(a){if(h.call(this),i.call(this,a),this.type==F.Set)g.call(this,a,this.field,this.newId||this.new,this.oldId||this.old);else if(this.type==F.Splice)a[this.field]||(a[this.field]=[]),e.call(this,a,this.field,this.index,this.removedId||this.removed,this.addedId||this.added);else{if(this.type!=F.Remove)throw new t('Unknown change type "'+this.type.toString()+'"');f.call(this,this.field,this.removedId||this.removed,a)}a.collection||(a.collection=this.collection),a.mapping||(a.mapping=this.mapping),a.type||(a.type=this.mapping)},E.prototype.applySiestaModel=function(a){h.call(this),i.call(this,a);var b=v.keys(this.mapping.relationships),c=this.mapping._fields,d=c.indexOf(this.field)>-1,e=b.indexOf(this.field)>-1;if(!d&&!e)throw new t('Field "'+this.field+'" does not exist within mapping "'+this.mapping.type+'"');if(this.type==F.Set)j.call(this,d,a);else if(this.type==F.Splice)k.call(this,d,a);else{if(this.type!=F.Remove)throw new t('Unknown change type "'+this.type.toString()+'"');l.call(this,d,a)}},Object.defineProperty(c,"changes",{get:function(){return K},set:function(a){K=a},enumerable:!0,configurable:!0}),Object.defineProperty(c,"allChanges",{get:p,enumerable:!0,configurable:!0});var O=z.prototype.constructor;r.prototype=Object.create(z.prototype),r.prototype.applyChanges=function(){if(!this._id)throw new t("Cannot apply changes to object with no _id");var a=this;v.each(this.changes,function(b){b.apply(a)})},z.prototype=new r,c._SiestaModel=r,c.registerChange=D.registerChange,c.mergeChanges=o,c.changesForIdentifier=n,c.resetChanges=q},{"./index":2,"./pouch":3}],2:[function(a,b,c){function d(a,b){for(var c=function(a,b,d,e){if(0==a)return void(d.length>0&&(e[e.length]=d));for(var f=0;f<b.length;f++)c(a-1,b.slice(f+1),d.concat([b[f]]),e)},d=[],e=b;e<a.length;e++)c(e,a,[],d);return d.push(a),d}function e(a){var b=d(a,1);return b.push([]),b}function f(a,b,c){var d=e(c);return o.map(d,function(c){return new h(a,b,c)})}function g(a,b,c,d){var e=n.defer();d=m.constructCallbackAndPromiseHandler(d,e);var g=f(a,b,c),h=0,i=[];return o.each(g,function(a){a.install(function(a){a&&i.push(a),h++,h==g.length&&(q.info.isEnabled&&q.info("Successfully installed all indexes"),d(i.length?i:null))})}),e.promise}function h(a,b,c){this.type=b,this.collection=a,this.fields=c?c.length?o.sortBy(c,function(a){return a}):[c]:[]}var i=siesta._internal,j=i.error.RestError,k=i.mapping,l=i.log,m=i.util,n=i.q,o=m._,p=a("./pouch"),q=l.loggerWithName("Index");q.setLevel(l.Level.warn),h.prototype._getDesignDocName=function(){var a=this._getName();return"_design/"+a},h.prototype._constructPouchDbView=function(){var a=this._getName(),b={_id:this._getDesignDocName(),views:{}};return b.views[a]={map:this._constructMapFunction()},b},h.prototype._constructMapFunction=function(){this._validate();var a=this.fields,b=this.type,c=this.collection;return k.constructMapFunction(c,b,a)},h.prototype._validate=function(){if(!this.type)throw new j("Type must be specified in order to construct index map function.",{index:this});if(!this.collection)throw new j("API must be specified in order to construct index map function.",{index:this})},h.prototype._dump=function(){return this._getName()},h.prototype._getName=function(){this._validate();var a=o.reduce(this.fields,function(a,b){return a+"_"+b},"");return this.collection+"_Index_"+this.type+a},h.prototype.install=function(a){var b=n.defer();a=m.constructCallbackAndPromiseHandler(a,b),this._validate();var c=this,d=this._constructPouchDbView(),e=this._getName();return q.debug.isEnabled&&q.debug("Installing Index: "+e,d),p.getPouch().put(d,function(b,d){b&&409===b.status&&(q.debug.isEnabled&&q.debug(e+" already installed"),b=null),!b&&h.indexes.indexOf(c)<0&&h.indexes.push(c),a(b,d)}),b.promise},h.indexes=[],c.Index=h,c._constructIndexes=f,c._getFieldCombinations=e,c.installIndexes=g,c.clearIndexes=function(){h.indexes=[]}},{"./pouch":3}],3:[function(a,b,c){function d(a,b,c){var e=t.defer();return c=o.constructCallbackAndPromiseHandler(c,e),h().get(a,function(e,f){if(e){var g='Unable to get doc with _id="'+a+'". This is a serious error and means that a live object is now out of sync with PouchDB.';v.error(g),c&&c(e)}else{for(var i in b)b.hasOwnProperty(i)&&(f[i]=b[i]);h().put(f,function(e,g){if(e)if(409==e.status)d(a,b);else{var h='Unable to update doc with _id="'+a+'". This is a serious error and means that a live object is now out of sync with PouchDB.';v.error(h),c&&c(e)}else v.trace.isEnabled&&v.trace("Successfully persisted unmergedChanges: "+JSON.stringify({doc:f._id,pouchDBResponse:g,changes:b},null,4)),c&&c(null,g.rev)})}}),e.promise}function e(){w&&w.cancel(),w=x.changes({since:"now",live:!0}),p.each(y,function(a){w.on(z,a)})}function f(a){var b=r();if(!a)throw"Only in memory pouchDB supported atm";if("undefined"==typeof window)throw"nyi";x=new PouchDB("siesta-"+b,{adapter:"memory"}),e()}function g(a,b){var c=t.defer();return b=o.constructCallbackAndPromiseHandler(b,c),x&&x.destroy(),f(a),b&&b(),c.promise}function h(){return x}function i(a){var b=a.collection;if(b){var c=u[b];if(c){var d=a.type;if(d){var e=c[d];if(e)return e;throw new s("Cannot convert PouchDB document into SiestaModel. No mapping with type "+d.toString(),{doc:a})}throw new s("Cannot convert PouchDB document into SiestaModel. No type field within document",{doc:a})}throw new s('Cannot convert PouchDB document into SiestaModel. API "'+b.toString()+'" doesnt exist.',{doc:a})}throw new s("Cannot convert PouchDB document into SiestaModel. No collection field within document",{doc:a})}function j(a){var b=i(a),c=b._new({_id:a._id});c._rev=a._rev,c.isSaved=!0;for(var d in a)a.hasOwnProperty(d)&&(c._fields.indexOf(d)>-1?c.__values[d]=a[d]:c._relationshipFields.indexOf(d)>-1&&(c[d+"Proxy"]._id=a[d]));return c}function k(a){v.debug.isEnabled&&v.debug("toSiesta");for(var b=[],c=0;c<a.length;c++){var d=a[c];if(d){var e={_id:d._id},f=d.type,g=d.collection,h=u[g][f];h.id&&(e[h.id]=d[h.id],e.mapping=h);var i=q.get(e);i?b[c]=i:(b[c]=j(d),q.insert(b[c]),b[c].applyChanges())}else b[c]=null}return b}function l(a){v.trace.isEnabled&&v.trace("from",{obj:a});var b=a.mapping,c={};return p.each(b._fields,function(b){v.trace.isEnabled&&v.trace("field",b);var d=a[b];v.trace.isEnabled&&v.trace(b+"=",d),d&&(c[b]=d)}),p.each(a._proxies,function(a){if(a.isForward){var b=a.forwardName;a._id&&(c[b]=a._id)}}),c._id=a._id,c._rev=a._rev,c.type=a.mapping.type,c.collection=a.collection,c}var m=siesta._internal,n=m.log,o=m.util,p=o._,q=m.cache,r=m.misc.guid,s=m.error.RestError,t=m.q,u=m.CollectionRegistry,v=n.loggerWithName("Pouch");v.setLevel(n.Level.warn);var w,x=new PouchDB("siesta"),y=[];e();var z="change";c.toNew=j,c._validate=i,c.from=l,c.toSiesta=k,c.retryUntilWrittenMultiple=d,c.reset=g,c.getPouch=h,c.setPouch=function(a){x=a,e()},c.addObserver=function(a){v.debug.isEnabled&&v.debug("Adding observer",a),y.push(a),w&&w.on(z,a)},c.removeObserver=function(a){var b=y.indexOf(a);b>-1&&(w&&w.removeListener(z,a),y.splice(b,1))}},{}],4:[function(require,module,exports){function RawQuery(a,b,c){var d=this;this.collection=a,this.modelName=b,this.query=c,Object.defineProperty(d,"mapping",{configurable:!0,enumerable:!0,get:function(){var a=require("./index")[d.collection];return a?a[d.modelName]:null}})}function resultsCallback(a,b,c){var d=q.defer();if(a=util.constructCallbackAndPromiseHandler(a,d),b)a&&a(b);else{var e=_.pluck(c.rows,"value");a&&a(null,e)}return d.promise}var _i=siesta._internal,mapping=_i.mapping,utils=_i.utils,util=_i.utils,_=utils._,log=_i.log,RestError=_i.error.RestError,Query=_i.query.Query,q=_i.q,Logger=log.loggerWithName("RawQuery");Logger.setLevel(log.Level.warn);var Pouch=require("./pouch"),index=require("./index"),Index=index.Index;RawQuery.prototype.execute=function(callback){var deferred=q.defer();if(callback=util.constructCallbackAndPromiseHandler(callback,deferred),this.mapping&&!this.mapping.installed)throw new RestError("Mapping must be installed");var self=this,designDocId=this._getDesignDocName(),indexName=self._getIndexName();return Pouch.getPouch().get(designDocId,function(err){function finish(a,b){Logger.trace.isEnabled&&Logger.trace("Received results: ",b),partialCallback(a,b)}var partialCallback=_.partial(resultsCallback,callback),key;if(err)if(404==err.status){Logger.warn('Couldnt find index "'+indexName+'" and hence must iterate through every single document.');var fields=self._sortedFields(),f=mapping.constructMapFunction(self.collection,self.modelName,fields);eval("var mapFunc = "+f),key=self._constructKey(fields),key.length||(key=self.modelName),Pouch.getPouch().query(mapFunc,{key:key},finish)}else finish(err);else key=self._constructKey(),key.length||(key=self.modelName),Logger.debug.isEnabled&&Logger.debug("Executing query "+indexName+": "+key),Pouch.getPouch().query(indexName,{key:key},finish)}),deferred.promise},RawQuery.prototype._getFields=function(){var a=[];for(var b in this.query)this.query.hasOwnProperty(b)&&a.push(b);return a},RawQuery.prototype._sortedFields=function(){var a=this._getFields();return _.sortBy(a,function(a){return a})},RawQuery.prototype._constructKey=function(){var a=this,b=this._sortedFields(),c=_.reduce(b,function(b,c){var d;return d=null===c?"null":void 0===c?"undefined":a.query[c].toString(),b+d+"_"},"");return c.substring(0,c.length-1)},RawQuery.prototype._getDesignDocName=function(){var a=new index.Index(this.collection,this.modelName,this._getFields());return a._getDesignDocName()},RawQuery.prototype._getIndexName=function(){var a=new index.Index(this.collection,this.modelName,this._getFields());return a._getName()},RawQuery.prototype._dump=function(a){var b={};return b.collection=this.collection,b.mapping=this.modelName,b.query=this.query,b.index=this._getIndexName(),b.designDoc=this._getDesignDocName(),a?JSON.stringify(b,null,4):b},exports.RawQuery=RawQuery},{"./index":2,"./pouch":3}],5:[function(a){!function(){var b=siesta._internal,c=b.mapping,d=b.q,e=b.util,f=(_.extend,c.Mapping),g=a("./changes"),h=a("./pouch"),i=a("./query"),j=a("./index"),k=a("./store"),l=siesta.reset;siesta.reset=function(a,b){g.resetChanges(),j.clearIndexes(),h.reset(a,b),l.apply(l,arguments)};var m=c.Mapping.prototype.install;f.prototype.getIndexesToInstall=function(){var a=this,b=_.reduce(a._fields,function(a,b){return a[b]={},a},{});for(var c in a.relationships)if(a.relationships.hasOwnProperty(c)){var d=a.relationships[c];d.reverse!=c&&(b[c]={})}var e=_.reduce(a.indexes,function(a,c){return b[c]&&a.push(c),a},[]);return a.id&&e.push(a.id),e},f.prototype.install=function(a){var b=d.defer();a=e.constructCallbackAndPromiseHandler(a,b);var c=this;return m.call(this,function(b){if(b)a&&a(b);else{var d=c.getIndexesToInstall();j.installIndexes(c.collection,c.type,d,function(b){c._installed=!b,a&&a(b)})}}),b.promise},siesta.ext||(siesta.ext={}),siesta.ext.storage={changes:g,pouch:h,Pouch:h,query:i,index:j,store:k,Index:j.Index,RawQuery:i.RawQuery}}()},{"./changes":1,"./index":2,"./pouch":3,"./query":4,"./store":6}],6:[function(a,b,c){function d(a,b){n.getPouch().get(a._id).then(function(a){var c=n.toSiesta([a]);b&&b(null,c.length?c[0]:null)},h(b))}function e(a,b){var c=l.defer();return b=i.constructCallbackAndPromiseHandler(b,c),n.getPouch().allDocs({keys:a.notCached,include_docs:!0},function(c,d){if(c)b(c);else{var e=j.pluck(d.rows,"doc"),f=n.toSiesta(e);j.each(f,function(b){b&&(a.cached[b._id]=b)}),b()}}),c.promise}function f(a,b,c,d){m.trace.isEnabled&&m.trace("getMultipleRemoteFrompouch("+a.type+"):",b);var e=l.defer();d=i.constructCallbackAndPromiseHandler(d,e);var f=new p(a.collection,a.type,[a.id]),g=f._getName();return n.getPouch().query(g,{keys:j.map(b,function(a){return a.toString()}),include_docs:!0},function(b,e){if(b)d(b);else{var f=j.pluck(e.rows,"value");m.trace.isEnabled&&m.trace("[ROWS] getMultipleRemoteFrompouch("+a.type+"):",f);var g=n.toSiesta(f);j.each(g,function(b){var d=b[a.id];c.cached[d]=b;var e=c.notCached.indexOf(d);c.notCached.splice(e,1)}),m.trace.isEnabled&&m.trace("[RESULTS] getMultipleRemoteFrompouch("+a.type+"):",c),d()}}),e.promise}var g=siesta._internal,h=g.misc.wrappedCallback,i=g.util,j=i._,k=(g.cache,g.error.RestError,g.log),l=(g.store,g.q),m=k.loggerWithName("Store");m.setLevel(k.Level.trace);var n=a("./pouch"),o=a("./index"),p=o.Index;c.getFromPouch=d,c.getMultipleLocalFromCouch=e,c.getMultipleRemoteFrompouch=f},{"./index":2,"./pouch":3}]},{},[5]);